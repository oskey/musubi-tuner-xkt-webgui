<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wan2.2 LoRA ËÆ≠ÁªÉÁïåÈù¢</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .header h1 {
            color: #61dafb;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .header p {
            color: #a0a0a0;
            font-size: 1.1em;
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .panel {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid #4a5568;
        }
        
        .panel h2 {
            color: #61dafb;
            margin-bottom: 20px;
            font-size: 1.4em;
            border-bottom: 2px solid #61dafb;
            padding-bottom: 8px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #e0e0e0;
            font-weight: 500;
            cursor: help;
        }
        
        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #4a5568;
            border-radius: 8px;
            background: #1a202c;
            color: #e0e0e0;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .form-group input[type="text"]:focus,
        .form-group input[type="number"]:focus,
        .form-group select:focus {
            outline: none;
            border-color: #61dafb;
            box-shadow: 0 0 0 3px rgba(97, 218, 251, 0.1);
        }
        
        .form-group input[type="checkbox"] {
            margin-right: 8px;
            transform: scale(1.2);
        }
        
        /* ËßÜÈ¢ëËÆ≠ÁªÉÈÄâÈ°πÊ†∑Âºè */
        .video-training-section {
            background: linear-gradient(135deg, #2a4365 0%, #3182ce 100%);
            border: 2px solid #4299e1;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .video-training-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #4299e1, #63b3ed, #90cdf4);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .video-training-checkbox {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .video-training-checkbox:hover {
            background: rgba(66, 153, 225, 0.1);
        }
        
        .video-training-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin: 0;
            cursor: pointer;
            accent-color: #4299e1;
        }
        
        .video-training-checkbox label {
            font-size: 16px;
            font-weight: 600;
            color: #e2e8f0;
            cursor: pointer;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .video-training-checkbox label::before {
            content: 'üé¨';
            font-size: 18px;
        }
        
        .video-duration-settings {
            background: rgba(26, 32, 44, 0.6);
            border: 1px solid #4a5568;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            display: none;
            transition: all 0.3s ease;
        }
        
        .video-duration-settings.show {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .video-duration-input {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .video-duration-input input {
            width: 80px;
            text-align: center;
            font-weight: bold;
        }
        
        .video-duration-input span {
            color: #a0aec0;
            font-size: 14px;
        }
        
        .form-group small {
            color: #a0a0a0;
            font-size: 12px;
            margin-top: 5px;
            display: block;
        }
        
        .btn {
            background: linear-gradient(135deg, #61dafb 0%, #21b4d3 100%);
            color: #1a202c;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(97, 218, 251, 0.3);
        }
        
        .btn:disabled {
            background: #4a5568;
            color: #a0a0a0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
            color: white;
        }
        
        .btn-danger:hover {
            box-shadow: 0 4px 15px rgba(229, 62, 62, 0.3);
        }
        
        .log-container {
            background: #1a202c;
            border: 2px solid #4a5568;
            border-radius: 8px;
            height: 300px;
            overflow-y: auto;
            padding: 15px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.4;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }
        
        .log-info { color: #61dafb; }
        .log-warning { color: #fbd38d; }
        .log-error { color: #fc8181; }
        .log-success { color: #68d391; }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        .status-ready { background-color: #68d391; }
        .status-running { background-color: #61dafb; }
        .status-error { background-color: #fc8181; }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #4a5568;
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #61dafb 0%, #21b4d3 100%);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .config-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .collapsible-section {
            margin-top: 20px;
        }
        
        .collapsible-header {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            border: none;
            border-radius: 8px;
            color: #61dafb;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 15px 0;
        }
        
        .collapsible-content {
            display: none;
            padding: 10px;
            border: 1px solid #4a5568;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .task-type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .task-type-btn {
            flex: 1;
            padding: 15px;
            border: 2px solid #4a5568;
            border-radius: 8px;
            background: #2d3748;
            color: #e0e0e0;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .task-type-btn.active {
            border-color: #61dafb;
            background: rgba(97, 218, 251, 0.1);
            color: #61dafb;
        }
        
        .input-with-button {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .input-with-button input {
            flex: 1;
        }
        
        .input-with-button button {
            flex-shrink: 0;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        @media (max-width: 768px) {
            .config-layout {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé¨ Wan2.2 LoRA ËÆ≠ÁªÉÁïåÈù¢</h1>
            <p>ÊñáÁîüËßÜÈ¢ë & ÂõæÁîüËßÜÈ¢ë LoRA ËÆ≠ÁªÉÂ∑•ÂÖ∑</p>
        </div>
        
        <div class="main-content">
            <!-- Êó•ÂøóÈù¢Êùø -->
            <div class="panel">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h2 style="margin: 0;">üìã ËÆ≠ÁªÉÊó•Âøó</h2>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="clearLogs()" class="btn" style="padding: 5px 10px; font-size: 12px; background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);">üóëÔ∏è Ê∏ÖÁêÜÊó•Âøó</button>
                        <button onclick="scrollToBottom()" class="btn" style="padding: 5px 10px; font-size: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">ÊªöÂä®Âà∞Â∫ïÈÉ®</button>
                    </div>
                </div>
                <div class="log-container" id="log-output">
                    <div class="log-entry log-info">
                        <span style="color: #888;">[Á≥ªÁªü]</span> Wan2.2 ËÆ≠ÁªÉÁïåÈù¢Â∑≤Â∞±Áª™
                    </div>
                </div>
                
                <!-- Áä∂ÊÄÅÂíåÊìç‰ΩúÊåâÈíÆ -->
                <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 15px;">
                    <div style="display: flex; align-items: center;">
                        <div class="status-indicator status-ready" id="status-indicator"></div>
                        <span id="status-text" style="color: #d4d4d4; font-size: 14px;">Â∞±Áª™</span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px;">
                    <button onclick="startTensorBoard()" class="btn" id="tensorboard-btn">üìä ÂêØÂä® TensorBoard</button>
                    <button onclick="startCacheVAE()" class="btn" id="cache-vae-btn">üîÑ È¢ÑÁºìÂ≠ò VAE Latents</button>
                    <button onclick="startCacheTextEncoder()" class="btn" id="cache-te-btn">üìù È¢ÑÁºìÂ≠òÊñáÊú¨ÁºñÁ†ÅÂô®ËæìÂá∫</button>
                    <button onclick="startTraining()" class="btn" id="train-btn">üéØ ÂºÄÂßãËÆ≠ÁªÉ</button>
                    <button onclick="stopTraining()" class="btn btn-danger" id="stop-btn" disabled>‚èπÔ∏è ÂÅúÊ≠¢ËÆ≠ÁªÉ</button>
                    <button onclick="convertLora()" class="btn" id="convert-lora-btn" style="background-color: #28a745; color: white;">üîÑ ËΩ¨Êç¢ LoRA</button>
                </div>
            </div>
            
            <!-- ‰ªªÂä°Á±ªÂûãÈÄâÊã© -->
            <div class="panel">
                <h2>üéØ ËÆ≠ÁªÉ‰ªªÂä°Á±ªÂûã</h2>
                <div class="task-type-selector">
                    <div class="task-type-btn active" id="t2v-btn" onclick="selectTaskType('t2v')">
                        <div style="font-size: 24px; margin-bottom: 8px;">üìù‚û°Ô∏èüé¨</div>
                        <div><strong>ÊñáÁîüËßÜÈ¢ë (T2V)</strong></div>
                        <div style="font-size: 12px; color: #a0a0a0; margin-top: 4px;">‰ªéÊñáÊú¨ÊèèËø∞ÁîüÊàêËßÜÈ¢ë</div>
                    </div>
                    <div class="task-type-btn" id="i2v-btn" onclick="selectTaskType('i2v')">
                        <div style="font-size: 24px; margin-bottom: 8px;">üñºÔ∏è‚û°Ô∏èüé¨</div>
                        <div><strong>ÂõæÁîüËßÜÈ¢ë (I2V)</strong></div>
                        <div style="font-size: 12px; color: #a0a0a0; margin-top: 4px;">‰ªéÂõæÁâáÁîüÊàêËßÜÈ¢ë</div>
                    </div>
                </div>
            </div>
            
            <!-- ËôöÊãüÁéØÂ¢ÉÈÖçÁΩÆ -->
            <div class="panel" style="margin-bottom: 20px;">
                <h2>üêç ËøêË°åÁéØÂ¢É</h2>
                <div class="form-group">
                    <label title="ÂêØÁî®ËôöÊãüÁéØÂ¢ÉÂèØ‰ª•Á°Æ‰øùËÆ≠ÁªÉËøáÁ®ã‰ΩøÁî®ÊåáÂÆöÁöÑPythonÁéØÂ¢ÉÔºåÈÅøÂÖç‰æùËµñÂÜ≤Á™Å„ÄÇ">ÂêØÁî®ËôöÊãüÁéØÂ¢É</label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="enable_venv" checked title="ÂêØÁî®ËôöÊãüÁéØÂ¢ÉÂèØ‰ª•Á°Æ‰øùËÆ≠ÁªÉËøáÁ®ã‰ΩøÁî®ÊåáÂÆöÁöÑPythonÁéØÂ¢ÉÔºåÈÅøÂÖç‰æùËµñÂÜ≤Á™Å„ÄÇ">
                        <span style="color: #666; font-size: 14px;">‰ΩøÁî®ËôöÊãüÁéØÂ¢ÉÊâßË°åËÆ≠ÁªÉÂëΩ‰ª§</span>
                    </div>
                </div>
                
                <div class="form-group" id="venv_path_group">
                    <label title="ËôöÊãüÁéØÂ¢ÉÁöÑPythonÂèØÊâßË°åÊñá‰ª∂Ë∑ØÂæÑ„ÄÇÈÄöÂ∏∏‰Ωç‰∫éËôöÊãüÁéØÂ¢ÉÁöÑScriptsÁõÆÂΩï‰∏ã„ÄÇ">ËôöÊãüÁéØÂ¢ÉPythonË∑ØÂæÑ</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="text" id="venv_python_path" title="ËôöÊãüÁéØÂ¢ÉÁöÑPythonÂèØÊâßË°åÊñá‰ª∂Ë∑ØÂæÑ„ÄÇÈÄöÂ∏∏‰Ωç‰∫éËôöÊãüÁéØÂ¢ÉÁöÑScriptsÁõÆÂΩï‰∏ã„ÄÇ" style="flex: 1;">
                        <button type="button" onclick="selectFolder('venv_python_path')" class="btn" style="padding: 8px 12px; font-size: 12px;">üìÅ ÈÄâÊã©</button>
                    </div>
                    <small style="color: #666; display: block; margin-top: 5px;">üí° ËôöÊãüÁéØÂ¢ÉÁöÑScriptsÁõÆÂΩïË∑ØÂæÑ</small>
                </div>
            </div>
            
            <!-- ÈÖçÁΩÆÂ∏ÉÂ±Ä -->
            <div class="config-layout">
                <!-- Â∑¶‰æßÔºöÂü∫Á°ÄÈÖçÁΩÆ -->
                <div class="panel">
                    <h2>üìÅ Âü∫Á°ÄÈÖçÁΩÆ</h2>
                    <div class="form-group">
                        <label title="TOMLÊ†ºÂºèÁöÑÊï∞ÊçÆÈõÜÈÖçÁΩÆÊñá‰ª∂ÔºåÂÆö‰πâ‰∫ÜËÆ≠ÁªÉÊï∞ÊçÆÁöÑË∑ØÂæÑ„ÄÅÊ†áÁ≠æÂíåÈ¢ÑÂ§ÑÁêÜÂèÇÊï∞„ÄÇ">Êï∞ÊçÆÈõÜÈÖçÁΩÆÊñá‰ª∂ (dataset_config)</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="text" id="dataset_config" title="TOMLÊ†ºÂºèÁöÑÊï∞ÊçÆÈõÜÈÖçÁΩÆÊñá‰ª∂ÔºåÂÆö‰πâ‰∫ÜËÆ≠ÁªÉÊï∞ÊçÆÁöÑË∑ØÂæÑ„ÄÅÊ†áÁ≠æÂíåÈ¢ÑÂ§ÑÁêÜÂèÇÊï∞„ÄÇ" style="flex: 1;">
                            <button type="button" onclick="selectFileWithDialog('dataset_config')" class="btn" style="padding: 8px 12px; font-size: 12px;">üìÅ ÈÄâÊã©</button>
                        </div>
                        <small style="color: #666; display: block; margin-top: 5px;">üí° ÂåÖÂê´ËÆ≠ÁªÉÊï∞ÊçÆË∑ØÂæÑÂíåÊ†áÁ≠æÁöÑTOMLÈÖçÁΩÆÊñá‰ª∂</small>
                    </div>
                    
                    <div class="form-group">
                        <label title="Wan2.2 DiTÊ®°ÂûãË∑ØÂæÑ„ÄÇËøôÊòØËÆ≠ÁªÉÁöÑÂü∫Á°ÄÊ®°Âûã„ÄÇ">DiTÊ®°ÂûãË∑ØÂæÑ (dit)</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="text" id="dit" title="Wan2.2 DiTÊ®°ÂûãË∑ØÂæÑ„ÄÇËøôÊòØËÆ≠ÁªÉÁöÑÂü∫Á°ÄÊ®°Âûã„ÄÇ" style="flex: 1;">
                            <button type="button" onclick="selectFileWithDialog('dit')" class="btn" style="padding: 8px 12px; font-size: 12px;">üìÅ ÈÄâÊã©</button>
                        </div>
                        <small style="color: #666; display: block; margin-top: 5px;">üí° Wan2.2ÁöÑDiTÊâ©Êï£ÂèòÊç¢Âô®Ê®°Âûã</small>
                    </div>
                    
                    <div class="form-group">
                        <label title="T5ÊñáÊú¨ÁºñÁ†ÅÂô®Ê®°ÂûãË∑ØÂæÑ„ÄÇÁî®‰∫éÂ∞ÜÊñáÊú¨ÊèêÁ§∫ÁºñÁ†Å‰∏∫ÂêëÈáèË°®Á§∫„ÄÇ">T5ÊñáÊú¨ÁºñÁ†ÅÂô®Ë∑ØÂæÑ (t5)</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="text" id="t5" title="T5ÊñáÊú¨ÁºñÁ†ÅÂô®Ê®°ÂûãË∑ØÂæÑ„ÄÇÁî®‰∫éÂ∞ÜÊñáÊú¨ÊèêÁ§∫ÁºñÁ†Å‰∏∫ÂêëÈáèË°®Á§∫„ÄÇ" style="flex: 1;">
                            <button type="button" onclick="selectFileWithDialog('t5')" class="btn" style="padding: 8px 12px; font-size: 12px;">üìÅ ÈÄâÊã©</button>
                        </div>
                        <small style="color: #666; display: block; margin-top: 5px;">üí° T5ÊñáÊú¨ÁºñÁ†ÅÂô®ÔºåWan2.2Êó†ÈúÄCLIP</small>
                    </div>
                    
                    <div class="form-group">
                        <label title="ÂèòÂàÜËá™ÁºñÁ†ÅÂô®(VAE)Ê®°ÂûãË∑ØÂæÑ„ÄÇVAEË¥üË¥£Âú®ÂÉèÁ¥†Á©∫Èó¥ÂíåÊΩúÂú®Á©∫Èó¥‰πãÈó¥ËøõË°åËΩ¨Êç¢„ÄÇ">VAEÊ®°ÂûãË∑ØÂæÑ (vae)</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="text" id="vae" title="ÂèòÂàÜËá™ÁºñÁ†ÅÂô®(VAE)Ê®°ÂûãË∑ØÂæÑ„ÄÇVAEË¥üË¥£Âú®ÂÉèÁ¥†Á©∫Èó¥ÂíåÊΩúÂú®Á©∫Èó¥‰πãÈó¥ËøõË°åËΩ¨Êç¢„ÄÇ" style="flex: 1;">
                            <button type="button" onclick="selectFileWithDialog('vae')" class="btn" style="padding: 8px 12px; font-size: 12px;">üìÅ ÈÄâÊã©</button>
                        </div>
                        <small style="color: #666; display: block; margin-top: 5px;">üí° Ë¥üË¥£ËßÜÈ¢ëÁöÑÁºñÁ†ÅÂíåËß£Á†ÅÂ§ÑÁêÜ</small>
                    </div>
                    
                    <div class="form-group">
                        <label title="ËæìÂá∫ÁõÆÂΩïË∑ØÂæÑ„ÄÇËÆ≠ÁªÉÂÆåÊàêÁöÑLoRAÊ®°ÂûãÂ∞Ü‰øùÂ≠òÂà∞Ê≠§ÁõÆÂΩï„ÄÇ">ËæìÂá∫ÁõÆÂΩï (output_dir)</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="text" id="output_dir" title="ËæìÂá∫ÁõÆÂΩïË∑ØÂæÑ„ÄÇËÆ≠ÁªÉÂÆåÊàêÁöÑLoRAÊ®°ÂûãÂ∞Ü‰øùÂ≠òÂà∞Ê≠§ÁõÆÂΩï„ÄÇ" style="flex: 1;">
                            <button type="button" onclick="selectFolder('output_dir')" class="btn" style="padding: 8px 12px; font-size: 12px;">üìÅ ÈÄâÊã©</button>
                        </div>
                        <small style="color: #666; display: block; margin-top: 5px;">üí° ËÆ≠ÁªÉÂÆåÊàêÁöÑÊ®°ÂûãÊñá‰ª∂‰øùÂ≠ò‰ΩçÁΩÆ</small>
                    </div>
                    
                    <div class="form-group">
                        <label title="ËæìÂá∫Ê®°ÂûãÂêçÁß∞„ÄÇËÆ≠ÁªÉÂÆåÊàêÂêé‰øùÂ≠òÁöÑLoRAÊ®°ÂûãÊñá‰ª∂ÂêçÂâçÁºÄ„ÄÇ">ËæìÂá∫Ê®°ÂûãÂêçÁß∞ (output_name)</label>
                        <input type="text" id="output_name" title="ËæìÂá∫Ê®°ÂûãÂêçÁß∞„ÄÇËÆ≠ÁªÉÂÆåÊàêÂêé‰øùÂ≠òÁöÑLoRAÊ®°ÂûãÊñá‰ª∂ÂêçÂâçÁºÄ„ÄÇ" style="width: 100%;">
                        <small style="color: #666; display: block; margin-top: 5px;">üí° ‰øùÂ≠òÁöÑLoRAÊ®°ÂûãÊñá‰ª∂ÂêçÂâçÁºÄ</small>
                    </div>
                    
                    <!-- LoRAËΩ¨Êç¢ËÆæÁΩÆÂàÜÁªÑ -->
                    <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">
                        <h3 style="margin-bottom: 15px; color: #333;">üîÑ LoRAËΩ¨Êç¢ËÆæÁΩÆ</h3>
                        
                        <div class="form-group">
                            <label title="ÂæÖËΩ¨Êç¢ÁöÑLoRAÊñá‰ª∂ÂÆåÊï¥Ë∑ØÂæÑ„ÄÇÈÄâÊã©ÈúÄË¶ÅËΩ¨Êç¢‰∏∫ComfyUIÊ†ºÂºèÁöÑLoRAÊñá‰ª∂„ÄÇ">ÂæÖËΩ¨Êç¢LoRAÊñá‰ª∂Âú∞ÂùÄ</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="text" id="convert_input_file" title="ÂæÖËΩ¨Êç¢ÁöÑLoRAÊñá‰ª∂ÂÆåÊï¥Ë∑ØÂæÑ„ÄÇÈÄâÊã©ÈúÄË¶ÅËΩ¨Êç¢‰∏∫ComfyUIÊ†ºÂºèÁöÑLoRAÊñá‰ª∂„ÄÇ" style="flex: 1;">
                                <button type="button" onclick="selectFileWithDialog('convert_input_file')" class="btn" style="padding: 8px 12px; font-size: 12px;">üìÅ ÈÄâÊã©</button>
                            </div>
                            <small style="color: #666; display: block; margin-top: 5px;">üí° ÈÄâÊã©Ë¶ÅËΩ¨Êç¢ÁöÑLoRAÊñá‰ª∂Ôºà.safetensorsÊ†ºÂºèÔºâ</small>
                        </div>
                        
                        <div class="form-group">
                            <label title="ËΩ¨Êç¢ÂêéLoRAÊñá‰ª∂‰øùÂ≠òÁöÑÁõÆÂΩïË∑ØÂæÑ„ÄÇËΩ¨Êç¢ÂêéÁöÑÊñá‰ª∂Â∞Ü‰øùÂ≠òÂà∞Ê≠§ÁõÆÂΩï„ÄÇ">ËΩ¨Êç¢ÂêéLoRAÊñá‰ª∂Âú∞ÂùÄ</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="text" id="convert_output_dir" title="ËΩ¨Êç¢ÂêéLoRAÊñá‰ª∂‰øùÂ≠òÁöÑÁõÆÂΩïË∑ØÂæÑ„ÄÇËΩ¨Êç¢ÂêéÁöÑÊñá‰ª∂Â∞Ü‰øùÂ≠òÂà∞Ê≠§ÁõÆÂΩï„ÄÇ" style="flex: 1;">
                                <button type="button" onclick="selectFolder('convert_output_dir')" class="btn" style="padding: 8px 12px; font-size: 12px;">üìÅ ÈÄâÊã©</button>
                            </div>
                            <small style="color: #666; display: block; margin-top: 5px;">üí° ËΩ¨Êç¢ÂêéÁöÑComfyUIÊ†ºÂºèÊñá‰ª∂‰øùÂ≠òÁõÆÂΩï</small>
                        </div>
                    </div>
                </div>
                
                <!-- Âè≥‰æßËÆ≠ÁªÉÂèÇÊï∞Èù¢Êùø -->
                <div class="panel">
                    <h2>üéì Ê†∏ÂøÉËÆ≠ÁªÉÂèÇÊï∞</h2>
                    
                    <!-- ËÆ≠ÁªÉÁ±ªÂûãÈÄâÊã© -->
                    <div class="form-group">
                        <div class="video-training-section">
                            <div class="video-training-checkbox">
                                <input type="checkbox" id="video_training_checkbox" onchange="toggleVideoSettings()">
                                <label for="video_training_checkbox">ËÆ≠ÁªÉÁ±ªÂûã ‚Üí ËßÜÈ¢ë</label>
                            </div>
                            
                            <div id="video_duration_settings" class="video-duration-settings">
                                <label for="video_duration">ËßÜÈ¢ëÊÄªÊó∂ÈïøËÆæÁΩÆ:</label>
                                <div class="video-duration-input">
                                    <input type="number" id="video_duration" value="300" min="1" max="3600" step="1">
                                    <span>Áßí</span>
                                </div>
                                <small>ÊâÄÊúâËßÜÈ¢ëÊñá‰ª∂ÁöÑÊÄªÊó∂ÈïøÔºàÁßíÔºâÔºå‰ºöÂΩ±ÂìçGPTÊé®ËçêÁöÑÂèÇÊï∞ËÆ°ÁÆóÔºåÁ≥ªÁªüÂ∞ÜÊ†πÊçÆÊÄªÊó∂ÈïøËá™Âä®Ë∞ÉËäÇËÆ≠ÁªÉÂèÇÊï∞</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label title="ËÆ≠ÁªÉÊâπÊ¨°Â§ßÂ∞è„ÄÇÂΩ±ÂìçÊòæÂ≠ò‰ΩøÁî®ÂíåËÆ≠ÁªÉÈÄüÂ∫¶„ÄÇ">ËÆ≠ÁªÉÊâπÊ¨°Â§ßÂ∞è (batch_size)</label>
                        <input type="number" id="batch_size" min="1" max="32" title="ËÆ≠ÁªÉÊâπÊ¨°Â§ßÂ∞è„ÄÇÂΩ±ÂìçÊòæÂ≠ò‰ΩøÁî®ÂíåËÆ≠ÁªÉÈÄüÂ∫¶„ÄÇ">
                        <small style="color: #666; display: block; margin-top: 5px;">üí° Êé®ËçêÂÄºÔºö1-4ÔºåÊ†πÊçÆÊòæÂ≠òÂ§ßÂ∞èË∞ÉÊï¥</small>
                    </div>
                    
                    <div class="form-group">
                        <label title="Êï∞ÊçÆÈáçÂ§çÊ¨°Êï∞ - ‰ªéTOMLÈÖçÁΩÆÊñá‰ª∂ËØªÂèñ„ÄÇÊé®ËçêÂÄº20~30ÔºàÂõæÁâáËæÉÂ∞ëÊó∂ÔºâÔºåÊ®°ÂûãËÉΩÊõ¥ÂÆπÊòìËÆ∞‰ΩèÁâπÂæÅ„ÄÇ">Êï∞ÊçÆÈáçÂ§çÊ¨°Êï∞ (num_repeats)</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="number" id="num_repeats" min="1" max="100" title="Êï∞ÊçÆÈáçÂ§çÊ¨°Êï∞ - ‰ªéTOMLÈÖçÁΩÆÊñá‰ª∂ËØªÂèñ„ÄÇÊé®ËçêÂÄº20~30ÔºàÂõæÁâáËæÉÂ∞ëÊó∂ÔºâÔºåÊ®°ÂûãËÉΩÊõ¥ÂÆπÊòìËÆ∞‰ΩèÁâπÂæÅ„ÄÇ" style="flex: 1;">
                            <button onclick="setRecommendedNumRepeats()" class="btn" style="background: linear-gradient(45deg, #3498db, #2980b9); color: white; padding: 8px 12px; border: none; border-radius: 6px; font-size: 12px; cursor: pointer; white-space: nowrap; box-shadow: 0 2px 4px rgba(0,0,0,0.2); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 3px 6px rgba(0,0,0,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.2)'">üîß ËΩØ‰ª∂Êé®ËçêÂÄº</button>
                            <button onclick="setChatGPTRecommendedNumRepeats()" class="btn" style="background: linear-gradient(45deg, #4ECDC4, #44A08D); color: white; padding: 8px 12px; border: none; border-radius: 6px; font-size: 12px; cursor: pointer; white-space: nowrap; box-shadow: 0 2px 4px rgba(0,0,0,0.2); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 3px 6px rgba(0,0,0,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.2)'">ü§ñ ChatGPTÊé®ËçêÂÄº</button>
                        </div>
                        <div style="margin-top: 5px;">
                            <span style="color: #666; cursor: pointer; user-select: none; display: inline-flex; align-items: center; gap: 5px;" 
                                  onclick="toggleRecommendationTip()" 
                                  onmouseover="this.style.color='#3498db'" 
                                  onmouseout="this.style.color='#666'" 
                                  title="ÁÇπÂáªÊü•ÁúãËØ¶ÁªÜÊé®ËçêÈÄªËæë">
                                <span id="tip-icon">üí°</span> <strong>ËΩØ‰ª∂Êé®ËçêÊèêÁ§∫</strong>
                            </span>
                            <span style="color: #666; cursor: pointer; user-select: none; display: inline-flex; align-items: center; gap: 5px; margin-left: 20px;" 
                                  onclick="toggleChatGPTRecommendationTip()" 
                                  onmouseover="this.style.color='#4ECDC4'" 
                                  onmouseout="this.style.color='#666'" 
                                  title="ÁÇπÂáªÊü•ÁúãChatGPTÊé®ËçêÈÄªËæë">
                                <span id="chatgpt-tip-icon">ü§ñ</span> <strong>ChatGPTÊé®ËçêÊèêÁ§∫</strong>
                            </span>
                            <div id="recommendation-tip" style="display: none; color: #666; margin-top: 8px; line-height: 1.4; padding: 10px; background: #f8f9fa; border-radius: 6px; border-left: 3px solid #3498db;">
                                <strong>‚öôÔ∏è ÂÆûÁé∞ÁöÑÂäüËÉΩÈÄªËæë</strong><br><br>
                                <strong>ÈùûËßÜÈ¢ëËÆ≠ÁªÉÊ®°Âºè</strong>ÔºàÊú™ÂãæÈÄâËßÜÈ¢ëËÆ≠ÁªÉÔºâÔºö<br>
                                ‚Ä¢ Â∞èÊï∞ÊçÆÈõÜ(‚â§50‰∏™Êñá‰ª∂)ÔºöÊé®Ëçê10Ê¨°ÈáçÂ§ç<br>
                                ‚Ä¢ ‰∏≠Á≠âÊï∞ÊçÆÈõÜ(51-200‰∏™Êñá‰ª∂)ÔºöÊé®Ëçê5Ê¨°ÈáçÂ§ç<br>
                                ‚Ä¢ ËæÉÂ§ßÊï∞ÊçÆÈõÜ(201-500‰∏™Êñá‰ª∂)ÔºöÊé®Ëçê3Ê¨°ÈáçÂ§ç<br>
                                ‚Ä¢ Â§ßÊï∞ÊçÆÈõÜ(>500‰∏™Êñá‰ª∂)ÔºöÊé®Ëçê1Ê¨°ÈáçÂ§ç<br><br>
                                <strong>ËßÜÈ¢ëËÆ≠ÁªÉÊ®°Âºè</strong>ÔºàÂãæÈÄâËßÜÈ¢ëËÆ≠ÁªÉÔºâÔºö<br>
                                ‚Ä¢ Áü≠ËßÜÈ¢ë(‚â§5Áßí)ÔºöÊé®Ëçê20Ê¨°ÈáçÂ§ç<br>
                                ‚Ä¢ ‰∏≠Áü≠ËßÜÈ¢ë(6-10Áßí)ÔºöÊé®Ëçê15Ê¨°ÈáçÂ§ç<br>
                                ‚Ä¢ ‰∏≠Á≠âËßÜÈ¢ë(11-20Áßí)ÔºöÊé®Ëçê10Ê¨°ÈáçÂ§ç<br>
                                ‚Ä¢ ËæÉÈïøËßÜÈ¢ë(21-30Áßí)ÔºöÊé®Ëçê8Ê¨°ÈáçÂ§ç<br>
                                ‚Ä¢ ÈïøËßÜÈ¢ë(>30Áßí)ÔºöÊé®Ëçê5Ê¨°ÈáçÂ§ç<br>
                                ‚Ä¢ ÂêåÊó∂ËÄÉËôëÊï∞ÊçÆÈõÜÂ§ßÂ∞èËøõË°åÂæÆË∞É
                            </div>
                            <div id="chatgpt-recommendation-tip" style="display: none; color: #666; margin-top: 8px; line-height: 1.4; padding: 10px; background: #f0fffe; border-radius: 6px; border-left: 3px solid #4ECDC4;">
                                <strong>ü§ñ ChatGPTÊé®ËçêÁÆóÊ≥ï</strong><br><br>
                                <strong>üìä Ê†∏ÂøÉËÆ°ÁÆóÂÖ¨ÂºèÔºö</strong><br>
                                ‚Ä¢ total_steps = ceil((N_images √ó repeats) / batch_size) √ó epochs<br>
                                ‚Ä¢ steps_per_epoch = ceil((N_images √ó repeats) / batch_size)<br><br>
                                <strong>üéØ ÁõÆÊ†áÊÄªÊ≠•Êï∞ËåÉÂõ¥Ôºö</strong><br>
                                ‚Ä¢ Âø´ÈÄüËØïÈ™åÔºö2k-5k steps<br>
                                ‚Ä¢ ‰∏≠Á≠âË¥®ÈáèÔºö5k-20k steps<br>
                                ‚Ä¢ È´òÁ≤æÂ∫¶ËÆ≠ÁªÉÔºö20k-50k+ steps<br><br>
                                <strong>üìà Êï∞ÊçÆÈõÜÂ§ßÂ∞èÊé®ËçêÔºö</strong><br>
                                ‚Ä¢ Â∞èÊï∞ÊçÆÈõÜ(‚â§50Êñá‰ª∂)Ôºörepeats 50-200ÔºåÈÖçÂêà‰ΩéÂ≠¶‰π†Áéá<br>
                                ‚Ä¢ ‰∏≠Á≠âÊï∞ÊçÆÈõÜ(51-200)Ôºörepeats 10-50<br>
                                ‚Ä¢ Â§ßÊï∞ÊçÆÈõÜ(>500)Ôºörepeats 1-5<br><br>
                                <strong>üé¨ I2V vs T2VÂ∑ÆÂºÇÔºö</strong><br>
                                ‚Ä¢ I2VÔºöÂçïÊ†∑Êú¨ÂåÖÂê´Â§öÂ∏ßÔºåÈúÄË¶ÅËæÉÂ∞ërepeats(1-20)<br>
                                ‚Ä¢ T2VÔºöÊñáÊú¨Êù°‰ª∂Â§öÊ†∑ÔºåÂèØÁî®‰∏≠Á≠ârepeats(10-50)<br><br>
                                <strong>‚ö†Ô∏è ÈáçË¶ÅÊèêÈÜíÔºö</strong><br>
                                ‚Ä¢ Â¢ûÂä†repeatsÊó∂ÈúÄÈôç‰ΩéÂ≠¶‰π†Áéá(√ó0.7-0.9)<br>
                                ‚Ä¢ ‰ºòÂÖà‰ΩøÁî®Êï∞ÊçÆÂ¢ûÂº∫ËÄåÈùûÂçïÁ∫ØÈáçÂ§ç<br>
                                ‚Ä¢ ÂøÖÈ°ªÁõëÊéßÈ™åËØÅÈõÜÈò≤Ê≠¢ËøáÊãüÂêà
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label title="Â≠¶‰π†Áéá„ÄÇÊéßÂà∂Ê®°ÂûãÂèÇÊï∞Êõ¥Êñ∞ÁöÑÊ≠•ÈïøÔºåÊòØËÆ≠ÁªÉ‰∏≠ÊúÄÂÖ≥ÈîÆÁöÑË∂ÖÂèÇÊï∞‰πã‰∏Ä„ÄÇ">Â≠¶‰π†Áéá (learning_rate)</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="text" id="learning_rate" title="Â≠¶‰π†Áéá„ÄÇÊéßÂà∂Ê®°ÂûãÂèÇÊï∞Êõ¥Êñ∞ÁöÑÊ≠•ÈïøÔºåÊòØËÆ≠ÁªÉ‰∏≠ÊúÄÂÖ≥ÈîÆÁöÑË∂ÖÂèÇÊï∞‰πã‰∏Ä„ÄÇ" style="flex: 1;">
                            <button onclick="calculateRecommendedLearningRate()" class="btn" style="background: linear-gradient(45deg, #3498db, #2980b9); color: white; padding: 8px 12px; border: none; border-radius: 6px; font-size: 12px; cursor: pointer; white-space: nowrap; box-shadow: 0 2px 4px rgba(0,0,0,0.2); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 3px 6px rgba(0,0,0,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.2)'">üîß ËΩØ‰ª∂Êé®ËçêÂÄº</button>
                            <button onclick="calculateGPTRecommendedLearningRate()" class="btn" style="background: linear-gradient(45deg, #4ECDC4, #44A08D); color: white; padding: 8px 12px; border: none; border-radius: 6px; font-size: 12px; cursor: pointer; white-space: nowrap; box-shadow: 0 2px 4px rgba(0,0,0,0.2); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 3px 6px rgba(0,0,0,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.2)'">ü§ñ ChatGPTÊé®ËçêÂÄº</button>
                        </div>
                        <div style="margin-top: 5px;">
                            <span style="color: #666; cursor: pointer; user-select: none; display: inline-flex; align-items: center; gap: 5px;" 
                                  onclick="toggleLearningRateRecommendationTip()" 
                                  onmouseover="this.style.color='#3498db'" 
                                  onmouseout="this.style.color='#666'" 
                                  title="ÁÇπÂáªÊü•ÁúãËØ¶ÁªÜÊé®ËçêÈÄªËæë">
                                <span id="lr-tip-icon">üí°</span> <strong>ËΩØ‰ª∂Êé®ËçêÊèêÁ§∫</strong>
                            </span>
                            <span style="color: #666; cursor: pointer; user-select: none; display: inline-flex; align-items: center; gap: 5px; margin-left: 20px;" 
                                  onclick="toggleChatGPTLearningRateRecommendationTip()" 
                                  onmouseover="this.style.color='#4ECDC4'" 
                                  onmouseout="this.style.color='#666'" 
                                  title="ÁÇπÂáªÊü•ÁúãChatGPTÊé®ËçêÈÄªËæë">
                                <span id="chatgpt-lr-tip-icon">ü§ñ</span> <strong>ChatGPTÊé®ËçêÊèêÁ§∫</strong>
                            </span>
                            <div id="lr-recommendation-tip" style="display: none; color: #666; margin-top: 8px; line-height: 1.4; padding: 10px; background: #f8f9fa; border-radius: 6px; border-left: 3px solid #3498db;">
                                <strong>‚öôÔ∏è ËΩØ‰ª∂Êé®ËçêÁÆóÊ≥ïÈÄªËæë</strong><br><br>
                                <strong>üí° Â≠¶‰π†ÁéáÊé®ËçêÔºàÂü∫‰∫éWan2.2ÂÆûÊàòÊ°à‰æãÔºâÔºö</strong><br>
                                ‚Ä¢ <strong>Wan2.2 LoRAËÆ≠ÁªÉ</strong>Ôºö3e-4ÊòØÁªèÈ™åËØÅÁöÑÊúâÊïàÂÄºÔºåÈÄÇÂêàÂ§ßÂ§öÊï∞Âú∫ÊôØ<br>
                                ‚Ä¢ <strong>T2V‰ªªÂä°</strong>Ôºö1e-4 ~ 3e-4ÔºåËßÜÈ¢ëÁîüÊàêÈúÄË¶ÅÊõ¥Á®≥ÂÆöÁöÑÂ≠¶‰π†ËøáÁ®ã<br>
                                ‚Ä¢ <strong>I2V‰ªªÂä°</strong>Ôºö2e-4 ~ 5e-4ÔºåÂõæÂÉèÂà∞ËßÜÈ¢ëËΩ¨Êç¢ÂèØÈÄÇÂΩìÊèêÈ´òÂ≠¶‰π†Áéá<br><br>
                                <strong>üìä ‰ºòÂåñÂô®ÂåπÈÖçÔºàÂÆûÊàòÈ™åËØÅÔºâÔºö</strong><br>
                                ‚Ä¢ <strong>AdamW8bit</strong>Ôºö3e-4ÔºåÂÜÖÂ≠òÂèãÂ•Ω‰∏îÊïàÊûúÁ®≥ÂÆö<br>
                                ‚Ä¢ <strong>Lion</strong>Ôºö1e-4ÔºåÈúÄË¶ÅËæÉÂ∞èÂ≠¶‰π†Áéá‰ΩÜÊî∂ÊïõÊõ¥Âø´<br>
                                ‚Ä¢ <strong>SGD</strong>Ôºö1e-2ÔºåÈúÄË¶ÅÈÖçÂêàÂä®Èáè‰ΩøÁî®<br><br>
                                <strong>üéØ Êï∞ÊçÆÈáèË∞ÉÊï¥Á≠ñÁï•Ôºö</strong><br>
                                ‚Ä¢ Â∞èÊï∞ÊçÆÈõÜ(‚â§20Âº†)ÔºöÈôç‰ΩéËá≥1e-4 ~ 2e-4<br>
                                ‚Ä¢ ‰∏≠Á≠âÊï∞ÊçÆÈõÜ(21-100Âº†)ÔºöÊ†áÂáÜ3e-4<br>
                                ‚Ä¢ Â§ßÊï∞ÊçÆÈõÜ(>100Âº†)ÔºöÂèØÊèêÂçáËá≥5e-4<br>
                                <span id="lr_calculation_result" style="color: #28a745; font-weight: bold;"></span>
                            </div>
                            <div id="chatgpt-lr-recommendation-tip" style="display: none; color: #666; margin-top: 8px; line-height: 1.4; padding: 10px; background: #f0fffe; border-radius: 6px; border-left: 3px solid #4ECDC4;">
                                <strong>ü§ñ ChatGPTÊé®ËçêÁÆóÊ≥ï</strong><br><br>
                                <strong>üìä Ê†∏ÂøÉËÆ°ÁÆóÂÖ¨ÂºèÔºö</strong><br>
                                ‚Ä¢ <strong>Âü∫Á°ÄÂ≠¶‰π†Áéá</strong> = Ê†πÊçÆÊï∞ÊçÆÈõÜÂ§ßÂ∞èÂíå‰ªªÂä°Á±ªÂûãÁ°ÆÂÆö<br>
                                ‚Ä¢ <strong>ËßÜÈ¢ëÊó∂ÈïøË∞ÉÊï¥Âõ†Â≠ê</strong> = max(0.5, min(2.0, 10.0 / ËßÜÈ¢ëÊó∂Èïø))<br>
                                ‚Ä¢ <strong>ÊúÄÁªàÂ≠¶‰π†Áéá</strong> = Âü∫Á°ÄÂ≠¶‰π†Áéá √ó ËßÜÈ¢ëÊó∂ÈïøË∞ÉÊï¥Âõ†Â≠ê<br><br>
                                <strong>üéØ I2V‰∏éT2VÂ∑ÆÂºÇÂåñÁ≠ñÁï•Ôºö</strong><br>
                                ‚Ä¢ <strong>I2VÔºàÂõæÁîüËßÜÈ¢ëÔºâ</strong>ÔºöÊõ¥‰øùÂÆàÁöÑÂ≠¶‰π†ÁéáÔºåÈÅøÂÖçÂØπËæìÂÖ•ÂõæÂÉèËøáÊãüÂêà<br>
                                &nbsp;&nbsp;- Â∞èÊï∞ÊçÆÈõÜÔºö1e-5Ôºå‰∏≠Á≠âÔºö1.5e-5ÔºåÂ§ßÊï∞ÊçÆÈõÜÔºö2e-5ÔºåË∂ÖÂ§ßÔºö2.5e-5<br>
                                ‚Ä¢ <strong>T2VÔºàÊñáÁîüËßÜÈ¢ëÔºâ</strong>ÔºöÁõ∏ÂØπÊõ¥È´òÁöÑÂ≠¶‰π†ÁéáÔºåÂª∫Ê®°ÊñáÊú¨Âà∞ËßÜÈ¢ëÊò†Â∞Ñ<br>
                                &nbsp;&nbsp;- Â∞èÊï∞ÊçÆÈõÜÔºö2e-5Ôºå‰∏≠Á≠âÔºö3e-5ÔºåÂ§ßÊï∞ÊçÆÈõÜÔºö4e-5ÔºåË∂ÖÂ§ßÔºö5e-5<br><br>
                                <strong>‚ö†Ô∏è ÈáçË¶ÅÊèêÈÜíÔºö</strong><br>
                                ‚Ä¢ ‰ºòÂåñÂô®Á±ªÂûã‰ºöÂΩ±ÂìçÊúÄÁªàÊé®ËçêÂÄº<br>
                                ‚Ä¢ LoRA rankË∂äÈ´òÔºåÂª∫ËÆÆÂ≠¶‰π†ÁéáÈÄÇÂΩìÈôç‰Ωé<br>
                                ‚Ä¢ ËßÜÈ¢ëÊó∂ÈïøËøáÁü≠ÊàñËøáÈïøÈÉΩÈúÄË¶ÅË∞ÉÊï¥Â≠¶‰π†Áéá<br>
                                <span id="chatgpt_lr_calculation_result" style="color: #28a745; font-weight: bold;"></span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Êô∫ËÉΩÂèÇÊï∞Êé®ËçêÊåâÈíÆÁªÑ -->
                    <div style="margin: 15px 0;">
                        <!-- ÊåâÈíÆË°å -->
                        <div style="display: flex; gap: 8px; justify-content: center; align-items: center; flex-wrap: wrap;">
                            <button onclick="calculateChatGPTRecommendedParams()" class="btn" style="background: linear-gradient(45deg, #FF6B6B, #FF8E53); color: white; padding: 10px 16px; border: none; border-radius: 8px; font-size: 13px; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.2); transition: all 0.3s ease; font-weight: bold; flex: 1; min-width: 160px; max-width: 180px;" title="‰∏ÄÈîÆChatGPTÊé®ËçêÊâÄÊúâËÆ≠ÁªÉÂèÇÊï∞">
                                ü§ñ ‰∏ÄÈîÆ ChatGPT Êé®Ëçê
                            </button>
                            <button onclick="calculateDoubaoRecommendedParams()" class="btn" style="background: linear-gradient(45deg, #4A90E2, #7B68EE); color: white; padding: 10px 16px; border: none; border-radius: 8px; font-size: 13px; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.2); transition: all 0.3s ease; font-weight: bold; flex: 1; min-width: 160px; max-width: 180px;" title="‰∏ÄÈîÆË±ÜÂåÖÊé®ËçêÊâÄÊúâËÆ≠ÁªÉÂèÇÊï∞">
                                üß† ‰∏ÄÈîÆË±ÜÂåÖÊé®Ëçê
                            </button>
                            <button onclick="calculateSoftwareRecommendedParams()" class="btn" style="background: linear-gradient(45deg, #28A745, #20C997); color: white; padding: 10px 16px; border: none; border-radius: 8px; font-size: 13px; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.2); transition: all 0.3s ease; font-weight: bold; flex: 1; min-width: 160px; max-width: 180px;" title="‰∏ÄÈîÆËΩØ‰ª∂Êé®ËçêÊâÄÊúâËÆ≠ÁªÉÂèÇÊï∞">
                                ‚öôÔ∏è ‰∏ÄÈîÆËΩØ‰ª∂Êé®Ëçê
                            </button>
                        </div>
                        
                        <!-- ÁªìÊûúÊòæÁ§∫Âå∫Âüü -->
                        <div id="chatgpt_params_result" style="margin-top: 8px; font-size: 12px; color: #666; line-height: 1.4; padding: 8px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #007bff; display: none;">
                            <!-- ChatGPTÊé®ËçêÁªìÊûúÂ∞ÜÊòæÁ§∫Âú®ËøôÈáå -->
                        </div>
                        <div id="doubao_params_result" style="margin-top: 8px; font-size: 12px; color: #666; line-height: 1.4; padding: 8px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #4A90E2; display: none;">
                            <!-- Ë±ÜÂåÖÊé®ËçêÁªìÊûúÂ∞ÜÊòæÁ§∫Âú®ËøôÈáå -->
                        </div>
                        <div id="software_params_result" style="margin-top: 8px; font-size: 12px; color: #666; line-height: 1.4; padding: 8px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #28A745; display: none;">
                            <!-- ËΩØ‰ª∂Êé®ËçêÁªìÊûúÂ∞ÜÊòæÁ§∫Âú®ËøôÈáå -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label title="LoRAÁª¥Â∫¶„ÄÇÊéßÂà∂‰ΩéÁß©Áü©ÈòµÁöÑÁª¥Â∫¶ÔºåÂΩ±ÂìçÊ®°ÂûãÂÆπÈáè„ÄÇ">LoRAÁª¥Â∫¶ (network_dim)</label>
                        <input type="number" id="network_dim" min="4" max="128" title="LoRAÁª¥Â∫¶„ÄÇÊéßÂà∂‰ΩéÁß©Áü©ÈòµÁöÑÁª¥Â∫¶ÔºåÂΩ±ÂìçÊ®°ÂûãÂÆπÈáè„ÄÇ">
                        <small style="color: #666; display: block; margin-top: 5px; line-height: 1.4;">
                            üí° <strong>GPTÊé®ËçêÂÄºÔºö</strong><br>
                            ‚Ä¢ <strong>Â∞èÊï∞ÊçÆÈõÜ(‚â§20Âº†)</strong>Ôºö16-32ÔºåÈò≤Ê≠¢ËøáÊãüÂêà<br>
                            ‚Ä¢ <strong>‰∏≠Á≠âÊï∞ÊçÆÈõÜ(21-100Âº†)</strong>Ôºö32-64ÔºåÂπ≥Ë°°ÊïàÊûúÂíåËÆ≠ÁªÉÁ®≥ÂÆöÊÄß<br>
                            ‚Ä¢ <strong>Â§ßÊï∞ÊçÆÈõÜ(>100Âº†)</strong>Ôºö64-128ÔºåÂÖÖÂàÜÂ≠¶‰π†Â§çÊùÇÁâπÂæÅ<br>
                            ‚Ä¢ <strong>ËßÜÈ¢ëËÆ≠ÁªÉ</strong>ÔºöÈÄöÂ∏∏ÈúÄË¶ÅÊØîÂõæÁâáËÆ≠ÁªÉÊõ¥È´òÁöÑÁª¥Â∫¶<br>
                        </small>
                    </div>
                    
                    <div class="form-group">
                        <label title="ÁΩëÁªúAlphaÂÄº„ÄÇÊéßÂà∂LoRAÊùÉÈáçÁº©Êîæ„ÄÇ">ÁΩëÁªúAlpha (network_alpha)</label>
                        <input type="number" id="network_alpha" min="1" max="1024" value="32" title="ÁΩëÁªúAlphaÂÄº„ÄÇÊéßÂà∂LoRAÊùÉÈáçÁº©Êîæ„ÄÇ">
                        <small style="color: #666; display: block; margin-top: 5px; line-height: 1.4;">
                            üí° <strong>GPTÊé®ËçêÂÄºÔºö</strong><br>
                            ‚Ä¢ <strong>ÁªèÂÖ∏ÈÖçÊØî</strong>ÔºöAlpha = DimÔºå‰øùÊåÅ1:1ÊØî‰æãÊòØÊúÄÁ®≥ÂÆöÁöÑÈÄâÊã©<br>
                            ‚Ä¢ <strong>‰øùÂÆàÈÖçÁΩÆ</strong>ÔºöAlpha = Dim/2ÔºåÈôç‰ΩéÂ≠¶‰π†Âº∫Â∫¶ÔºåÈÄÇÂêàÁ≤æÁªÜË∞ÉÊï¥<br>
                            ‚Ä¢ <strong>Â∏∏Áî®ÁªÑÂêà</strong>ÔºöDim=32Êó∂Alpha=16-32ÔºåDim=64Êó∂Alpha=32-64<br>
                        </small>
                    </div>
                    
                    <div class="form-group">
                        <label title="ÊúÄÂ§ßËÆ≠ÁªÉËΩÆÊï∞„ÄÇÊéßÂà∂ËÆ≠ÁªÉÁöÑÊÄªËΩÆÊï∞„ÄÇ">ÊúÄÂ§ßËÆ≠ÁªÉËΩÆÊï∞ (max_train_epochs)</label>
                        <input type="number" id="max_train_epochs" min="1" max="100" title="ÊúÄÂ§ßËÆ≠ÁªÉËΩÆÊï∞„ÄÇÊéßÂà∂ËÆ≠ÁªÉÁöÑÊÄªËΩÆÊï∞„ÄÇ">
                        <small style="color: #666; display: block; margin-top: 5px; line-height: 1.4;">
                            üí° <strong>GPTÊé®ËçêÂÄºÔºö</strong><br>
                            ‚Ä¢ <strong>Â∞èÊï∞ÊçÆÈõÜ(‚â§20Âº†)</strong>Ôºö200-400ËΩÆÔºåÈúÄË¶ÅÊõ¥Â§öËΩÆÊ¨°Â≠¶‰π†ÁâπÂæÅ<br>
                            ‚Ä¢ <strong>‰∏≠Á≠âÊï∞ÊçÆÈõÜ(21-100Âº†)</strong>Ôºö100-200ËΩÆÔºåÂπ≥Ë°°ÊïàÊûúÂíåÊïàÁéá<br>
                            ‚Ä¢ <strong>Â§ßÊï∞ÊçÆÈõÜ(>100Âº†)</strong>Ôºö50-100ËΩÆÔºåÈÅøÂÖçËøáÂ∫¶ËÆ≠ÁªÉ<br>
                            ‚Ä¢ <strong>ËßÜÈ¢ëËÆ≠ÁªÉ</strong>ÔºöÈÄöÂ∏∏ÈúÄË¶ÅÊØîÂõæÁâáËÆ≠ÁªÉÊõ¥Â§öÁöÑËΩÆÊï∞<br>
                            ‚Ä¢ Âª∫ËÆÆÁõëÊéßÊçüÂ§±Êõ≤Á∫øÔºåÂú®È™åËØÅÊçüÂ§±‰∏çÂÜç‰∏ãÈôçÊó∂ÊèêÂâçÂÅúÊ≠¢<br>
                        </small>
                    </div>
                    
                    <!-- È´òÁ∫ßÂèÇÊï∞ÊäòÂè†Âå∫Âüü -->
                    <div class="collapsible-section">
                        <button type="button" class="collapsible-header" onclick="toggleSection('advanced-params')">
                            <span>‚öôÔ∏è È´òÁ∫ßÂèÇÊï∞ (ÂèØÈÄâ)</span>
                            <span class="toggle-icon" id="advanced-toggle-icon">‚ñº</span>
                        </button>
                        <div class="collapsible-content" id="advanced-params">
                            
                            <div class="form-group">
                                <label title="ÊØèNËΩÆ‰øùÂ≠ò‰∏ÄÊ¨°Ê®°ÂûãÊ£ÄÊü•ÁÇπ„ÄÇ">ÊØèNËΩÆ‰øùÂ≠ò (save_every_n_epochs)</label>
                                <input type="number" id="save_every_n_epochs" min="1" max="10" title="ÊØèNËΩÆ‰øùÂ≠ò‰∏ÄÊ¨°Ê®°ÂûãÊ£ÄÊü•ÁÇπ„ÄÇ">
                                <small style="color: #666; display: block; margin-top: 5px;">üí° Êé®ËçêÂÄºÔºö5ÔºåÂπ≥Ë°°Â≠òÂÇ®Á©∫Èó¥ÂíåÊ£ÄÊü•ÁÇπÊï∞Èáè</small>
                            </div>
                            
                            <div class="form-group">
                                <label title="ÈöèÊú∫ÁßçÂ≠ê„ÄÇÁ°Æ‰øùËÆ≠ÁªÉÁªìÊûúÂèØÂ§çÁé∞„ÄÇ">ÈöèÊú∫ÁßçÂ≠ê (seed)</label>
                                <input type="number" id="seed" min="0" title="ÈöèÊú∫ÁßçÂ≠ê„ÄÇÁ°Æ‰øùËÆ≠ÁªÉÁªìÊûúÂèØÂ§çÁé∞„ÄÇ">
                                <small style="color: #666; display: block; margin-top: 5px;">üí° Êé®ËçêÂÄºÔºö42ÔºåÂõ∫ÂÆöÁßçÂ≠êÁ°Æ‰øùÁªìÊûúÂèØÂ§çÁé∞</small>
                            </div>
                            
                            <div class="form-group">
                                <label title="Ê∑∑ÂêàÁ≤æÂ∫¶ËÆ≠ÁªÉ„ÄÇËäÇÁúÅÊòæÂ≠ò‰∏î‰øùÊåÅËÆ≠ÁªÉÁ≤æÂ∫¶„ÄÇ">Ê∑∑ÂêàÁ≤æÂ∫¶ (mixed_precision)</label>
                                <select id="mixed_precision" title="Ê∑∑ÂêàÁ≤æÂ∫¶ËÆ≠ÁªÉ„ÄÇËäÇÁúÅÊòæÂ≠ò‰∏î‰øùÊåÅËÆ≠ÁªÉÁ≤æÂ∫¶„ÄÇ">
                                    <option value="bf16" selected>bf16</option>
                                    <option value="fp16">fp16</option>
                                    <option value="no">no</option>
                                </select>
                                <small style="color: #666; display: block; margin-top: 5px;">üí° Êé®ËçêÂÄºÔºöbf16ÔºåÊúÄ‰Ω≥ÊÄßËÉΩÂíåÁ®≥ÂÆöÊÄßÂπ≥Ë°°</small>
                            </div>
                            

                            
                            <div class="form-group">
                                <label title="‰ºòÂåñÂô®Á±ªÂûã„ÄÇ">‰ºòÂåñÂô® (optimizer_type)</label>
                                <select id="optimizer_type" title="‰ºòÂåñÂô®Á±ªÂûã„ÄÇ">
                                    <option value="adamw8bit" selected>adamw8bit</option>
                                    <option value="AdamW">AdamW</option>
                                    <option value="Lion">Lion</option>
                                    <option value="SGDNesterov">SGDNesterov</option>
                                    <option value="Adafactor">Adafactor</option>
                                </select>
                                <small style="color: #666; display: block; margin-top: 5px;">üí° Êé®ËçêÂÄºÔºöadamw8bitÔºåËäÇÁúÅÂÜÖÂ≠ò</small>
                            </div>
                            
                            <div class="form-group">
                                <label title="Êó∂Èó¥Ê≠•ÈááÊ†∑ÊñπÊ≥ï„ÄÇ">Êó∂Èó¥Ê≠•ÈááÊ†∑ (timestep_sampling)</label>
                                <select id="timestep_sampling" title="Êó∂Èó¥Ê≠•ÈááÊ†∑ÊñπÊ≥ï„ÄÇ">
                                    <option value="shift" selected>shift</option>
                                    <option value="uniform">uniform</option>
                                    <option value="sigma">sigma</option>
                                    <option value="sigmoid">sigmoid</option>
                                </select>
                                <small style="color: #666; display: block; margin-top: 5px;">üí° Êé®ËçêÂÄºÔºöshiftÔºåÈÄÇÁî®‰∫éWan2.2Ê®°Âûã</small>
                            </div>
                            
                            <div class="form-group">
                                <label title="ËÆ≠ÁªÉ‰ªªÂä°Á±ªÂûã„ÄÇÊ†πÊçÆÈÄâÊã©ÁöÑ‰ªªÂä°Á±ªÂûãËá™Âä®ËÆæÁΩÆ„ÄÇ">‰ªªÂä°Á±ªÂûã (task)</label>
                                <input type="text" id="task" value="t2v-A14B" readonly title="ËÆ≠ÁªÉ‰ªªÂä°Á±ªÂûã„ÄÇÊ†πÊçÆÈÄâÊã©ÁöÑ‰ªªÂä°Á±ªÂûãËá™Âä®ËÆæÁΩÆ„ÄÇ">
                                <small style="color: #666; display: block; margin-top: 5px;">üí° Ëá™Âä®ËÆæÁΩÆÔºöT2V‰∏∫t2v-A14BÔºåI2V‰∏∫i2v-A14B</small>
                            </div>
                            
                            <div class="form-group">
                                <label title="ÊçüÂ§±ÊùÉÈáçÊñπÊ°à„ÄÇÂÆòÊñπÊé®ËçêÈªòËÆ§ÂÄºÔºönone„ÄÇ">ÊùÉÈáçÊñπÊ°à (weighting_scheme)</label>
                                <select id="weighting_scheme" title="ÊçüÂ§±ÊùÉÈáçÊñπÊ°à„ÄÇÂÆòÊñπÊé®ËçêÈªòËÆ§ÂÄºÔºönone„ÄÇ">
                                    <option value="none" selected>none</option>
                                    <option value="logit_normal">logit_normal</option>
                                    <option value="mode">mode</option>
                                    <option value="cosmap">cosmap</option>
                                    <option value="sigma_sqrt">sigma_sqrt</option>
                                </select>
                                <small style="color: #666; display: block; margin-top: 5px;">üí° Êé®ËçêÂÄºÔºönoneÔºåÂÆòÊñπÈªòËÆ§ÊùÉÈáçÊñπÊ°à</small>
                            </div>
                            
                            <div class="form-group">
                                <label title="Êó•ÂøóÁõÆÂΩïË∑ØÂæÑ„ÄÇÂ≠òÂÇ®ËÆ≠ÁªÉÊó•ÂøóÂíåTensorBoardÊï∞ÊçÆ„ÄÇ">Êó•ÂøóÁõÆÂΩï (logging_dir)</label>
                                <input type="text" id="logging_dir" title="Êó•ÂøóÁõÆÂΩïË∑ØÂæÑ„ÄÇÂ≠òÂÇ®ËÆ≠ÁªÉÊó•ÂøóÂíåTensorBoardÊï∞ÊçÆ„ÄÇ">
                                <small style="color: #666; display: block; margin-top: 5px;">üí° Âª∫ËÆÆÂÄºÔºö./logsÔºåÁî®‰∫éÂ≠òÂÇ®TensorBoardÊó•Âøó</small>
                            </div>
                            
                            <div class="form-group">
                                <label title="Êó•ÂøóËÆ∞ÂΩïÂ∑•ÂÖ∑ - ÂÆòÊñπÈªòËÆ§Ôºötensorboard„ÄÇ">Êó•ÂøóÂ∑•ÂÖ∑ (log_with)</label>
                                <select id="log_with" title="Êó•ÂøóËÆ∞ÂΩïÂ∑•ÂÖ∑ - ÂÆòÊñπÈªòËÆ§Ôºötensorboard„ÄÇ">
                                    <option value="tensorboard" selected>tensorboard</option>
                                    <option value="wandb">wandb</option>
                                    <option value="all">all</option>
                                </select>
                                <small style="color: #666; display: block; margin-top: 5px;">üí° ÂÆòÊñπÊé®ËçêÔºötensorboardÔºåÂèØËßÜÂåñËÆ≠ÁªÉËøáÁ®ã</small>
                            </div>
                            
                            <div class="form-group">
                                <label title="ÂêØÁî®FP8Âü∫Á°ÄÊ®°ÂûãÈáèÂåñ„ÄÇËäÇÁúÅÊòæÂ≠òÔºåÊèêÂçáËÆ≠ÁªÉÊïàÁéá„ÄÇ">FP8Âü∫Á°ÄÈáèÂåñ (fp8_base)</label>
                                <input type="checkbox" id="fp8_base" checked title="ÂêØÁî®FP8Âü∫Á°ÄÊ®°ÂûãÈáèÂåñ„ÄÇËäÇÁúÅÊòæÂ≠òÔºåÊèêÂçáËÆ≠ÁªÉÊïàÁéá„ÄÇ">
                                <small style="color: #666; display: block; margin-top: 5px;">üí° Êé®ËçêÔºöÂºÄÂêØÔºåÊòæËëóËäÇÁúÅÊòæÂ≠òÂç†Áî®</small>
                            </div>
                            
                            <div class="form-group">
                                <label title="T5ÁºñÁ†ÅÂô®‰ΩøÁî®FP8Á≤æÂ∫¶„ÄÇËäÇÁúÅT5ÁºñÁ†ÅÂô®ÊòæÂ≠òÂç†Áî®„ÄÇ">T5ÁºñÁ†ÅÂô®FP8 (fp8_t5)</label>
                                <input type="checkbox" id="fp8_t5" title="T5ÁºñÁ†ÅÂô®‰ΩøÁî®FP8Á≤æÂ∫¶„ÄÇËäÇÁúÅT5ÁºñÁ†ÅÂô®ÊòæÂ≠òÂç†Áî®„ÄÇ">
                                <small style="color: #666; display: block; margin-top: 5px;">üí° ÂèØÈÄâÔºöËøõ‰∏ÄÊ≠•ËäÇÁúÅT5ÁºñÁ†ÅÂô®ÊòæÂ≠ò</small>
                            </div>
                            
                            <div class="form-group">
                                <label title="‰ΩøÁî®Áº©ÊîæFP8Á≤æÂ∫¶„ÄÇËøõ‰∏ÄÊ≠•ËäÇÁúÅÊòæÂ≠òÔºåÈúÄË¶ÅÊîØÊåÅÁöÑÁ°¨‰ª∂„ÄÇ">Áº©ÊîæFP8Á≤æÂ∫¶ (fp8_scaled)</label>
                                <input type="checkbox" id="fp8_scaled" title="‰ΩøÁî®Áº©ÊîæFP8Á≤æÂ∫¶„ÄÇËøõ‰∏ÄÊ≠•ËäÇÁúÅÊòæÂ≠òÔºåÈúÄË¶ÅÊîØÊåÅÁöÑÁ°¨‰ª∂„ÄÇ">
                                <small style="color: #666; display: block; margin-top: 5px;">üí° È´òÁ∫ßÔºöÈúÄË¶ÅÊîØÊåÅFP8ÁöÑÁ°¨‰ª∂</small>
                            </div>
                            
                            <div class="form-group">
                                <label title="Êó∂Èó¥Ê≠•ËæπÁïå„ÄÇT2VÈªòËÆ§875ÔºåI2VÈªòËÆ§900ÔºåÁî®‰∫éÂàáÊç¢È´ò‰ΩéÂô™Â£∞Ê®°Âûã„ÄÇ">Êó∂Èó¥Ê≠•ËæπÁïå (timestep_boundary)</label>
                                <input type="number" id="timestep_boundary" min="0" max="1000" value="875" title="Êó∂Èó¥Ê≠•ËæπÁïå„ÄÇT2VÈªòËÆ§875ÔºåI2VÈªòËÆ§900ÔºåÁî®‰∫éÂàáÊç¢È´ò‰ΩéÂô™Â£∞Ê®°Âûã„ÄÇ">
                                <small style="color: #666; display: block; margin-top: 5px;">üí° T2VÈªòËÆ§875ÔºåI2VÈªòËÆ§900</small>
                            </div>
                            
                            <div class="form-group">
                                <label title="È´òÂô™Â£∞DiTÊ®°ÂûãË∑ØÂæÑ„ÄÇÁî®‰∫éÈ´òÂô™Â£∞Êó∂Èó¥Ê≠•ÁöÑDiTÊ®°ÂûãÔºå‰∏éditÈÖçÂêà‰ΩøÁî®„ÄÇ">È´òÂô™Â£∞DiTÊ®°Âûã (dit_high_noise)</label>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <input type="text" id="dit_high_noise" title="È´òÂô™Â£∞DiTÊ®°ÂûãË∑ØÂæÑ„ÄÇÁî®‰∫éÈ´òÂô™Â£∞Êó∂Èó¥Ê≠•ÁöÑDiTÊ®°ÂûãÔºå‰∏éditÈÖçÂêà‰ΩøÁî®„ÄÇ" style="flex: 1;">
                                    <button type="button" onclick="selectFileWithDialog('dit_high_noise')" class="btn" style="padding: 8px 12px; font-size: 12px;">üìÅ ÈÄâÊã©</button>
                                </div>
                                <small style="color: #666; display: block; margin-top: 5px;">üí° ÂèØÈÄâÔºöÁî®‰∫éÈ´òÂô™Â£∞Êó∂Èó¥Ê≠•ÁöÑDiTÊ®°Âûã</small>
                            </div>
                            
                            <div class="form-group">
                                <label title="ÂêØÁî®Ê¢ØÂ∫¶Ê£ÄÊü•ÁÇπ„ÄÇËäÇÁúÅÊòæÂ≠ò„ÄÇ">Ê¢ØÂ∫¶Ê£ÄÊü•ÁÇπ (gradient_checkpointing)</label>
                                <input type="checkbox" id="gradient_checkpointing" checked title="ÂêØÁî®Ê¢ØÂ∫¶Ê£ÄÊü•ÁÇπ„ÄÇËäÇÁúÅÊòæÂ≠ò„ÄÇ">
                                <small style="color: #666; display: block; margin-top: 5px;">üí° Êé®ËçêÔºöÂºÄÂêØÔºåËäÇÁúÅÊòæÂ≠ò</small>
                            </div>
                            
                            <div class="form-group">
                                <label title="Á¶ªÊï£ÊµÅÂÅèÁßª„ÄÇT2VÊé®Ëçê12.0ÔºåI2VÊé®Ëçê5.0„ÄÇ">Á¶ªÊï£ÊµÅÂÅèÁßª (discrete_flow_shift)</label>
                                <input type="number" id="discrete_flow_shift" step="0.1" min="0" value="12.0" title="Á¶ªÊï£ÊµÅÂÅèÁßª„ÄÇT2VÊé®Ëçê12.0ÔºåI2VÊé®Ëçê5.0„ÄÇ">
                                <small style="color: #666; display: block; margin-top: 5px;">üí° T2V: 12.0, I2V: 5.0</small>
                            </div>
                            
                            <div class="form-group">
                                <label title="ÊúÄÂ∞èÊó∂Èó¥Ê≠•„ÄÇÈªòËÆ§0„ÄÇ">ÊúÄÂ∞èÊó∂Èó¥Ê≠• (min_timestep)</label>
                                <input type="number" id="min_timestep" min="0" max="1000" value="0" title="ÊúÄÂ∞èÊó∂Èó¥Ê≠•„ÄÇÈªòËÆ§0„ÄÇ">
                            </div>
                            
                            <div class="form-group">
                                <label title="ÊúÄÂ§ßÊó∂Èó¥Ê≠•„ÄÇÈªòËÆ§1000„ÄÇ">ÊúÄÂ§ßÊó∂Èó¥Ê≠• (max_timestep)</label>
                                <input type="number" id="max_timestep" min="0" max="1000" value="1000" title="ÊúÄÂ§ßÊó∂Èó¥Ê≠•„ÄÇÈªòËÆ§1000„ÄÇ">
                            </div>
                            
                            <div class="form-group">
                                <label title="ÁΩëÁªúÊ®°Âùó„ÄÇÈªòËÆ§networks.lora_wan„ÄÇ">ÁΩëÁªúÊ®°Âùó (network_module)</label>
                                <input type="text" id="network_module" value="networks.lora_wan" title="ÁΩëÁªúÊ®°Âùó„ÄÇÈªòËÆ§networks.lora_wan„ÄÇ">
                            </div>
                            

                            
                            <div class="form-group">
                                <label title="Êï∞ÊçÆÂä†ËΩΩÂô®Â∑•‰ΩúËøõÁ®ãÊï∞„ÄÇÈªòËÆ§2„ÄÇ">Êï∞ÊçÆÂä†ËΩΩÂô®Â∑•‰ΩúËøõÁ®ãÊï∞ (max_data_loader_n_workers)</label>
                                <input type="number" id="max_data_loader_n_workers" min="0" value="2" title="Êï∞ÊçÆÂä†ËΩΩÂô®Â∑•‰ΩúËøõÁ®ãÊï∞„ÄÇÈªòËÆ§2„ÄÇ">
                            </div>
                            
                            <div class="form-group">
                                <label title="ÊåÅ‰πÖÂåñÊï∞ÊçÆÂä†ËΩΩÂô®„ÄÇÈªòËÆ§ÂÖ≥Èó≠„ÄÇ">ÊåÅ‰πÖÂåñÊï∞ÊçÆÂä†ËΩΩÂô® (persistent_data_loader_workers)</label>
                                <input type="checkbox" id="persistent_data_loader_workers" title="ÊåÅ‰πÖÂåñÊï∞ÊçÆÂä†ËΩΩÂô®„ÄÇÈªòËÆ§ÂÖ≥Èó≠„ÄÇ">
                                <small style="color: #666; display: block; margin-top: 5px;">üí° ÂèØÈÄâÔºöÂºÄÂêØÂèØËÉΩÊèêÂçáÊï∞ÊçÆÂä†ËΩΩÊïàÁéá</small>
                            </div>
                            
                            <div class="form-group">
                                <label title="ÂêØÁî®SDPAÊ≥®ÊÑèÂäõÊú∫Âà∂„ÄÇÊé®ËçêÂºÄÂêØ„ÄÇ">SDPA (sdpa)</label>
                                <input type="checkbox" id="sdpa" checked title="ÂêØÁî®SDPAÊ≥®ÊÑèÂäõÊú∫Âà∂„ÄÇÊé®ËçêÂºÄÂêØ„ÄÇ">
                            </div>
                            
                            <div class="form-group">
                                <label title="VAEÁºìÂ≠òÂà∞CPU„ÄÇËäÇÁúÅÊòæÂ≠ò‰ΩÜÂΩ±ÂìçÈÄüÂ∫¶„ÄÇ">VAEÁºìÂ≠òÂà∞CPU (vae_cache_cpu)</label>
                                <input type="checkbox" id="vae_cache_cpu" title="VAEÁºìÂ≠òÂà∞CPU„ÄÇËäÇÁúÅÊòæÂ≠ò‰ΩÜÂΩ±ÂìçÈÄüÂ∫¶„ÄÇ">
                                <small style="color: #666; display: block; margin-top: 5px;">üí° ÊèêÁ§∫ÔºöÂºÄÂêØÂèØËäÇÁúÅÊòæÂ≠ò‰ΩÜ‰ºöÂΩ±ÂìçÈÄüÂ∫¶</small>
                            </div>
                            
                            <div class="form-group">
                                <label title="ÂÜÖÂ≠ò‰ºòÂåñÁ≠ñÁï•„ÄÇ‰∏§‰∏™ÈÄâÈ°π‰∫íÊñ•ÔºåÂè™ËÉΩÈÄâÊã©ÂÖ∂‰∏≠‰∏Ä‰∏™„ÄÇ">ÂÜÖÂ≠ò‰ºòÂåñÁ≠ñÁï•</label>
                                <select id="memory_optimization_strategy" title="ÈÄâÊã©ÂÜÖÂ≠ò‰ºòÂåñÁ≠ñÁï•„ÄÇoffload_inactive_ditÂç∏ËΩΩÈùûÊ¥ªË∑ÉDiTÂà∞CPUÔºåblocks_to_swap‰∫§Êç¢ÊåáÂÆöÊï∞ÈáèÁöÑÂùóÂà∞CPU„ÄÇ">
                                    <option value="offload_inactive_dit" selected>Âç∏ËΩΩÈùûÊ¥ªË∑ÉDiT (offload_inactive_dit)</option>
                                    <option value="blocks_to_swap">Âùó‰∫§Êç¢ (blocks_to_swap)</option>
                                </select>
                                <small style="color: #666; display: block; margin-top: 5px;">üí° ÈªòËÆ§Êé®ËçêÔºöoffload_inactive_ditÔºåÈÄÇÂêàÂ§ßÂ§öÊï∞ÈÖçÁΩÆ</small>
                            </div>
                            
                            <div class="form-group" id="blocks_to_swap_config" style="display: none;">
                                <label title="‰∫§Êç¢Âà∞CPUÁöÑÂùóÊï∞Èáè„ÄÇÂú®VRAMÂíåÂÜÖÂ≠òÈó¥‰∫§Êç¢Ê®°ÂûãÂùó‰ª•ËäÇÁúÅÊòæÂ≠ò„ÄÇ">Âùó‰∫§Êç¢Êï∞Èáè</label>
                                <input type="number" id="blocks_to_swap" min="0" max="40" value="20" title="‰∫§Êç¢Âà∞CPUÁöÑÂùóÊï∞Èáè„ÄÇÂú®VRAMÂíåÂÜÖÂ≠òÈó¥‰∫§Êç¢Ê®°ÂûãÂùó‰ª•ËäÇÁúÅÊòæÂ≠ò„ÄÇ">
                                <small style="color: #666; display: block; margin-top: 5px;">üí° Êé®ËçêÂÄºÔºö20ÔºåÈÄÇÂêà4090+98GÂÜÖÂ≠òÈÖçÁΩÆ</small>
                            </div>
                            
                            <div class="form-group">
                                <label title="ÊØè‰∏™ËøõÁ®ãÁöÑCPUÁ∫øÁ®ãÊï∞„ÄÇÈªòËÆ§1„ÄÇ">CPUÁ∫øÁ®ãÊï∞ (num_cpu_threads_per_process)</label>
                                <input type="number" id="num_cpu_threads_per_process" min="1" value="1" title="ÊØè‰∏™ËøõÁ®ãÁöÑCPUÁ∫øÁ®ãÊï∞„ÄÇÈªòËÆ§1„ÄÇ">
                            </div>
                            
                            <!-- Êñ≠ÁÇπÁª≠ËÆ≠ÈÄâÈ°π -->
                            <div class="form-group">
                                <label title="ÂºÄÂêØÂêéÂç†Áî®Â§ßÈáèÁ£ÅÁõòÁ©∫Èó¥ÔºåÂèØÂÆûÁé∞ÁúüÊ≠£ÁöÑÊñ≠ÁÇπÁª≠ËÆ≠Ôºå‰øùÂ≠òÂÆåÊï¥ËÆ≠ÁªÉÁä∂ÊÄÅ„ÄÇ">
                                    <input type="checkbox" id="save_state" title="ÂºÄÂêØÂêéÂç†Áî®Â§ßÈáèÁ£ÅÁõòÁ©∫Èó¥ÔºåÂèØÂÆûÁé∞ÁúüÊ≠£ÁöÑÊñ≠ÁÇπÁª≠ËÆ≠Ôºå‰øùÂ≠òÂÆåÊï¥ËÆ≠ÁªÉÁä∂ÊÄÅ„ÄÇ" style="margin-right: 8px;">
                                    ‰øùÂ≠òËÆ≠ÁªÉÁä∂ÊÄÅ (save_state)
                                </label>
                                <small style="color: #666; display: block; margin-top: 5px;">üí° ÂºÄÂêØÂêéÂç†Áî®Â§ßÈáèÁ£ÅÁõòÁ©∫Èó¥ÔºåÂèØÂÆûÁé∞ÁúüÊ≠£ÁöÑÊñ≠ÁÇπÁª≠ËÆ≠Ôºå‰øùÂ≠òÂÆåÊï¥ËÆ≠ÁªÉÁä∂ÊÄÅ</small>
                            </div>
                            
                            <div class="form-group">
                                <label title="‰ªé‰∏äÊ¨°ËÆ≠ÁªÉÁä∂ÊÄÅÊÅ¢Â§çÔºåÈúÄ‰øÆÊîπËΩÆÊï∞ÔºàÂ¶Ç‰πãÂâçËÆ≠ÁªÉ10ËΩÆÔºå5ËΩÆ‰∏≠Êñ≠ÔºåÈúÄÊîπ‰∏∫5ËΩÆ‰ª•ÂÆåÊàêÂâ©‰ΩôËÆ≠ÁªÉÔºå‰∏çÂèØÂÜçÁî®10ËΩÆÔºâ„ÄÇ">
                                    <input type="checkbox" id="resume_training" onchange="toggleResumeOptions()" title="‰ªé‰∏äÊ¨°ËÆ≠ÁªÉÁä∂ÊÄÅÊÅ¢Â§çÔºåÈúÄ‰øÆÊîπËΩÆÊï∞ÔºàÂ¶Ç‰πãÂâçËÆ≠ÁªÉ10ËΩÆÔºå5ËΩÆ‰∏≠Êñ≠ÔºåÈúÄÊîπ‰∏∫5ËΩÆ‰ª•ÂÆåÊàêÂâ©‰ΩôËÆ≠ÁªÉÔºå‰∏çÂèØÂÜçÁî®10ËΩÆÔºâ„ÄÇ" style="margin-right: 8px;">
                                    ÊÅ¢Â§çËÆ≠ÁªÉÁä∂ÊÄÅ (resume)
                                </label>
                                <small style="color: #666; display: block; margin-top: 5px;">üí° ‰ªé‰∏äÊ¨°ËÆ≠ÁªÉÁä∂ÊÄÅÊÅ¢Â§çÔºåÈúÄ‰øÆÊîπËΩÆÊï∞ÔºàÂ¶Ç‰πãÂâçËÆ≠ÁªÉ10ËΩÆÔºå5ËΩÆ‰∏≠Êñ≠ÔºåÈúÄÊîπ‰∏∫5ËΩÆ‰ª•ÂÆåÊàêÂâ©‰ΩôËÆ≠ÁªÉÔºå‰∏çÂèØÂÜçÁî®10ËΩÆÔºâ‰πüÂèØ‰ª•ÁêÜËß£‰∏∫Âú®Ëøô‰∏™Âü∫Á°Ä‰∏äÂÜçËÆ≠ÁªÉÂ§öÂ∞ëËΩÆÔºÅ</small>
                            </div>
                            
                            <div class="form-group" id="resume_path_group" style="display: none;">
                                <label title="ÊåáÂÆö‰πãÂâç‰øùÂ≠òÁöÑÁä∂ÊÄÅÁõÆÂΩïÔºåÂÆûÁé∞ÁúüÊ≠£ÁöÑÊñ≠ÁÇπÁª≠ËÆ≠„ÄÇ">ÊÅ¢Â§çËÆ≠ÁªÉÁä∂ÊÄÅË∑ØÂæÑ</label>
                                <div style="display: flex; gap: 10px;">
                                    <input type="text" id="resume" title="ÊåáÂÆö‰πãÂâç‰øùÂ≠òÁöÑÁä∂ÊÄÅÁõÆÂΩïÔºåÂÆûÁé∞ÁúüÊ≠£ÁöÑÊñ≠ÁÇπÁª≠ËÆ≠„ÄÇ" style="flex: 1;">
                                    <button type="button" onclick="selectFolder('resume')" class="btn" style="padding: 8px 12px; font-size: 12px;">üìÅ ÈÄâÊã©</button>
                                </div>
                                <small style="color: #666; display: block; margin-top: 5px;">üí° ÈÄâÊã©‰πãÂâç‰øùÂ≠òÁöÑÁä∂ÊÄÅÁõÆÂΩïÔºåÂ¶Ç ./output/wan22-lora-000006-state</small>
                            </div>

                            
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ÈÖçÁΩÆÊìç‰ΩúÈù¢Êùø -->
            <div class="panel">
                <h2>üíæ ÈÖçÁΩÆÁÆ°ÁêÜ</h2>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button onclick="saveConfig()" class="btn">üíæ ‰øùÂ≠òÈÖçÁΩÆ</button>
                    <button onclick="loadConfig()" class="btn">üìÇ Âä†ËΩΩÈÖçÁΩÆ</button>
                    <button onclick="resetConfig()" class="btn">üîÑ ÈáçÁΩÆÈÖçÁΩÆ</button>
                </div>
            </div>
            
            <!-- È¢Ñ‰º∞ËÆ≠ÁªÉÊó∂Èó¥Èù¢Êùø -->
            <div class="panel">
                <h2>‚è±Ô∏è È¢Ñ‰º∞ËÆ≠ÁªÉÊó∂Èó¥</h2>
                
                <!-- ËæìÂÖ•ÂèÇÊï∞Âå∫Âüü -->
                <div class="form-group">
                    <label for="avg_step_time">Âπ≥ÂùáÊØèÊ≠•ËÄóÊó∂ (Áßí):</label>
                    <input type="number" id="avg_step_time" step="0.01" value="2.92" placeholder="‰æãÂ¶Ç: 2.92">
                    <small style="color: #666; font-size: 12px;">üí° Âª∫ËÆÆÊ†πÊçÆÂÆûÈôÖËÆ≠ÁªÉÁªèÈ™åË∞ÉÊï¥Ê≠§ÂÄº</small>
                </div>
                
                <div style="text-align: center; margin: 15px 0;">
                    <button onclick="estimateTrainingTime()" class="btn" style="background: linear-gradient(45deg, #4CAF50, #45a049); color: white; padding: 10px 20px; border: none; border-radius: 8px; font-size: 14px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.2); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.2)'">
                        üìä ÂºÄÂßã‰º∞ÁÆóËÆ≠ÁªÉÊó∂Èó¥
                    </button>
                </div>
                
                <!-- ËÆ°ÁÆóÁªìÊûúÂ±ïÁ§∫Âå∫Âüü -->
                <div id="estimation_results" style="display: none; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); border-radius: 12px; padding: 20px; margin-top: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    
                    <!-- ÊúÄÁªàÁªìÊûú -->
                    <div style="text-align: center; margin-bottom: 20px; padding: 15px; background: rgba(255,255,255,0.8); border-radius: 8px; border-left: 4px solid #4CAF50;">
                        <h3 style="margin: 0 0 10px 0; color: #2c3e50; font-size: 18px;">üéØ È¢Ñ‰º∞ËÆ≠ÁªÉÊó∂Èó¥</h3>
                        <div id="final_time_result" style="font-size: 24px; font-weight: bold; color: #27ae60; text-shadow: 1px 1px 2px rgba(0,0,0,0.1);">--</div>
                    </div>
                    
                    <!-- ËÆ°ÁÆóÊ≠•È™§ËØ¶ÊÉÖ -->
                    <div style="background: rgba(255,255,255,0.9); border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                        <h4 style="margin: 0 0 15px 0; color: #34495e; border-bottom: 2px solid #3498db; padding-bottom: 5px;">üìã ËÆ°ÁÆóÊ≠•È™§ËØ¶ÊÉÖ</h4>
                        
                        <!-- Êï∞ÊçÆÈõÜ‰ø°ÊÅØ -->
                        <div style="margin-bottom: 12px; padding: 10px; background: #ecf0f1; border-radius: 6px; border-left: 3px solid #3498db;">
                            <div style="font-weight: bold; color: #2c3e50; margin-bottom: 5px;">üìÅ Êï∞ÊçÆÈõÜÊñá‰ª∂Êï∞Èáè</div>
                            <div id="dataset_files_display" style="font-size: 16px; color: #27ae60;">-- ‰∏™Êñá‰ª∂</div>
                            <small style="color: #7f8c8d;">Êù•Ê∫ê: dataset_config ÈÖçÁΩÆÊñá‰ª∂‰∏≠ÁöÑ image_directory Ë∑ØÂæÑ</small>
                        </div>
                        
                        <!-- ËÆ≠ÁªÉÂèÇÊï∞ -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px;">
                            <div style="padding: 10px; background: #ecf0f1; border-radius: 6px; border-left: 3px solid #e74c3c;">
                                <div style="font-weight: bold; color: #2c3e50; margin-bottom: 5px;">üî¢ ÊâπÊ¨°Â§ßÂ∞è</div>
                                <div id="batch_size_display" style="font-size: 16px; color: #e74c3c;">--</div>
                                <small style="color: #7f8c8d;">Êù•Ê∫ê: batch_size ÂèÇÊï∞</small>
                            </div>
                            <div style="padding: 10px; background: #ecf0f1; border-radius: 6px; border-left: 3px solid #f39c12;">
                                <div style="font-weight: bold; color: #2c3e50; margin-bottom: 5px;">üîÑ ÈáçÂ§çÊ¨°Êï∞</div>
                                <div id="num_repeats_display" style="font-size: 16px; color: #f39c12;">--</div>
                                <small style="color: #7f8c8d;">Êù•Ê∫ê: num_repeats ÂèÇÊï∞</small>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                            <div style="padding: 10px; background: #ecf0f1; border-radius: 6px; border-left: 3px solid #9b59b6;">
                                <div style="font-weight: bold; color: #2c3e50; margin-bottom: 5px;">üéØ ËÆ≠ÁªÉËΩÆÊ¨°</div>
                                <div id="max_epochs_display" style="font-size: 16px; color: #9b59b6;">--</div>
                                <small style="color: #7f8c8d;">Êù•Ê∫ê: max_train_epochs ÂèÇÊï∞</small>
                            </div>
                            <div style="padding: 10px; background: #ecf0f1; border-radius: 6px; border-left: 3px solid #1abc9c;">
                                <div style="font-weight: bold; color: #2c3e50; margin-bottom: 5px;">‚è±Ô∏è ÊØèÊ≠•ËÄóÊó∂</div>
                                <div id="step_time_display" style="font-size: 16px; color: #1abc9c;">-- Áßí</div>
                                <small style="color: #7f8c8d;">Êù•Ê∫ê: Áî®Êà∑ËæìÂÖ•ÁöÑÂπ≥ÂùáÊØèÊ≠•ËÄóÊó∂</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ËÆ°ÁÆóÂÖ¨ÂºèÂ±ïÁ§∫ -->
                    <div style="background: rgba(255,255,255,0.9); border-radius: 8px; padding: 15px;">
                        <h4 style="margin: 0 0 15px 0; color: #34495e; border-bottom: 2px solid #e67e22; padding-bottom: 5px;">üßÆ ËÆ°ÁÆóÂÖ¨Âºè</h4>
                        
                        <div style="margin-bottom: 15px; padding: 12px; background: #fdf2e9; border-radius: 6px; border: 1px solid #f39c12;">
                            <div style="font-weight: bold; color: #d35400; margin-bottom: 8px;">Á¨¨‰∏ÄÊ≠•ÔºöËÆ°ÁÆóÊÄªÊ≠•Êï∞</div>
                            <div style="font-family: 'Courier New', monospace; background: #fff; padding: 8px; border-radius: 4px; border-left: 3px solid #f39c12; color: #2c3e50; font-weight: bold;">
                                ÊÄªÊ≠•Êï∞ = (Êï∞ÊçÆÈõÜÊñá‰ª∂Êï∞ √ó ÈáçÂ§çÊ¨°Êï∞ √∑ ÊâπÊ¨°Â§ßÂ∞è) √ó ËÆ≠ÁªÉËΩÆÊ¨°
                            </div>
                            <div id="total_steps_calculation" style="margin-top: 8px; color: #d35400; font-weight: bold;">ÊÄªÊ≠•Êï∞ = (-- √ó -- √∑ --) √ó -- = -- Ê≠•</div>
                        </div>
                        
                        <div style="padding: 12px; background: #eaf2f8; border-radius: 6px; border: 1px solid #3498db;">
                            <div style="font-weight: bold; color: #2980b9; margin-bottom: 8px;">Á¨¨‰∫åÊ≠•ÔºöËÆ°ÁÆóÈ¢Ñ‰º∞Êó∂Èó¥</div>
                            <div style="font-family: 'Courier New', monospace; background: #fff; padding: 8px; border-radius: 4px; border-left: 3px solid #3498db; color: #2c3e50; font-weight: bold;">
                                È¢Ñ‰º∞Êó∂Èó¥ = ÊÄªÊ≠•Êï∞ √ó ÊØèÊ≠•ËÄóÊó∂
                            </div>
                            <div id="time_calculation" style="margin-top: 8px; color: #2980b9; font-weight: bold;">È¢Ñ‰º∞Êó∂Èó¥ = -- √ó -- = -- Áßí</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let isRunning = false;
        let currentTaskType = 't2v'; // ÈªòËÆ§ÊñáÁîüËßÜÈ¢ë
        let lastLogCount = 0;
        let currentRunningTask = null; // ÂΩìÂâçËøêË°åÁöÑ‰ªªÂä°Á±ªÂûãÔºö'training', 'caching', null
        
        function selectTaskType(taskType) {
            currentTaskType = taskType;
            
            // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
            const t2vBtn = document.getElementById('t2v-btn');
            const i2vBtn = document.getElementById('i2v-btn');
            const currentBtn = document.getElementById(taskType + '-btn');
            
            if (t2vBtn) t2vBtn.classList.remove('active');
            if (i2vBtn) i2vBtn.classList.remove('active');
            if (currentBtn) currentBtn.classList.add('active');
            
            // Ê†πÊçÆ‰ªªÂä°Á±ªÂûãËá™Âä®Â°´ÂÖÖÂèÇÊï∞Âπ∂ËÆæÁΩÆ‰∏∫Âè™ËØª
            const taskInput = document.getElementById('task');
            const discreteFlowShiftInput = document.getElementById('discrete_flow_shift');
            const timestepBoundaryInput = document.getElementById('timestep_boundary');
            
            if (taskType === 'i2v') {
                // I2VÂèÇÊï∞ËÆæÁΩÆ
                if (taskInput) {
                    taskInput.value = 'i2v-A14B';
                    taskInput.readOnly = true;
                }
                if (discreteFlowShiftInput) {
                    discreteFlowShiftInput.value = '5.0';
                    discreteFlowShiftInput.readOnly = true;
                }
                if (timestepBoundaryInput) {
                    timestepBoundaryInput.value = '900';
                    timestepBoundaryInput.readOnly = true;
                }
                
                addLogEntry({
                    level: 'info',
                    message: 'Â∑≤ÂàáÊç¢Âà∞ÂõæÁîüËßÜÈ¢ë(I2V)Ê®°ÂºèÔºåÂèÇÊï∞Â∑≤Ëá™Âä®ËÆæÁΩÆÔºötask=i2v-A14B, discrete_flow_shift=5.0, timestep_boundary=900',
                    timestamp: new Date().toLocaleTimeString()
                });
            } else {
                // T2VÂèÇÊï∞ËÆæÁΩÆ
                if (taskInput) {
                    taskInput.value = 't2v-A14B';
                    taskInput.readOnly = true;
                }
                if (discreteFlowShiftInput) {
                    discreteFlowShiftInput.value = '12.0';
                    discreteFlowShiftInput.readOnly = true;
                }
                if (timestepBoundaryInput) {
                    timestepBoundaryInput.value = '875';
                    timestepBoundaryInput.readOnly = true;
                }
                
                addLogEntry({
                    level: 'info',
                    message: 'Â∑≤ÂàáÊç¢Âà∞ÊñáÁîüËßÜÈ¢ë(T2V)Ê®°ÂºèÔºåÂèÇÊï∞Â∑≤Ëá™Âä®ËÆæÁΩÆÔºötask=t2v-A14B, discrete_flow_shift=12.0, timestep_boundary=875',
                    timestamp: new Date().toLocaleTimeString()
                });
            }
        }
        
        function setButtonsEnabled(enabled) {
            const buttons = ['cache-vae-btn', 'cache-te-btn', 'train-btn'];
            buttons.forEach(id => {
                document.getElementById(id).disabled = !enabled;
            });
            // ÂÅúÊ≠¢ËÆ≠ÁªÉÊåâÈíÆÂè™Âú®ËÆ≠ÁªÉÊó∂ÂèØÁî®
            document.getElementById('stop-btn').disabled = enabled || currentRunningTask !== 'training';
            isRunning = !enabled;
        }
        
        // Êñ∞Â¢ûÔºöËÆæÁΩÆËÆ≠ÁªÉÊåâÈíÆÁä∂ÊÄÅ
        function setTrainingButtonsEnabled(enabled) {
            const buttons = ['cache-vae-btn', 'cache-te-btn', 'train-btn'];
            buttons.forEach(id => {
                document.getElementById(id).disabled = !enabled;
            });
            // ÂÅúÊ≠¢ËÆ≠ÁªÉÊåâÈíÆÂè™Âú®ËÆ≠ÁªÉÊó∂ÂêØÁî®
            document.getElementById('stop-btn').disabled = enabled;
            isRunning = !enabled;
            currentRunningTask = enabled ? null : 'training';
        }
        
        // Êñ∞Â¢ûÔºöËÆæÁΩÆÁºìÂ≠òÊåâÈíÆÁä∂ÊÄÅ
        function setCacheButtonsEnabled(enabled) {
            const buttons = ['cache-vae-btn', 'cache-te-btn', 'train-btn'];
            buttons.forEach(id => {
                document.getElementById(id).disabled = !enabled;
            });
            // ÁºìÂ≠ò‰ªªÂä°Êó∂ÂÅúÊ≠¢ËÆ≠ÁªÉÊåâÈíÆ‰øùÊåÅÁ¶ÅÁî®
            document.getElementById('stop-btn').disabled = true;
            isRunning = !enabled;
            currentRunningTask = enabled ? null : 'caching';
        }
        
        function updateStatus(status, message) {
            const indicator = document.getElementById('status-indicator');
            const text = document.getElementById('status-text');
            
            indicator.className = `status-indicator status-${status}`;
            text.textContent = message;
        }
        
        function updateProgress(percent) {
            document.getElementById('progress-fill').style.width = percent + '%';
        }
        
        // ‰ΩøÁî®Áé∞‰ª£Êñá‰ª∂ÈÄâÊã©APIÁöÑÂáΩÊï∞
        async function selectFileModern(inputId, fileExtension) {
            if (window.showOpenFilePicker) {
                try {
                    const [fileHandle] = await window.showOpenFilePicker({
                        types: [{
                            description: 'Files',
                            accept: { '*/*': [fileExtension] }
                        }]
                    });
                    const file = await fileHandle.getFile();
                    
                    // Áé∞‰ª£ÊµèËßàÂô®APIÊó†Ê≥ïËé∑ÂèñÂÆåÊï¥Ë∑ØÂæÑÔºåÂè™ËÉΩËé∑ÂèñÊñá‰ª∂Âêç
                    // ‰∏∫convert_input_fileÊèê‰æõÊô∫ËÉΩË∑ØÂæÑÂª∫ËÆÆ
                    if (inputId === 'convert_input_file') {
                        const fileName = file.name;
                        const currentDir = 'C:\\Users\\oskey\\ai\\musubi-tuner';
                        // Êèê‰æõÂ∏∏ËßÅÁöÑLoRAÊñá‰ª∂‰ΩçÁΩÆÂª∫ËÆÆ
                        const suggestedPath = currentDir + '\\output\\' + fileName;
                        document.getElementById(inputId).value = suggestedPath;
                        
                        // Êõ¥Êñ∞ÊèêÁ§∫‰ø°ÊÅØÔºå‰∏ç‰ΩøÁî®ËÉåÊôØËâ≤
                        const inputElement = document.getElementById(inputId);
                        inputElement.title = 'Â∑≤Ëá™Âä®Â°´ÂÖ•Âª∫ËÆÆË∑ØÂæÑ: ' + suggestedPath + ' (ËØ∑Ê†πÊçÆÂÆûÈôÖÊñá‰ª∂‰ΩçÁΩÆ‰øÆÊîπ)';
                    } else {
                        document.getElementById(inputId).value = file.name;
                    }
                    return;
                } catch (err) {
                    // Áî®Êà∑ÂèñÊ∂àÈÄâÊã©ÊàñAPI‰∏çÊîØÊåÅÔºåÂõûÈÄÄÂà∞‰º†ÁªüÊñπÂºè
                }
            }
            // ÂõûÈÄÄÂà∞‰º†ÁªüÊñá‰ª∂ÈÄâÊã©
            selectFileTraditional(inputId, fileExtension);
        }
        
        function selectFileTraditional(inputId, fileExtension) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = fileExtension;
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    let fullPath;
                    
                    const fileName = file.name;
                    
                    if (file.path) {
                        // Â¶ÇÊûúÊµèËßàÂô®ÊîØÊåÅfile.pathÔºåÁõ¥Êé•‰ΩøÁî®ÂÆåÊï¥Ë∑ØÂæÑ
                        fullPath = file.path;
                    } else {
                        // ÊµèËßàÂô®‰∏çÊîØÊåÅfile.pathÊó∂ÔºåÊ†πÊçÆÊñá‰ª∂Á±ªÂûãÊûÑÂª∫ÈªòËÆ§Ë∑ØÂæÑ
                        const currentDir = 'C:\\Users\\oskey\\ai\\musubi-tuner';
                        
                        if (fileExtension === '.toml') {
                            fullPath = currentDir + '\\ai_data\\datasets\\' + fileName;
                        } else if (fileExtension === '.safetensors') {
                            if (inputId === 'dit' || inputId === 'dit_high_noise') {
                                fullPath = currentDir + '\\model\\diffusion_models\\' + fileName;
                            } else if (inputId === 't5') {
                                fullPath = currentDir + '\\model\\text_encoders\\' + fileName;
                            } else if (inputId === 'vae') {
                                fullPath = currentDir + '\\model\\vae\\' + fileName;
                            } else if (inputId === 'convert_input_file') {
                                // LoRAËΩ¨Êç¢ËæìÂÖ•Êñá‰ª∂Ôºå‰øùÊåÅÊñá‰ª∂ÂêçÔºåËÆ©Áî®Êà∑ÊâãÂä®ÁºñËæëË∑ØÂæÑ
                                fullPath = fileName;
                            } else {
                                // ÂÖ∂‰ªñÊÉÖÂÜµÔºå‰ΩøÁî®ÂΩìÂâçÁõÆÂΩï
                                fullPath = currentDir + '\\' + fileName;
                            }
                        } else {
                            // Èùû.safetensorsÂíå.tomlÊñá‰ª∂Ôºå‰ΩøÁî®ÂΩìÂâçÁõÆÂΩï
                            fullPath = currentDir + '\\' + fileName;
                        }
                    }
                    
                    document.getElementById(inputId).value = fullPath;
                    
                    // Â¶ÇÊûúÊòØÊï∞ÊçÆÈõÜÈÖçÁΩÆÊñá‰ª∂ÔºåËá™Âä®ËØªÂèñbatch_sizeÂíånum_repeats
                    if (inputId === 'dataset_config' && fileExtension === '.toml') {
                        readBatchSizeFromToml(fullPath);
                        readNumRepeatsFromToml(fullPath);
                        
                        // Ëá™Âä®ÊèêÂèñÊñá‰ª∂ÂêçÂπ∂ËÆæÁΩÆÂà∞output_name
                        const fileNameWithoutExt = fileName.replace(/\.toml$/i, '');
                        const outputNameElement = document.getElementById('output_name');
                        if (outputNameElement) {
                            outputNameElement.value = fileNameWithoutExt;
                        }
                    }
                }
            };
            input.click();
        }
        
        function readBatchSizeFromToml(tomlPath) {
            fetch('/api/read_batch_size_from_toml', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ toml_path: tomlPath })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.batch_size !== null) {
                    document.getElementById('batch_size').value = data.batch_size;
                    addLogEntry({
                        level: 'info',
                        message: `Â∑≤‰ªé ${tomlPath} ËØªÂèñ batch_size: ${data.batch_size}`,
                        timestamp: new Date().toLocaleTimeString()
                    });
                } else {
                    addLogEntry({
                        level: 'warning',
                        message: data.message || 'Êó†Ê≥ï‰ªéTOMLÊñá‰ª∂ËØªÂèñbatch_size',
                        timestamp: new Date().toLocaleTimeString()
                    });
                }
            })
            .catch(error => {
                addLogEntry({
                    level: 'error',
                    message: 'ËØªÂèñTOMLÊñá‰ª∂Â§±Ë¥•: ' + error.message,
                    timestamp: new Date().toLocaleTimeString()
                });
            });
        }
        
        function readNumRepeatsFromToml(tomlPath) {
            fetch('/api/read_num_repeats_from_toml', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ toml_path: tomlPath })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.num_repeats !== null) {
                    document.getElementById('num_repeats').value = data.num_repeats;
                    addLogEntry({
                        level: 'info',
                        message: `Â∑≤‰ªé ${tomlPath} ËØªÂèñ num_repeats: ${data.num_repeats}`,
                        timestamp: new Date().toLocaleTimeString()
                    });
                } else {
                    addLogEntry({
                        level: 'warning',
                        message: data.message || 'Êó†Ê≥ï‰ªéTOMLÊñá‰ª∂ËØªÂèñnum_repeats',
                        timestamp: new Date().toLocaleTimeString()
                    });
                }
            })
            .catch(error => {
                addLogEntry({
                    level: 'error',
                    message: 'ËØªÂèñTOMLÊñá‰ª∂Â§±Ë¥•: ' + error.message,
                    timestamp: new Date().toLocaleTimeString()
                });
            });
        }
        
        function loadDefaultConfig() {
            // ÂâçÁ´ØÈªòËÆ§ÈÖçÁΩÆÔºå‰∏égetConfigÂáΩÊï∞‰øùÊåÅ‰∏ÄËá¥
            const defaultConfig = {
                // ÁéØÂ¢ÉÈÖçÁΩÆ
                enable_venv: true,
                venv_python_path: './venv/Scripts/',
                
                // Ê†∏ÂøÉÊ®°ÂûãË∑ØÂæÑ
                dit: './model/diffusion_models/wan2.2_t2v_low_noise_14B_fp16.safetensors',
                dit_high_noise: './model/diffusion_models/wan2.2_t2v_high_noise_14B_fp16.safetensors',
                vae: './model/vae/wan_2.1_vae.safetensors',
                t5: './model/text_encoders/models_t5_umt5-xxl-enc-bf16.pth',
                dataset_config: './ai_data/datasets/lovemf_config_t2v.toml',
                
                // ‰ªªÂä°ÈÖçÁΩÆ
                task: 't2v-A14B',
                
                // ËÆ≠ÁªÉÊ†∏ÂøÉÂèÇÊï∞
                mixed_precision: 'fp16',
                timestep_sampling: 'shift',
                discrete_flow_shift: 3.0,
                timestep_boundary: 0.875,
                min_timestep: 0,
                max_timestep: 1000,
                
                // ‰ºòÂåñÂô®ÈÖçÁΩÆ
                optimizer_type: 'AdamW8bit',
                learning_rate: '2e-4',
                
                // ÁΩëÁªúÈÖçÁΩÆ
                network_module: 'networks.lora_wan',
                network_dim: 32,
                network_alpha: 32,
                
                // ËÆ≠ÁªÉÊéßÂà∂
                max_train_epochs: 16,
                save_every_n_epochs: 1,
                save_state: false,
                resume_training: false,
                resume: '',
                seed: 42,
                batch_size: 1,
                num_repeats: 1,
                
                // Êï∞ÊçÆÂä†ËΩΩ
                max_data_loader_n_workers: 2,
                persistent_data_loader_workers: true,
                
                // ‰ºòÂåñÈÄâÈ°π
                sdpa: true,
                gradient_checkpointing: true,
                fp8_base: false,
                fp8_t5: false,
                fp8_scaled: false,
                vae_cache_cpu: false,
                offload_inactive_dit: false,
                blocks_to_swap: 20,
                
                // ËæìÂá∫ÈÖçÁΩÆ
                output_dir: './output',
                output_name: 'wan22-lora',
                logging_dir: './logs',
                log_with: 'tensorboard',
                
                // Á≥ªÁªüÈÖçÁΩÆ
                num_cpu_threads_per_process: 1,

            };
            
            // ËÆæÁΩÆ‰ªªÂä°Á±ªÂûã
            if (defaultConfig.task) {
                const taskType = defaultConfig.task.includes('i2v') ? 'i2v' : 't2v';
                selectTaskType(taskType);
            }
            
            // Â°´ÂÖÖË°®Âçï
            Object.keys(defaultConfig).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    if (element.type === 'checkbox') {
                        element.checked = defaultConfig[key];
                    } else {
                        element.value = defaultConfig[key];
                    }
                }
            })
            .catch(error => {
                console.error('Êé®ËçêÊï∞ÊçÆÈáçÂ§çÊ¨°Êï∞ËØ∑Ê±ÇÂ§±Ë¥•:', error);
                addLogEntry({
                    level: 'error',
                    message: '‚ùå Êé®ËçêÊï∞ÊçÆÈáçÂ§çÊ¨°Êï∞ËØ∑Ê±ÇÂ§±Ë¥•: ' + error.message,
                    timestamp: new Date().toLocaleTimeString()
                });
            });
            
            addLogEntry({
                level: 'info',
                message: 'Â∑≤Âä†ËΩΩÂâçÁ´ØÈªòËÆ§ÈÖçÁΩÆ',
                timestamp: new Date().toLocaleTimeString()
            });
        }
        
        // ‰ΩøÁî®ÂêéÁ´ØAPIË∞ÉÁî®Á≥ªÁªüÊñá‰ª∂ÈÄâÊã©ÂØπËØùÊ°ÜÔºàÈÄöÁî®ÁâàÊú¨Ôºâ
        function selectFileWithDialog(inputId, fileType = 'all', title = 'ÈÄâÊã©Êñá‰ª∂', initialDir = 'C:\\Users\\oskey\\ai\\musubi-tuner') {
            // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'ÈÄâÊã©‰∏≠...';
            button.disabled = true;
            
            // Ê†πÊçÆËæìÂÖ•Ê°ÜIDËÆæÁΩÆÈªòËÆ§ÂèÇÊï∞
            let defaultFileType = fileType;
            let defaultTitle = title;
            let defaultInitialDir = initialDir;
            
            if (inputId === 'convert_input_file') {
                defaultFileType = 'safetensors';
                defaultTitle = 'ÈÄâÊã©LoRAÊñá‰ª∂';
                defaultInitialDir = 'C:\\Users\\oskey\\ai\\musubi-tuner\\output';
            } else if (inputId === 'dataset_config') {
                defaultFileType = 'toml';
                defaultTitle = 'ÈÄâÊã©Êï∞ÊçÆÈõÜÈÖçÁΩÆÊñá‰ª∂';
                defaultInitialDir = 'C:\\Users\\oskey\\ai\\musubi-tuner\\ai_data\\datasets';
            } else if (inputId === 'dit' || inputId === 'dit_high_noise') {
                defaultFileType = 'safetensors';
                defaultTitle = 'ÈÄâÊã©DiTÊ®°ÂûãÊñá‰ª∂';
                defaultInitialDir = 'C:\\Users\\oskey\\ai\\musubi-tuner\\model\\diffusion_models';
            } else if (inputId === 't5') {
                defaultFileType = 'safetensors';
                defaultTitle = 'ÈÄâÊã©T5ÊñáÊú¨ÁºñÁ†ÅÂô®Êñá‰ª∂';
                defaultInitialDir = 'C:\\Users\\oskey\\ai\\musubi-tuner\\model\\text_encoders';
            } else if (inputId === 'vae') {
                defaultFileType = 'safetensors';
                defaultTitle = 'ÈÄâÊã©VAEÊ®°ÂûãÊñá‰ª∂';
                defaultInitialDir = 'C:\\Users\\oskey\\ai\\musubi-tuner\\model\\vae';
            }
            
            // Ë∞ÉÁî®ÂêéÁ´ØAPI
            fetch('/api/select_file', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    file_type: defaultFileType,
                    title: defaultTitle,
                    initial_dir: defaultInitialDir
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.filename) {
                    // Â∞ÜÈÄâÊã©ÁöÑÊñá‰ª∂Ë∑ØÂæÑÂ°´ÂÖ•ËæìÂÖ•Ê°Ü
                    document.getElementById(inputId).value = data.filename;
                    
                    // Â¶ÇÊûúÊòØÊï∞ÊçÆÈõÜÈÖçÁΩÆÊñá‰ª∂ÔºåËá™Âä®ËÆæÁΩÆËæìÂá∫Ê®°ÂûãÂêçÁß∞
                    if (inputId === 'dataset_config' && data.filename.toLowerCase().endsWith('.toml')) {
                        // Â§ÑÁêÜWindowsÂíåUnixË∑ØÂæÑÂàÜÈöîÁ¨¶ÔºåËé∑ÂèñÁ∫ØÊñá‰ª∂Âêç
                        const fileName = data.filename.split(/[\\\/]/).pop(); // Ëé∑ÂèñÊñá‰ª∂Âêç
                        const fileNameWithoutExt = fileName.replace(/\.toml$/i, '');
                        const outputNameElement = document.getElementById('output_name');
                        if (outputNameElement) {
                            outputNameElement.value = fileNameWithoutExt;
                        }
                        
                        // Ëá™Âä®ËØªÂèñbatch_sizeÂíånum_repeats
                        readBatchSizeFromToml(data.filename);
                        readNumRepeatsFromToml(data.filename);
                    }
                    
                    addLogEntry({
                        level: 'info',
                        message: `Â∑≤ÈÄâÊã©Êñá‰ª∂: ${data.filename}`,
                        timestamp: new Date().toLocaleTimeString()
                    });
                } else {
                    addLogEntry({
                        level: 'warning',
                        message: data.message || 'Êñá‰ª∂ÈÄâÊã©Â§±Ë¥•',
                        timestamp: new Date().toLocaleTimeString()
                    });
                }
            })
            .catch(error => {
                console.error('Êñá‰ª∂ÈÄâÊã©APIË∞ÉÁî®Â§±Ë¥•:', error);
                addLogEntry({
                    level: 'error',
                    message: 'Êñá‰ª∂ÈÄâÊã©ÂäüËÉΩË∞ÉÁî®Â§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÂêéÁ´ØÊúçÂä°',
                    timestamp: new Date().toLocaleTimeString()
                });
            })
            .finally(() => {
                // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
                button.textContent = originalText;
                button.disabled = false;
            });
        }
        
        function selectFolder(inputId) {
            // Ëé∑ÂèñÊåâÈíÆÂÖÉÁ¥†Âπ∂ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'ÈÄâÊã©‰∏≠...';
            button.disabled = true;
            
            // Ê†πÊçÆËæìÂÖ•Ê°ÜIDËÆæÁΩÆÈªòËÆ§ÂèÇÊï∞
            let defaultTitle = 'ÈÄâÊã©Êñá‰ª∂Â§π';
            let defaultInitialDir = 'C:\\Users\\oskey\\ai\\musubi-tuner';
            
            if (inputId === 'output_dir') {
                defaultTitle = 'ÈÄâÊã©ËæìÂá∫ÁõÆÂΩï';
                defaultInitialDir = 'C:\\Users\\oskey\\ai\\musubi-tuner\\output';
            } else if (inputId === 'convert_output_dir') {
                defaultTitle = 'ÈÄâÊã©ËΩ¨Êç¢ÂêéÊñá‰ª∂‰øùÂ≠òÁõÆÂΩï';
                defaultInitialDir = 'C:\\Users\\oskey\\ai\\musubi-tuner\\output';
            } else if (inputId === 'resume') {
                defaultTitle = 'ÈÄâÊã©ËÆ≠ÁªÉÁä∂ÊÄÅÁõÆÂΩï';
                defaultInitialDir = 'C:\\Users\\oskey\\ai\\musubi-tuner\\output';
            } else if (inputId === 'venv_python_path') {
                defaultTitle = 'ÈÄâÊã©ËôöÊãüÁéØÂ¢ÉScriptsÁõÆÂΩï';
                defaultInitialDir = 'C:\\Users\\oskey\\ai\\musubi-tuner\\venv\\Scripts';
            }
            
            // Ë∞ÉÁî®ÂêéÁ´ØAPI
            fetch('/api/select_folder', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    title: defaultTitle,
                    initial_dir: defaultInitialDir
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.folder_path) {
                    // Â∞ÜÈÄâÊã©ÁöÑÊñá‰ª∂Â§πË∑ØÂæÑÂ°´ÂÖ•ËæìÂÖ•Ê°Ü
                    document.getElementById(inputId).value = data.folder_path;
                    
                    addLogEntry({
                        level: 'info',
                        message: `Â∑≤ÈÄâÊã©Êñá‰ª∂Â§π: ${data.folder_path}`,
                        timestamp: new Date().toLocaleTimeString()
                    });
                } else {
                    addLogEntry({
                        level: 'warning',
                        message: data.message || 'Êñá‰ª∂Â§πÈÄâÊã©Â§±Ë¥•',
                        timestamp: new Date().toLocaleTimeString()
                    });
                }
            })
            .catch(error => {
                console.error('Êñá‰ª∂Â§πÈÄâÊã©APIË∞ÉÁî®Â§±Ë¥•:', error);
                addLogEntry({
                    level: 'error',
                    message: 'Êñá‰ª∂Â§πÈÄâÊã©ÂäüËÉΩË∞ÉÁî®Â§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÂêéÁ´ØÊúçÂä°',
                    timestamp: new Date().toLocaleTimeString()
                });
            })
            .finally(() => {
                // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
                button.textContent = originalText;
                button.disabled = false;
            });
        }
        
        function getConfig() {
            function safeGetValue(id, defaultValue = '', isCheckbox = false) {
                const element = document.getElementById(id);
                if (!element) {
                    console.warn(`Element with id '${id}' not found, using default value:`, defaultValue);
                    return defaultValue;
                }
                return isCheckbox ? element.checked : element.value;
            }
            
            function safeGetIntValue(id, defaultValue = 0) {
                const value = safeGetValue(id, defaultValue.toString());
                return parseInt(value) || defaultValue;
            }
            
            function safeGetFloatValue(id, defaultValue = 0.0) {
                const value = safeGetValue(id, defaultValue.toString());
                return parseFloat(value) || defaultValue;
            }
            
            const config = {
                // ÁéØÂ¢ÉÈÖçÁΩÆ
                enable_venv: safeGetValue('enable_venv', true, true),
                venv_python_path: safeGetValue('venv_python_path', './venv/Scripts/'),
                
                // Ê†∏ÂøÉÊ®°ÂûãË∑ØÂæÑ
                dit: safeGetValue('dit', ''),
                dit_high_noise: safeGetValue('dit_high_noise', ''),
                vae: safeGetValue('vae', ''),
                t5: safeGetValue('t5', ''),
                dataset_config: safeGetValue('dataset_config', ''),
                
                // ‰ªªÂä°ÈÖçÁΩÆ
                task: safeGetValue('task', currentTaskType === 'i2v' ? 'i2v-A14B' : 't2v-A14B'),
                
                // ËÆ≠ÁªÉÊ†∏ÂøÉÂèÇÊï∞
                mixed_precision: safeGetValue('mixed_precision', 'fp16'),
                timestep_sampling: safeGetValue('timestep_sampling', 'shift'),
                weighting_scheme: safeGetValue('weighting_scheme', 'none'),
                discrete_flow_shift: safeGetFloatValue('discrete_flow_shift', currentTaskType === 'i2v' ? 5.0 : 12.0),
                timestep_boundary: safeGetIntValue('timestep_boundary', currentTaskType === 'i2v' ? 900 : 875),
                min_timestep: safeGetIntValue('min_timestep', 0),
                max_timestep: safeGetIntValue('max_timestep', 1000),
                
                // ‰ºòÂåñÂô®ÈÖçÁΩÆ
                optimizer_type: safeGetValue('optimizer_type', 'adamw8bit'),
                learning_rate: safeGetValue('learning_rate', '2e-4'),
                
                // ÁΩëÁªúÈÖçÁΩÆ
                network_module: safeGetValue('network_module', 'networks.lora_wan'),
                network_dim: safeGetIntValue('network_dim', 32),
                network_alpha: safeGetIntValue('network_alpha', 32),
                
                // ËÆ≠ÁªÉÊéßÂà∂
                max_train_epochs: safeGetIntValue('max_train_epochs', 16),
                save_every_n_epochs: safeGetIntValue('save_every_n_epochs', 1),
                // ËÆ≠ÁªÉÁä∂ÊÄÅÁõ∏ÂÖ≥ÂèÇÊï∞ÔºàÂèÇ‰∏éËÆ≠ÁªÉ‰ΩÜ‰∏çÂèÇ‰∏éÈÖçÁΩÆ‰øùÂ≠ò/Âä†ËΩΩ/ÈáçÁΩÆÔºâ
                save_state: safeGetValue('save_state', false, true),
                resume_training: safeGetValue('resume_training', false, true),
                resume: safeGetValue('resume', ''),
                seed: safeGetIntValue('seed', 42),
                batch_size: safeGetIntValue('batch_size', 1),
                num_repeats: safeGetIntValue('num_repeats', 1),
                
                // ËßÜÈ¢ëËÆ≠ÁªÉÂèÇÊï∞
                is_video_training: safeGetValue('video_training_checkbox', false, true),
                video_duration: safeGetIntValue('video_duration', 300),
                
                // Êï∞ÊçÆÂä†ËΩΩ
                max_data_loader_n_workers: safeGetIntValue('max_data_loader_n_workers', 2),
                persistent_data_loader_workers: safeGetValue('persistent_data_loader_workers', false, true),
                
                // ‰ºòÂåñÈÄâÈ°π
                sdpa: safeGetValue('sdpa', true, true),
                gradient_checkpointing: safeGetValue('gradient_checkpointing', true, true),
                fp8_base: safeGetValue('fp8_base', true, true),
                fp8_t5: safeGetValue('fp8_t5', false, true),
                // ÂÜÖÂ≠ò‰ºòÂåñÁ≠ñÁï•Â§ÑÁêÜ
                memory_optimization_strategy: document.getElementById('memory_optimization_strategy').value,
                ...getMemoryOptimizationConfig(),
                fp8_scaled: safeGetValue('fp8_scaled', false, true),
                vae_cache_cpu: safeGetValue('vae_cache_cpu', false, true),
                
                // ËæìÂá∫ÈÖçÁΩÆ
                output_dir: safeGetValue('output_dir', './output'),
                output_name: safeGetValue('output_name', 'wan22-lora'),
                logging_dir: safeGetValue('logging_dir', './logs'),
                log_with: safeGetValue('log_with', 'tensorboard'),
                
                // LoRAËΩ¨Êç¢ËÆæÁΩÆ
                convert_input_file: safeGetValue('convert_input_file', ''),
                convert_output_dir: safeGetValue('convert_output_dir', ''),
                
                // Á≥ªÁªüÈÖçÁΩÆ
                num_cpu_threads_per_process: safeGetIntValue('num_cpu_threads_per_process', 1),
                

            };
            
            return config;
        }
        
        function addLogEntry(entry) {
            const logOutput = document.getElementById('log-output');
            if (!logOutput) return;
            
            const shouldScroll = logOutput.scrollTop + logOutput.clientHeight >= logOutput.scrollHeight - 20;
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry log-' + entry.level;
            logEntry.innerHTML = `<span style="color: #888;">[${entry.timestamp}]</span> ${entry.message}`;
            logOutput.appendChild(logEntry);
            
            lastLogCount++;
            
            if (shouldScroll) {
                setTimeout(() => {
                    logOutput.scrollTop = logOutput.scrollHeight;
                }, 10);
            }
        }
        
        function startCacheVAE() {
            if (isRunning) return;
            
            const config = getConfig();
            setCacheButtonsEnabled(false);
            updateStatus('running', 'Ê≠£Âú®È¢ÑÁºìÂ≠òVAE Latents...');
            
            addLogEntry({
                level: 'info',
                message: 'ÂºÄÂßãÈ¢ÑÁºìÂ≠òVAE Latents...',
                timestamp: new Date().toLocaleTimeString()
            });
            
            fetch('/api/cache_vae', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(config)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    isRunning = true;
                    currentRunningTask = 'caching';
                    addLogEntry({
                        level: 'success',
                        message: 'VAE LatentsÈ¢ÑÁºìÂ≠òÂêØÂä®ÊàêÂäü',
                        timestamp: new Date().toLocaleTimeString()
                    });
                    pollStatus();
                    startLogPolling(); // ÂºÄÂßãËΩÆËØ¢Êó•Âøó
                } else {
                    addLogEntry({
                        level: 'error',
                        message: 'VAE LatentsÈ¢ÑÁºìÂ≠òÂêØÂä®Â§±Ë¥•: ' + data.message,
                        timestamp: new Date().toLocaleTimeString()
                    });
                    setCacheButtonsEnabled(true);
                    updateStatus('error', 'È¢ÑÁºìÂ≠òÂ§±Ë¥•');
                }
            })
            .catch(error => {
                addLogEntry({
                    level: 'error',
                    message: 'ËØ∑Ê±ÇÂ§±Ë¥•: ' + error.message,
                    timestamp: new Date().toLocaleTimeString()
                });
                setCacheButtonsEnabled(true);
                updateStatus('error', 'ËØ∑Ê±ÇÂ§±Ë¥•');
            });
        }
        
        function startCacheTextEncoder() {
            if (isRunning) return;
            
            const config = getConfig();
            setCacheButtonsEnabled(false);
            updateStatus('running', 'Ê≠£Âú®È¢ÑÁºìÂ≠òÊñáÊú¨ÁºñÁ†ÅÂô®ËæìÂá∫...');
            
            addLogEntry({
                level: 'info',
                message: 'ÂºÄÂßãÈ¢ÑÁºìÂ≠òÊñáÊú¨ÁºñÁ†ÅÂô®ËæìÂá∫...',
                timestamp: new Date().toLocaleTimeString()
            });
            
            fetch('/api/cache_text_encoder', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(config)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    isRunning = true;
                    currentRunningTask = 'caching';
                    addLogEntry({
                        level: 'success',
                        message: 'ÊñáÊú¨ÁºñÁ†ÅÂô®ËæìÂá∫È¢ÑÁºìÂ≠òÂêØÂä®ÊàêÂäü',
                        timestamp: new Date().toLocaleTimeString()
                    });
                    pollStatus();
                    startLogPolling(); // ÂºÄÂßãËΩÆËØ¢Êó•Âøó
                } else {
                    addLogEntry({
                        level: 'error',
                        message: 'ÊñáÊú¨ÁºñÁ†ÅÂô®ËæìÂá∫È¢ÑÁºìÂ≠òÂêØÂä®Â§±Ë¥•: ' + data.message,
                        timestamp: new Date().toLocaleTimeString()
                    });
                    setCacheButtonsEnabled(true);
                    updateStatus('error', 'È¢ÑÁºìÂ≠òÂ§±Ë¥•');
                }
            })
            .catch(error => {
                addLogEntry({
                    level: 'error',
                    message: 'ËØ∑Ê±ÇÂ§±Ë¥•: ' + error.message,
                    timestamp: new Date().toLocaleTimeString()
                });
                setCacheButtonsEnabled(true);
                updateStatus('error', 'ËØ∑Ê±ÇÂ§±Ë¥•');
            });
        }
        
        function startTraining() {
            if (isRunning) return;
            
            const config = getConfig();
            setTrainingButtonsEnabled(false);
            updateStatus('running', 'Ê≠£Âú®ÂêØÂä®ËÆ≠ÁªÉ...');
            
            addLogEntry({
                level: 'info',
                message: `ÂºÄÂßã${currentTaskType === 'i2v' ? 'ÂõæÁîüËßÜÈ¢ë' : 'ÊñáÁîüËßÜÈ¢ë'}ËÆ≠ÁªÉ...`,
                timestamp: new Date().toLocaleTimeString()
            });
            
            fetch('/api/start_training', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(config)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    addLogEntry({
                        level: 'success',
                        message: 'ËÆ≠ÁªÉÂêØÂä®ÊàêÂäü',
                        timestamp: new Date().toLocaleTimeString()
                    });
                    pollStatus();
                    startLogPolling(); // ÂºÄÂßãËΩÆËØ¢Êó•Âøó
                } else {
                    addLogEntry({
                        level: 'error',
                        message: 'ËÆ≠ÁªÉÂêØÂä®Â§±Ë¥•: ' + data.message,
                        timestamp: new Date().toLocaleTimeString()
                    });
                    setTrainingButtonsEnabled(true);
                    updateStatus('error', 'ËÆ≠ÁªÉÂ§±Ë¥•');
                }
            })
            .catch(error => {
                addLogEntry({
                    level: 'error',
                    message: 'ËØ∑Ê±ÇÂ§±Ë¥•: ' + error.message,
                    timestamp: new Date().toLocaleTimeString()
                });
                setTrainingButtonsEnabled(true);
                updateStatus('error', 'ËØ∑Ê±ÇÂ§±Ë¥•');
            });
        }
        
        function stopTraining() {
            if (!isRunning || currentRunningTask !== 'training') return;
            
            fetch('/api/stop_training', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                addLogEntry({
                    level: 'info',
                    message: 'ËÆ≠ÁªÉÂÅúÊ≠¢ËØ∑Ê±ÇÂ∑≤ÂèëÈÄÅ',
                    timestamp: new Date().toLocaleTimeString()
                });
            })
            .catch(error => {
                addLogEntry({
                    level: 'error',
                    message: 'ÂÅúÊ≠¢ËÆ≠ÁªÉÂ§±Ë¥•: ' + error.message,
                    timestamp: new Date().toLocaleTimeString()
                });
            });
        }
        

        
        function convertLora() {
            const config = getConfig();
            const inputFile = config.convert_input_file;
            const outputDir = config.convert_output_dir;
            
            if (!inputFile || !outputDir) {
                addLogEntry({
                    level: 'error',
                    message: 'ËØ∑ÂÖàËÆæÁΩÆÂæÖËΩ¨Êç¢LoRAÊñá‰ª∂Âú∞ÂùÄÂíåËΩ¨Êç¢ÂêéLoRAÊñá‰ª∂Âú∞ÂùÄ',
                    timestamp: new Date().toLocaleTimeString()
                });
                return;
            }
            
            addLogEntry({
                level: 'info',
                message: 'ÂºÄÂßãËΩ¨Êç¢ LoRA ‰∏∫ ComfyUI ÂÖºÂÆπÊ†ºÂºè...',
                timestamp: new Date().toLocaleTimeString()
            });
            
            fetch('/api/convert_lora', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    input_file: inputFile,
                    output_dir: outputDir
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    addLogEntry({
                        level: 'success',
                        message: `LoRA ËΩ¨Êç¢ÊàêÂäü: ${data.message}`,
                        timestamp: new Date().toLocaleTimeString()
                    });
                } else {
                    addLogEntry({
                        level: 'error',
                        message: 'LoRA ËΩ¨Êç¢Â§±Ë¥•: ' + data.message,
                        timestamp: new Date().toLocaleTimeString()
                    });
                }
            })
            .catch(error => {
                addLogEntry({
                    level: 'error',
                    message: 'LoRA ËΩ¨Êç¢ËØ∑Ê±ÇÂ§±Ë¥•: ' + error.message,
                    timestamp: new Date().toLocaleTimeString()
                });
            });
        }
        
        function startTensorBoard() {
            const config = getConfig();
            fetch('/api/start_tensorboard', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(config)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    addLogEntry({
                        level: 'success',
                        message: `TensorBoardÂ∑≤ÂêØÂä®: ${data.url}`,
                        timestamp: new Date().toLocaleTimeString()
                    });
                    if (data.url) {
                        window.open(data.url, '_blank');
                    }
                } else {
                    addLogEntry({
                        level: 'error',
                        message: 'TensorBoardÂêØÂä®Â§±Ë¥•: ' + data.message,
                        timestamp: new Date().toLocaleTimeString()
                    });
                }
            })
            .catch(error => {
                addLogEntry({
                    level: 'error',
                    message: 'TensorBoardÂêØÂä®Â§±Ë¥•: ' + error.message,
                    timestamp: new Date().toLocaleTimeString()
                });
            });
        }
        
        let logPollingInterval = null;
        
        function clearLogs() {
            fetch('/api/clear_logs', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const logOutput = document.getElementById('log-output');
                    logOutput.innerHTML = '';
                    addLogEntry({
                        level: 'info',
                        message: 'Êó•ÂøóÂ∑≤Ê∏ÖÁ©∫',
                        timestamp: new Date().toLocaleTimeString()
                    });
                } else {
                    addLogEntry({
                        level: 'error',
                        message: 'Ê∏ÖÁ©∫Êó•ÂøóÂ§±Ë¥•: ' + data.message,
                        timestamp: new Date().toLocaleTimeString()
                    });
                }
            })
            .catch(error => {
                addLogEntry({
                    level: 'error',
                    message: 'Ê∏ÖÁ©∫Êó•ÂøóÂ§±Ë¥•: ' + error.message,
                    timestamp: new Date().toLocaleTimeString()
                });
            });
        }
        
        function scrollToBottom() {
            const logOutput = document.getElementById('log-output');
            logOutput.scrollTop = logOutput.scrollHeight;
        }
        
        function startLogPolling() {
            // WebSocketÊ®°Âºè‰∏ã‰∏çÈúÄË¶ÅËΩÆËØ¢Ôºå‰øùÁïôÂáΩÊï∞‰ª•ÂÖºÂÆπÁé∞Êúâ‰ª£Á†Å
            console.log('‰ΩøÁî®WebSocketÂÆûÊó∂Êó•ÂøóÔºåÊó†ÈúÄÂêØÂä®ËΩÆËØ¢');
        }
        
        function stopLogPolling() {
            // WebSocketÊ®°Âºè‰∏ã‰∏çÈúÄË¶ÅËΩÆËØ¢Ôºå‰øùÁïôÂáΩÊï∞‰ª•ÂÖºÂÆπÁé∞Êúâ‰ª£Á†Å
            console.log('‰ΩøÁî®WebSocketÂÆûÊó∂Êó•ÂøóÔºåÊó†ÈúÄÂÅúÊ≠¢ËΩÆËØ¢');
        }
        
        function pollStatus() {
            if (!isRunning) return;
            
            fetch('/api/status')
            .then(response => response.json())
            .then(data => {
                // Ê£ÄÊü•ÁºìÂ≠ò‰ªªÂä°Áä∂ÊÄÅ
                if (data.cache_running) {
                    updateStatus('running', `${data.cache_type}ÁºìÂ≠òËøõË°å‰∏≠...`);
                    setTimeout(pollStatus, 2000);
                    return;
                }
                
                // Ê£ÄÊü•ËÆ≠ÁªÉ‰ªªÂä°Áä∂ÊÄÅ
                if (data.training_running) {
                    updateStatus('running', data.status || 'ËÆ≠ÁªÉËøõË°å‰∏≠...');
                    if (data.progress !== undefined) {
                        updateProgress(data.progress);
                    }
                    setTimeout(pollStatus, 2000);
                } else {
                    // ‰ªªÂä°ÂÆåÊàêÔºåÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
                    isRunning = false;
                    currentRunningTask = null;
                    
                    // Ê†πÊçÆ‰πãÂâçÁöÑ‰ªªÂä°Á±ªÂûãÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
                    setTrainingButtonsEnabled(true);
                    setCacheButtonsEnabled(true);
                    setButtonsEnabled(true);
                    
                    updateStatus('ready', 'Â∞±Áª™');
                    updateProgress(0);
                    stopLogPolling(); // ÂÅúÊ≠¢Êó•ÂøóËΩÆËØ¢
                    
                    if (data.training_completed) {
                        addLogEntry({
                            level: 'success',
                            message: 'ËÆ≠ÁªÉÂÆåÊàê',
                            timestamp: new Date().toLocaleTimeString()
                        });
                    } else if (data.training_error) {
                        addLogEntry({
                            level: 'error',
                            message: 'ËÆ≠ÁªÉÂ§±Ë¥•',
                            timestamp: new Date().toLocaleTimeString()
                        });
                    }
                }
            })
            .catch(error => {
                console.error('Áä∂ÊÄÅËΩÆËØ¢Â§±Ë¥•:', error);
                setTimeout(pollStatus, 5000);
            });
        }
        
        function fetchLogs() {
            fetch('/api/logs')
            .then(response => response.json())
            .then(data => {
                if (data.logs && data.logs.length > lastLogCount) {
                    const newLogs = data.logs.slice(lastLogCount);
                    newLogs.forEach(log => {
                        addLogEntry(log);
                    });
                    lastLogCount = data.logs.length;
                }
            })
            .catch(error => {
                console.error('Ëé∑ÂèñÊó•ÂøóÂ§±Ë¥•:', error);
            });
        }
        
        function saveConfig() {
            const config = getConfig();
            
            fetch('/api/save_config', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(config)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    addLogEntry({
                        level: 'success',
                        message: 'ÈÖçÁΩÆÂ∑≤‰øùÂ≠ò',
                        timestamp: new Date().toLocaleTimeString()
                    });
                } else {
                    addLogEntry({
                        level: 'error',
                        message: 'ÈÖçÁΩÆ‰øùÂ≠òÂ§±Ë¥•: ' + data.message,
                        timestamp: new Date().toLocaleTimeString()
                    });
                }
            })
            .catch(error => {
                addLogEntry({
                    level: 'error',
                    message: 'ÈÖçÁΩÆ‰øùÂ≠òÂ§±Ë¥•: ' + error.message,
                    timestamp: new Date().toLocaleTimeString()
                });
            });
        }
        
        function loadConfig() {
            fetch('/api/load_config')
            .then(response => response.json())
            .then(data => {
                // Êó†ËÆ∫ÊàêÂäüËøòÊòØÂ§±Ë¥•ÔºåÈÉΩÂ∞ùËØï‰ΩøÁî®ËøîÂõûÁöÑÈÖçÁΩÆÔºàÂ§±Ë¥•Êó∂ÂêéÁ´Ø‰ºöËøîÂõûÈªòËÆ§ÈÖçÁΩÆÔºâ
                const config = data.config;
                if (config) {
                    // ËÆæÁΩÆ‰ªªÂä°Á±ªÂûã
                    if (config.task) {
                        selectTaskType(config.task);
                    }
                    
                    // Â°´ÂÖÖË°®ÂçïÔºàË∑≥ËøáËÆ≠ÁªÉÁä∂ÊÄÅÁõ∏ÂÖ≥ÂèÇÊï∞Ôºâ
                    const skipParams = ['save_state', 'resume_training', 'resume'];
                    Object.keys(config).forEach(key => {
                        // Ë∑≥ËøáËÆ≠ÁªÉÁä∂ÊÄÅÁõ∏ÂÖ≥ÂèÇÊï∞Ôºå‰∏çÂèÇ‰∏éÈÖçÁΩÆÂä†ËΩΩ
                        if (skipParams.includes(key)) {
                            return;
                        }
                        
                        const element = document.getElementById(key);
                        if (element) {
                            if (element.type === 'checkbox') {
                                element.checked = config[key];
                            } else {
                                element.value = config[key];
                            }
                        }
                    });
                    
                    // ÁâπÊÆäÂ§ÑÁêÜÂÜÖÂ≠ò‰ºòÂåñÁ≠ñÁï•ÊÅ¢Â§ç
                    if (config.memory_optimization_strategy) {
                        document.getElementById('memory_optimization_strategy').value = config.memory_optimization_strategy;
                    }
                    
                    // Ëß¶ÂèëÂÜÖÂ≠ò‰ºòÂåñÁ≠ñÁï•ÂàáÊç¢Â§ÑÁêÜ
                    handleMemoryOptimizationChange();
                    
                    // Ëß¶ÂèëÁªßÁª≠ËÆ≠ÁªÉÈÄâÈ°πÊòæÁ§∫Â§ÑÁêÜ
                    toggleResumeOptions();
                    
                    if (data.success) {
                        addLogEntry({
                            level: 'success',
                            message: 'ÈÖçÁΩÆÂ∑≤Âä†ËΩΩ',
                            timestamp: new Date().toLocaleTimeString()
                        });
                    } else {
                        addLogEntry({
                            level: 'warning',
                            message: '‰ΩøÁî®ÈªòËÆ§ÈÖçÁΩÆ: ' + (data.message || 'ÈÖçÁΩÆÊñá‰ª∂‰∏çÂ≠òÂú®'),
                            timestamp: new Date().toLocaleTimeString()
                        });
                    }
                } else {
                    addLogEntry({
                        level: 'error',
                        message: 'ÈÖçÁΩÆÂä†ËΩΩÂ§±Ë¥•: ' + (data.message || 'Êú™Áü•ÈîôËØØ'),
                        timestamp: new Date().toLocaleTimeString()
                    });
                }
            })
            .catch(error => {
                addLogEntry({
                    level: 'error',
                    message: 'ÈÖçÁΩÆÂä†ËΩΩÂ§±Ë¥•: ' + error.message,
                    timestamp: new Date().toLocaleTimeString()
                });
                // ÁΩëÁªúÈîôËØØÊó∂Ôºå‰ΩøÁî®ÂâçÁ´ØÈªòËÆ§ÈÖçÁΩÆ
                loadDefaultConfig();
            });
        }
        
        function resetConfig() {
            if (confirm('Á°ÆÂÆöË¶ÅÈáçÁΩÆÈÖçÁΩÆÂêóÔºüËøôÂ∞ÜÊÅ¢Â§çÊâÄÊúâÂèÇÊï∞‰∏∫ÈªòËÆ§ÂÄºÂπ∂Ëá™Âä®‰øùÂ≠ò„ÄÇ')) {
                fetch('/api/reset_config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // ‰ΩøÁî®ËøîÂõûÁöÑÈÖçÁΩÆÊõ¥Êñ∞ÁïåÈù¢
                        const config = data.config;
                        
                        // Êõ¥Êñ∞ÊâÄÊúâË°®ÂçïÂ≠óÊÆµÔºàË∑≥ËøáËÆ≠ÁªÉÁä∂ÊÄÅÁõ∏ÂÖ≥ÂèÇÊï∞Ôºâ
                        const skipParams = ['save_state', 'resume_training', 'resume'];
                        Object.keys(config).forEach(key => {
                            // Ë∑≥ËøáËÆ≠ÁªÉÁä∂ÊÄÅÁõ∏ÂÖ≥ÂèÇÊï∞Ôºå‰∏çÂèÇ‰∏éÈÖçÁΩÆÈáçÁΩÆ
                            if (skipParams.includes(key)) {
                                return;
                            }
                            
                            const element = document.getElementById(key);
                            if (element) {
                                if (element.type === 'checkbox') {
                                    element.checked = config[key];
                                } else if (element.type === 'number') {
                                    element.value = config[key];
                                } else {
                                    element.value = config[key];
                                }
                            } else {
                                console.warn(`Element with id '${key}' not found when resetting config`);
                            }
                        });
                        
                        // ÁâπÊÆäÂ§ÑÁêÜ‰ªªÂä°Á±ªÂûã
                        if (config.task) {
                            selectTaskType(config.task);
                        }
                        
                        addLogEntry({
                            level: 'info',
                            message: '‚úÖ ÈÖçÁΩÆÂ∑≤ÈáçÁΩÆ‰∏∫ÈªòËÆ§ÂÄºÂπ∂‰øùÂ≠ò',
                            timestamp: new Date().toLocaleTimeString()
                        });
                    } else {
                        addLogEntry({
                            level: 'error',
                            message: '‚ùå ÈáçÁΩÆÈÖçÁΩÆÂ§±Ë¥•: ' + data.message,
                            timestamp: new Date().toLocaleTimeString()
                        });
                    }
                })
                .catch(error => {
                    console.error('Reset config error:', error);
                    addLogEntry({
                        level: 'error',
                        message: '‚ùå ÈáçÁΩÆÈÖçÁΩÆÂ§±Ë¥•: ' + error.message,
                        timestamp: new Date().toLocaleTimeString()
                    });
                });
            }
        }
        
        function estimateTrainingTime() {
            // Ëé∑ÂèñËÆ≠ÁªÉÂèÇÊï∞
            const datasetConfig = document.getElementById('dataset_config').value;
            const trainBatchSize = parseInt(document.getElementById('batch_size').value) || 1;
            const numRepeats = parseInt(document.getElementById('num_repeats').value) || 1;
            const maxTrainEpochs = parseInt(document.getElementById('max_train_epochs').value) || 1;
            const saveEveryNEpochs = parseInt(document.getElementById('save_every_n_epochs').value) || 1;
            const outputName = document.getElementById('output_name').value || 'wan22-lora';
            const avgStepTime = parseFloat(document.getElementById('avg_step_time').value) || 2.92;
            
            // Ëé∑ÂèñËßÜÈ¢ëËÆ≠ÁªÉÁõ∏ÂÖ≥ÂèÇÊï∞
            const isVideoTraining = document.getElementById('video_training_checkbox') ? 
                document.getElementById('video_training_checkbox').checked : false;
            const videoDuration = isVideoTraining && document.getElementById('video_duration') ? 
                parseInt(document.getElementById('video_duration').value) || 5 : 0;
            
            if (!datasetConfig) {
                addLogEntry({
                    level: 'warning',
                    message: 'ËØ∑ÂÖàÈÄâÊã©Êï∞ÊçÆÈõÜÈÖçÁΩÆÊñá‰ª∂',
                    timestamp: new Date().toLocaleTimeString()
                });
                return;
            }
            
            // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
            const resultsDiv = document.getElementById('estimation_results');
            resultsDiv.style.display = 'block';
            document.getElementById('final_time_result').textContent = 'ËÆ°ÁÆó‰∏≠...';
            
            // Ê∏ÖÈô§‰πãÂâçÁöÑÊñá‰ª∂ÂàóË°®ÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
            const existingFileList = resultsDiv.querySelector('div[style*="border-left: 4px solid #9b59b6"]');
            if (existingFileList) {
                existingFileList.remove();
            }
            
            // Ë∞ÉÁî®ÂêéÁ´ØAPI‰º∞ÁÆóËÆ≠ÁªÉÊó∂Èó¥
            fetch('/api/estimate_training_time', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    dataset_config: datasetConfig,
                    batch_size: trainBatchSize,
                    num_repeats: numRepeats,
                    max_train_epochs: maxTrainEpochs,
                    save_every_n_epochs: saveEveryNEpochs,
                    output_name: outputName,
                    avg_step_time: avgStepTime,
                    is_video_training: isVideoTraining,
                    video_duration: videoDuration
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Êó∂Èó¥Ê†ºÂºèËΩ¨Êç¢ÂáΩÊï∞
                    function formatTime(seconds) {
                        const hours = Math.floor(seconds / 3600);
                        const minutes = Math.floor((seconds % 3600) / 60);
                        const remainingSeconds = Math.floor(seconds % 60);
                        
                        if (hours > 0) {
                            return `${hours} Â∞èÊó∂ ${minutes} ÂàÜÈíü ${remainingSeconds} Áßí`;
                        } else if (minutes > 0) {
                            return `${minutes} ÂàÜÈíü ${remainingSeconds} Áßí`;
                        } else {
                            return `${remainingSeconds} Áßí`;
                        }
                    }
                    
                    // ËÆ°ÁÆóÊÄªÁßíÊï∞
                    const totalSeconds = data.total_steps * avgStepTime;
                    const formattedTime = formatTime(totalSeconds);
                    
                    // Êõ¥Êñ∞ÊúÄÁªàÁªìÊûú
                    document.getElementById('final_time_result').textContent = formattedTime;
                    
                    // Êõ¥Êñ∞ÂèÇÊï∞ÊòæÁ§∫
                    document.getElementById('dataset_files_display').textContent = `${data.dataset_files} ‰∏™Êñá‰ª∂`;
                    document.getElementById('batch_size_display').textContent = trainBatchSize;
                    document.getElementById('num_repeats_display').textContent = numRepeats;
                    document.getElementById('max_epochs_display').textContent = maxTrainEpochs;
                    document.getElementById('step_time_display').textContent = `${avgStepTime} Áßí`;
                    
                    // Êõ¥Êñ∞ËÆ°ÁÆóÂÖ¨ÂºèÊòæÁ§∫
                    let calculationText;
                    if (isVideoTraining && data.video_segments) {
                        // ËßÜÈ¢ëËÆ≠ÁªÉÊ®°ÂºèÔºöÊòæÁ§∫ÁâáÊÆµËÆ°ÁÆóÈÄªËæë
                        calculationText = `ÊÄªÊ≠•Êï∞ = ${data.video_segments} ‰∏™ËßÜÈ¢ëÁâáÊÆµ √∑ ${trainBatchSize} √ó ${maxTrainEpochs} = ${data.total_steps} Ê≠•`;
                    } else {
                        // ÂõæÁâáËÆ≠ÁªÉÊ®°ÂºèÔºö‰ΩøÁî®ÂéüÊúâÈÄªËæë
                        calculationText = `ÊÄªÊ≠•Êï∞ = (${data.dataset_files} √ó ${numRepeats} √∑ ${trainBatchSize}) √ó ${maxTrainEpochs} = ${data.total_steps} Ê≠•`;
                    }
                    document.getElementById('total_steps_calculation').textContent = calculationText;
                    
                    document.getElementById('time_calculation').textContent = 
                        `È¢Ñ‰º∞Êó∂Èó¥ = ${data.total_steps} √ó ${avgStepTime} = ${totalSeconds.toFixed(1)} Áßí (${formattedTime})`;
                    
                    // ÊòæÁ§∫È¢ÑËÆ°ÁîüÊàêÊñá‰ª∂ÂàóË°®
                    if (data.predicted_files && data.predicted_files.length > 0) {
                        let fileListHtml = '<div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.9); border-radius: 8px; border-left: 4px solid #9b59b6;"><h4 style="margin: 0 0 15px 0; color: #8e44ad; border-bottom: 2px solid #9b59b6; padding-bottom: 5px;">üìÅ È¢ÑËÆ°ÁîüÊàêÊñá‰ª∂ÂàóË°®</h4>';
                        
                        data.predicted_files.forEach((file, index) => {
                            fileListHtml += `
                                <div style="margin-bottom: 8px; padding: 8px 12px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 6px; border-left: 3px solid #9b59b6; font-family: 'Courier New', monospace;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span style="font-weight: bold; color: #6f42c1;">${file.filename}</span>
                                        <span style="color: #6c757d; font-size: 12px;">Á¨¨${file.save_count}Ê¨°‰øùÂ≠ò</span>
                                    </div>
                                    <div style="margin-top: 4px; color: #495057; font-size: 13px;">
                                        <span style="background: #e7f3ff; padding: 2px 6px; border-radius: 3px; margin-right: 8px;">ËΩÆÊ¨°: ${file.epoch}</span>
                                        <span style="background: #fff2e7; padding: 2px 6px; border-radius: 3px;">Ê≠•Êï∞: ${file.step_range}</span>
                                    </div>
                                </div>
                            `;
                        });
                        
                        fileListHtml += '</div>';
                        
                        // Â∞ÜÊñá‰ª∂ÂàóË°®Ê∑ªÂä†Âà∞ÁªìÊûúÂå∫Âüü
                        const resultsDiv = document.getElementById('estimation_results');
                        resultsDiv.insertAdjacentHTML('beforeend', fileListHtml);
                    }
                    
                    addLogEntry({
                        level: 'info',
                        message: `‚úÖ ËÆ≠ÁªÉÊó∂Èó¥‰º∞ÁÆóÂÆåÊàê: ${formattedTime} (ÊÄªÊ≠•Êï∞: ${data.total_steps}, Êï∞ÊçÆÈõÜÊñá‰ª∂Êï∞: ${data.dataset_files}, È¢ÑËÆ°ÁîüÊàê${data.predicted_files ? data.predicted_files.length : 0}‰∏™Êñá‰ª∂)`,
                        timestamp: new Date().toLocaleTimeString()
                    });
                } else {
                    // ÈöêËóèÁªìÊûúÂå∫ÂüüÂπ∂ÊòæÁ§∫ÈîôËØØ
                    resultsDiv.style.display = 'none';
                    addLogEntry({
                        level: 'error',
                        message: '‚ùå ËÆ≠ÁªÉÊó∂Èó¥‰º∞ÁÆóÂ§±Ë¥•: ' + data.message,
                        timestamp: new Date().toLocaleTimeString()
                    });
                }
            })
            .catch(error => {
                addLogEntry({
                    level: 'error',
                    message: 'ËÆ≠ÁªÉÊó∂Èó¥‰º∞ÁÆóÂ§±Ë¥•: ' + error.message,
                    timestamp: new Date().toLocaleTimeString()
                });
            });
        }
        
        function setRecommendedNumRepeats() {
            // Ëé∑ÂèñÂøÖË¶ÅÁöÑÂèÇÊï∞
            const datasetConfig = document.getElementById('dataset_config').value;
            const videoTrainingCheckbox = document.getElementById('video_training_checkbox');
            const isVideoTraining = videoTrainingCheckbox ? videoTrainingCheckbox.checked : false;
            const videoDurationInput = document.getElementById('video_duration');
            const videoDuration = videoDurationInput ? (parseFloat(videoDurationInput.value) || 5) : 5;
            const batchSizeInput = document.getElementById('batch_size');
            const batchSize = batchSizeInput ? (parseInt(batchSizeInput.value) || 1) : 1;
            
            console.log('setRecommendedNumRepeats - datasetConfig:', datasetConfig);
            console.log('setRecommendedNumRepeats - isVideoTraining:', isVideoTraining);
            console.log('setRecommendedNumRepeats - videoDuration:', videoDuration);
            
            if (!datasetConfig) {
                addLogEntry({
                    level: 'warning',
                    message: 'ËØ∑ÂÖàÈÄâÊã©Êï∞ÊçÆÈõÜÈÖçÁΩÆÊñá‰ª∂',
                    timestamp: new Date().toLocaleTimeString()
                });
                return;
            }
            
            // Ë∞ÉÁî®ÂêéÁ´ØAPIËé∑ÂèñÊé®ËçêÁöÑnum_repeatsÂÄº
            fetch('/api/calculate_recommended_num_repeats', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    dataset_config: datasetConfig,
                    task_type: currentTaskType,
                    is_video_training: isVideoTraining,
                    video_duration: videoDuration,
                    batch_size: batchSize
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('APIÂìçÂ∫îÊï∞ÊçÆ:', data);
                if (data.success) {
                    // ËÆæÁΩÆÊé®ËçêÁöÑnum_repeatsÂÄºÂà∞ËæìÂÖ•Ê°Ü
                    const numRepeatsInput = document.getElementById('num_repeats');
                    if (numRepeatsInput && data.recommended_repeats !== undefined) {
                        numRepeatsInput.value = data.recommended_repeats;
                    }
                    
                    let message;
                    const recommendedValue = data.recommended_repeats || 'N/A';
                    const datasetFiles = data.dataset_files || 'N/A';
                    const actualVideoDuration = data.video_duration || videoDuration;
                    
                    if (isVideoTraining) {
                        message = `‚úÖ Êé®ËçêÊï∞ÊçÆÈáçÂ§çÊ¨°Êï∞: ${recommendedValue} (ËßÜÈ¢ëËÆ≠ÁªÉÊ®°Âºè, ËßÜÈ¢ëÊó∂Èïø: ${actualVideoDuration}Áßí, Êï∞ÊçÆÈõÜ: ${datasetFiles}‰∏™Êñá‰ª∂)`;
                    } else {
                        message = `‚úÖ Êé®ËçêÊï∞ÊçÆÈáçÂ§çÊ¨°Êï∞: ${recommendedValue} (ÂõæÁâáËÆ≠ÁªÉÊ®°Âºè, Êï∞ÊçÆÈõÜ: ${datasetFiles}‰∏™Êñá‰ª∂)`;
                    }
                    
                    addLogEntry({
                        level: 'success',
                        message: message,
                        timestamp: new Date().toLocaleTimeString()
                    });
                } else {
                    addLogEntry({
                        level: 'error',
                        message: '‚ùå Êé®ËçêÊï∞ÊçÆÈáçÂ§çÊ¨°Êï∞ËÆ°ÁÆóÂ§±Ë¥•: ' + (data.message || 'Êú™Áü•ÈîôËØØ'),
                        timestamp: new Date().toLocaleTimeString()
                    });
                }
            })
            .catch(error => {
                addLogEntry({
                    level: 'error',
                    message: 'Êé®ËçêÊï∞ÊçÆÈáçÂ§çÊ¨°Êï∞ËÆ°ÁÆóÂ§±Ë¥•: ' + error.message,
                    timestamp: new Date().toLocaleTimeString()
                });
            });
        }
        
        function calculateRecommendedLearningRate() {
            // Ëé∑ÂèñÂøÖË¶ÅÁöÑÂèÇÊï∞
            const datasetConfig = document.getElementById('dataset_config').value;
            const trainBatchSize = parseInt(document.getElementById('batch_size').value) || 1;
            const optimizerType = document.getElementById('optimizer_type').value || 'adamw8bit';
            
            if (!datasetConfig) {
                addLogEntry({
                    level: 'warning',
                    message: 'ËØ∑ÂÖàÈÄâÊã©Êï∞ÊçÆÈõÜÈÖçÁΩÆÊñá‰ª∂',
                    timestamp: new Date().toLocaleTimeString()
                });
                return;
            }
            
            // Ê£ÄÊü•ÊòØÂê¶‰∏∫ËßÜÈ¢ëËÆ≠ÁªÉ
            const isVideoTraining = document.getElementById('video_training_checkbox') ? 
                document.getElementById('video_training_checkbox').checked : false;
            
            // Ëé∑ÂèñËßÜÈ¢ëÊó∂Èïø
            const videoDuration = parseFloat(document.getElementById('video_duration').value) || 5;
            
            // ÊòæÁ§∫ËÆ°ÁÆó‰∏≠Áä∂ÊÄÅ
            const resultSpan = document.getElementById('lr_calculation_result');
            if (resultSpan) {
                resultSpan.textContent = 'ËÆ°ÁÆó‰∏≠...';
                resultSpan.style.color = '#ffc107';
            }
            
            // Ë∞ÉÁî®ÂêéÁ´ØAPIËÆ°ÁÆóÊé®ËçêÂ≠¶‰π†Áéá
            fetch('/api/calculate_recommended_learning_rate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    dataset_config: datasetConfig,
                    batch_size: trainBatchSize,
                    optimizer_type: optimizerType,
                    task_type: currentTaskType,
                    is_video_training: isVideoTraining,
                    video_duration: videoDuration
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // ËÆæÁΩÆÊé®ËçêÂ≠¶‰π†ÁéáÂà∞ËæìÂÖ•Ê°Ü
                    document.getElementById('learning_rate').value = data.recommended_lr;
                    
                    // ÊòæÁ§∫ËÆ°ÁÆóËøáÁ®ã
                    if (resultSpan) {
                        // Ê£ÄÊü•ÊòØÂê¶‰∏∫ËßÜÈ¢ëËÆ≠ÁªÉÊ®°Âºè
                        const isVideoTraining = document.getElementById('video_training_checkbox') ? 
                            document.getElementById('video_training_checkbox').checked : false;
                        
                        let datasetInfo;
                        if (isVideoTraining && data.video_duration) {
                            datasetInfo = `üé¨ ËßÜÈ¢ëÊó∂Èïø: ${data.video_duration}Áßí`;
                        } else {
                            datasetInfo = `üìÅ Êï∞ÊçÆÈõÜ: ${data.dataset_files}‰∏™Êñá‰ª∂`;
                        }
                        
                        resultSpan.innerHTML = `
                            üìä ${data.calculation}<br>
                            ${datasetInfo} | üîß ‰ºòÂåñÂô®: ${data.optimizer_type}<br>
                            üí° ${data.optimizer_description}
                        `;
                        resultSpan.style.color = '#28a745';
                    }
                    
                    addLogEntry({
                        level: 'success',
                        message: `‚úÖ Êé®ËçêÂ≠¶‰π†ÁéáËÆ°ÁÆóÂÆåÊàê: ${data.recommended_lr} (‰ºòÂåñÂô®: ${data.optimizer_type}, Êï∞ÊçÆÈõÜ: ${data.dataset_files}‰∏™Êñá‰ª∂)`,
                        timestamp: new Date().toLocaleTimeString()
                    });
                } else {
                    if (resultSpan) {
                        resultSpan.textContent = 'ËÆ°ÁÆóÂ§±Ë¥•: ' + data.message;
                        resultSpan.style.color = '#dc3545';
                    }
                    
                    addLogEntry({
                        level: 'error',
                        message: '‚ùå Êé®ËçêÂ≠¶‰π†ÁéáËÆ°ÁÆóÂ§±Ë¥•: ' + data.message,
                        timestamp: new Date().toLocaleTimeString()
                    });
                }
            })
            .catch(error => {
                if (resultSpan) {
                    resultSpan.textContent = 'ËÆ°ÁÆóÂ§±Ë¥•: ' + error.message;
                    resultSpan.style.color = '#dc3545';
                }
                
                addLogEntry({
                    level: 'error',
                    message: '‚ùå Êé®ËçêÂ≠¶‰π†ÁéáËÆ°ÁÆóÂ§±Ë¥•: ' + error.message,
                    timestamp: new Date().toLocaleTimeString()
                });
            });
        }
        
        function calculateGPTRecommendedLearningRate() {
            // Ëé∑ÂèñÂøÖË¶ÅÁöÑÂèÇÊï∞
            const datasetConfig = document.getElementById('dataset_config').value;
            
            if (!datasetConfig) {
                addLogEntry({
                    level: 'warning',
                    message: 'ËØ∑ÂÖàÈÄâÊã©Êï∞ÊçÆÈõÜÈÖçÁΩÆÊñá‰ª∂',
                    timestamp: new Date().toLocaleTimeString()
                });
                return;
            }
            
            // Ê£ÄÊü•ÊòØÂê¶‰∏∫ËßÜÈ¢ëËÆ≠ÁªÉ
            const isVideoTraining = document.getElementById('video_training_checkbox') ? 
                document.getElementById('video_training_checkbox').checked : false;
            
            // Ëé∑ÂèñËßÜÈ¢ëÊó∂ÈïøÔºàÂè™ÊúâÂú®ËßÜÈ¢ëËÆ≠ÁªÉÊ®°Âºè‰∏ãÊâçËé∑ÂèñÔºâ
            const videoDuration = isVideoTraining && document.getElementById('video_duration') ? 
                parseInt(document.getElementById('video_duration').value) || 5 : 0;
            
            // Ëé∑Âèñ‰ºòÂåñÂô®Á±ªÂûã
            const optimizer = document.getElementById('optimizer_type') ? 
                document.getElementById('optimizer_type').value : 'AdamW';
            
            // Ëé∑ÂèñLoRA rank
            const loraRank = document.getElementById('network_dim') ? 
                parseInt(document.getElementById('network_dim').value) || 8 : 8;
            
            // ÊòæÁ§∫ËÆ°ÁÆó‰∏≠Áä∂ÊÄÅ
            const chatgptResultSpan = document.getElementById('chatgpt_lr_calculation_result');
            if (chatgptResultSpan) {
                chatgptResultSpan.textContent = 'ËÆ°ÁÆó‰∏≠...';
                chatgptResultSpan.style.color = '#ffc107';
            }
            
            // Ë∞ÉÁî®ÂêéÁ´ØAPIËÆ°ÁÆóGPTÊé®ËçêÂ≠¶‰π†Áéá
            fetch('/api/calculate_gpt_recommended_learning_rate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    dataset_config: datasetConfig,
                    task_type: currentTaskType,
                    is_video_training: isVideoTraining,
                    video_duration: videoDuration,
                    optimizer: optimizer,
                    lora_rank: loraRank
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // ËÆæÁΩÆÊé®ËçêÂ≠¶‰π†ÁéáÂíåËÆ≠ÁªÉËΩÆÊï∞Âà∞ËæìÂÖ•Ê°Ü
                    document.getElementById('learning_rate').value = data.recommended_lr;
                    document.getElementById('max_train_epochs').value = data.recommended_epochs;
                    
                    // ÊòæÁ§∫Êô∫ËÉΩÊé®ËçêÁªìÊûú
                    addLogEntry({
                        level: 'success',
                        message: `ü§ñ ChatGPTÊô∫ËÉΩÊé®ËçêÂÆåÊàê! Â≠¶‰π†Áéá: ${data.recommended_lr}, ËÆ≠ÁªÉËΩÆÊï∞: ${data.recommended_epochs}`,
                        timestamp: new Date().toLocaleTimeString()
                    });
                    
                    // ÊòæÁ§∫Êé®ËçêËØ¶ÊÉÖ
                    addLogEntry({
                        level: 'info',
                        message: `üìä ${data.description}`,
                        timestamp: new Date().toLocaleTimeString()
                    });
                    
                    // ÊòæÁ§∫ËÆ°ÁÆóËøáÁ®ãÂú®ChatGPTÊé®ËçêÊèêÁ§∫Ê°Ü‰∏≠
                    if (chatgptResultSpan) {
                        // Ê£ÄÊü•ÊòØÂê¶‰∏∫ËßÜÈ¢ëËÆ≠ÁªÉÊ®°Âºè
                        const isVideoTraining = document.getElementById('video_training_checkbox') ? 
                            document.getElementById('video_training_checkbox').checked : false;
                        
                        let datasetInfo;
                        if (isVideoTraining && data.video_duration) {
                            datasetInfo = `üé¨ ËßÜÈ¢ëÊó∂Èïø: ${data.video_duration}Áßí`;
                        } else {
                            datasetInfo = `üìÅ Êï∞ÊçÆÈõÜ: ${data.txt_count || data.dataset_files || 'N/A'}‰∏™Êñá‰ª∂`;
                        }
                        
                        chatgptResultSpan.innerHTML = `
                            üìä ${data.description}<br>
                            ${datasetInfo} | üîß ‰ºòÂåñÂô®: ${data.optimizer || optimizer}<br>
                            ü§ñ ChatGPTÊô∫ËÉΩÁÆóÊ≥ï: Âü∫‰∫éÊï∞ÊçÆËßÑÊ®°Âä®ÊÄÅË∞ÉÊï¥Â≠¶‰π†Áéá
                        `;
                        chatgptResultSpan.style.color = '#28a745';
                    }
                    
                    // ÊòæÁ§∫ËÆ°ÁÆóÂÖ¨Âºè
                    if (data.recommendation_details && data.recommendation_details.formula) {
                        addLogEntry({
                            level: 'info',
                            message: `üßÆ ËÆ°ÁÆóÂÖ¨Âºè: ${data.recommendation_details.formula}`,
                            timestamp: new Date().toLocaleTimeString()
                        });
                    }
                    
                    // ÊòæÁ§∫ÂÆâÂÖ®ËæπÁïåÂíåwarmupÂª∫ËÆÆ
                    if (data.recommendation_details) {
                        if (data.recommendation_details.safety_bounds) {
                            addLogEntry({
                                level: 'info',
                                message: `üõ°Ô∏è ${data.recommendation_details.safety_bounds}`,
                                timestamp: new Date().toLocaleTimeString()
                            });
                        }
                        if (data.recommendation_details.warmup_suggestion) {
                            addLogEntry({
                                level: 'info',
                                message: `üî• ${data.recommendation_details.warmup_suggestion}`,
                                timestamp: new Date().toLocaleTimeString()
                            });
                        }
                    }
                    
                    // ÊòæÁ§∫ËÆ≠ÁªÉËΩÆÊï∞Êé®ËçêÁêÜÁî±
                    addLogEntry({
                        level: 'info',
                        message: `üîÑ ${data.epoch_reason}`,
                        timestamp: new Date().toLocaleTimeString()
                    });
                } else {
                    if (chatgptResultSpan) {
                        chatgptResultSpan.textContent = 'ËÆ°ÁÆóÂ§±Ë¥•: ' + data.message;
                        chatgptResultSpan.style.color = '#dc3545';
                    }
                    
                    addLogEntry({
                        level: 'error',
                        message: '‚ùå ChatGPTÊé®ËçêÂ≠¶‰π†ÁéáËÆ°ÁÆóÂ§±Ë¥•: ' + data.message,
                        timestamp: new Date().toLocaleTimeString()
                    });
                }
            })
            .catch(error => {
                if (chatgptResultSpan) {
                    chatgptResultSpan.textContent = 'ËÆ°ÁÆóÂ§±Ë¥•: ' + error.message;
                    chatgptResultSpan.style.color = '#dc3545';
                }
                
                addLogEntry({
                    level: 'error',
                    message: '‚ùå GPTÊé®ËçêÂ≠¶‰π†ÁéáËÆ°ÁÆóÂ§±Ë¥•: ' + error.message,
                    timestamp: new Date().toLocaleTimeString()
                });
            });
        }
        
        function calculateRecommendedLoRADim() {
            const datasetConfig = document.getElementById('dataset_config').value;
            
            if (!datasetConfig) {
                addLogEntry({
                    level: 'warning',
                    message: 'ËØ∑ÂÖàÈÄâÊã©Êï∞ÊçÆÈõÜÈÖçÁΩÆÊñá‰ª∂',
                    timestamp: new Date().toLocaleTimeString()
                });
                return;
            }
            
            // Ê£ÄÊü•ÊòØÂê¶‰∏∫ËßÜÈ¢ëËÆ≠ÁªÉ
            const isVideoTraining = document.getElementById('video_training_checkbox') ? 
                document.getElementById('video_training_checkbox').checked : true;
            
            fetch('/api/calculate_recommended_lora_params', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    dataset_config: datasetConfig,
                    param_type: 'network_dim',
                    task_type: currentTaskType,
                    is_video_training: isVideoTraining
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('network_dim').value = data.recommended_value;
                    
                    addLogEntry({
                        level: 'success',
                        message: `‚úÖ Êé®ËçêLoRAÁª¥Â∫¶: ${data.recommended_value} (Êï∞ÊçÆÈõÜ: ${data.dataset_files}‰∏™Êñá‰ª∂) - ${data.reason}`,
                        timestamp: new Date().toLocaleTimeString()
                    });
                } else {
                    addLogEntry({
                        level: 'error',
                        message: '‚ùå LoRAÁª¥Â∫¶Êé®ËçêÂ§±Ë¥•: ' + data.message,
                        timestamp: new Date().toLocaleTimeString()
                    });
                }
            })
            .catch(error => {
                addLogEntry({
                    level: 'error',
                    message: '‚ùå LoRAÁª¥Â∫¶Êé®ËçêÂ§±Ë¥•: ' + error.message,
                    timestamp: new Date().toLocaleTimeString()
                });
            });
        }
        
        function calculateRecommendedLoRAAlpha() {
            const datasetConfig = document.getElementById('dataset_config').value;
            const currentDim = parseInt(document.getElementById('network_dim').value) || 8;
            
            if (!datasetConfig) {
                addLogEntry({
                    level: 'warning',
                    message: 'ËØ∑ÂÖàÈÄâÊã©Êï∞ÊçÆÈõÜÈÖçÁΩÆÊñá‰ª∂',
                    timestamp: new Date().toLocaleTimeString()
                });
                return;
            }
            
            // Ê£ÄÊü•ÊòØÂê¶‰∏∫ËßÜÈ¢ëËÆ≠ÁªÉ
            const isVideoTraining = document.getElementById('video_training_checkbox') ? 
                document.getElementById('video_training_checkbox').checked : true;
            
            fetch('/api/calculate_recommended_lora_params', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    dataset_config: datasetConfig,
                    param_type: 'network_alpha',
                    current_dim: currentDim,
                    task_type: currentTaskType,
                    is_video_training: isVideoTraining
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('network_alpha').value = data.recommended_value;
                    
                    addLogEntry({
                        level: 'success',
                        message: `‚úÖ Êé®ËçêLoRA Alpha: ${data.recommended_value} (ÂΩìÂâçÁª¥Â∫¶: ${data.current_dim}) - ${data.reason}`,
                        timestamp: new Date().toLocaleTimeString()
                    });
                } else {
                    addLogEntry({
                        level: 'error',
                        message: '‚ùå LoRA AlphaÊé®ËçêÂ§±Ë¥•: ' + data.message,
                        timestamp: new Date().toLocaleTimeString()
                    });
                }
            })
            .catch(error => {
                addLogEntry({
                    level: 'error',
                    message: '‚ùå LoRA AlphaÊé®ËçêÂ§±Ë¥•: ' + error.message,
                    timestamp: new Date().toLocaleTimeString()
                });
            });
        }
        
        function calculateRecommendedEpochs() {
            const datasetConfig = document.getElementById('dataset_config').value;
            const trainBatchSize = parseInt(document.getElementById('batch_size').value) || 1;
            const isVideoTraining = document.getElementById('video_training_checkbox') ? 
                document.getElementById('video_training_checkbox').checked : false;
            const videoDuration = parseFloat(document.getElementById('video_duration').value) || 5;
            
            if (!datasetConfig) {
                addLogEntry({
                    level: 'warning',
                    message: 'ËØ∑ÂÖàÈÄâÊã©Êï∞ÊçÆÈõÜÈÖçÁΩÆÊñá‰ª∂',
                    timestamp: new Date().toLocaleTimeString()
                });
                return;
            }
            
            fetch('/api/calculate_recommended_epochs', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    dataset_config: datasetConfig,
                    batch_size: trainBatchSize,
                    task_type: currentTaskType,
                    is_video_training: isVideoTraining,
                    video_duration: videoDuration
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('max_train_epochs').value = data.recommended_value;
                    
                    const timeHours = Math.floor(data.estimated_time_minutes / 60);
                    const timeMinutes = data.estimated_time_minutes % 60;
                    const timeStr = timeHours > 0 ? `${timeHours}Â∞èÊó∂${timeMinutes}ÂàÜÈíü` : `${timeMinutes}ÂàÜÈíü`;
                    
                    addLogEntry({
                        level: 'success',
                        message: `‚úÖ Êé®ËçêËÆ≠ÁªÉËΩÆÊï∞: ${data.recommended_value} (Êï∞ÊçÆÈõÜ: ${data.dataset_files}Âº†, È¢Ñ‰º∞Êó∂Èó¥: ${timeStr}) - ${data.reason}`,
                        timestamp: new Date().toLocaleTimeString()
                    });
                } else {
                    addLogEntry({
                        level: 'error',
                        message: '‚ùå ËÆ≠ÁªÉËΩÆÊï∞Êé®ËçêÂ§±Ë¥•: ' + data.message,
                        timestamp: new Date().toLocaleTimeString()
                    });
                }
            })
            .catch(error => {
                addLogEntry({
                    level: 'error',
                    message: '‚ùå ËÆ≠ÁªÉËΩÆÊï∞Êé®ËçêÂ§±Ë¥•: ' + error.message,
                    timestamp: new Date().toLocaleTimeString()
                });
            });
        }
        
        function calculateChatGPTRecommendedParams() {
            const datasetConfig = document.getElementById('dataset_config').value;
            
            if (!datasetConfig) {
                addLogEntry({
                    level: 'warning',
                    message: 'ËØ∑ÂÖàÈÄâÊã©Êï∞ÊçÆÈõÜÈÖçÁΩÆÊñá‰ª∂',
                    timestamp: new Date().toLocaleTimeString()
                });
                return;
            }
            
            // Ê£ÄÊü•ÊòØÂê¶‰∏∫ËßÜÈ¢ëËÆ≠ÁªÉ
            const isVideoTraining = document.getElementById('video_training_checkbox') ? 
                document.getElementById('video_training_checkbox').checked : true;
            
            // Ëé∑ÂèñËßÜÈ¢ëÊó∂ÈïøÔºàÂ¶ÇÊûúÊòØËßÜÈ¢ëËÆ≠ÁªÉÔºâ
            const videoDuration = isVideoTraining && document.getElementById('video_duration') ? 
                parseInt(document.getElementById('video_duration').value) || 5 : 5;
            
            // Ëé∑ÂèñÊâπÊ¨°Â§ßÂ∞è
            const batchSize = document.getElementById('batch_size') ?
                parseInt(document.getElementById('batch_size').value) || 1 : 1;
            
            // ÊòæÁ§∫ËÆ°ÁÆó‰∏≠Áä∂ÊÄÅ
            const resultDiv = document.getElementById('chatgpt_params_result');
            if (resultDiv) {
                resultDiv.innerHTML = 'ü§ñ ChatGPTÊ≠£Âú®ËÆ°ÁÆóÊé®ËçêÂèÇÊï∞...';
                resultDiv.style.display = 'block';
                resultDiv.style.color = '#ffc107';
            }
            
            fetch('/api/calculate_chatgpt_recommended_params', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    dataset_config: datasetConfig,
                    task_type: currentTaskType,
                    is_video_training: isVideoTraining,
                    video_duration: videoDuration,
                    batch_size: batchSize
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Ëá™Âä®Â°´ÂÖ•ÊâÄÊúâÊé®ËçêÁöÑÂèÇÊï∞ÂÄº
                    if (data.num_repeats && document.getElementById('num_repeats')) {
                        document.getElementById('num_repeats').value = data.num_repeats;
                    }
                    if (data.learning_rate && document.getElementById('learning_rate')) {
                        document.getElementById('learning_rate').value = data.learning_rate;
                    }
                    if (data.network_dim && document.getElementById('network_dim')) {
                        document.getElementById('network_dim').value = data.network_dim;
                    }
                    if (data.network_alpha && document.getElementById('network_alpha')) {
                        document.getElementById('network_alpha').value = data.network_alpha;
                    }
                    if (data.max_train_epochs && document.getElementById('max_train_epochs')) {
                        document.getElementById('max_train_epochs').value = data.max_train_epochs;
                    }
                    
                    // ÊòæÁ§∫Êé®ËçêÁªìÊûúÂíåËÆ°ÁÆóÂÖ¨Âºè
                    if (resultDiv) {
                        let datasetInfo;
                        if (isVideoTraining && data.video_duration) {
                            datasetInfo = `üé¨ ËßÜÈ¢ëÊó∂Èïø: ${data.video_duration}Áßí`;
                        } else {
                            datasetInfo = `üìÅ Êï∞ÊçÆÈõÜ: ${data.dataset_files || 'N/A'}‰∏™Êñá‰ª∂`;
                        }
                        
                        resultDiv.innerHTML = `
                            <div style="font-weight: bold; margin-bottom: 8px;">ü§ñ ChatGPTÊô∫ËÉΩÊé®ËçêÂÆåÊàê</div>
                            <div style="margin-bottom: 6px;">${datasetInfo} | üìã ‰ªªÂä°: ${data.task_type || currentTaskType}</div>
                            <div style="margin-bottom: 8px; padding: 6px; background: #e3f2fd; border-radius: 4px;">
                                üìä <strong>Êé®ËçêÂèÇÊï∞:</strong><br>
                                ‚Ä¢ Êï∞ÊçÆÈáçÂ§çÊ¨°Êï∞: ${data.num_repeats || 'N/A'}<br>
                                ‚Ä¢ Â≠¶‰π†Áéá: ${data.learning_rate || 'N/A'}<br>
                                ‚Ä¢ LoRAÁª¥Â∫¶: ${data.network_dim || 'N/A'}<br>
                                ‚Ä¢ ÁΩëÁªúAlpha: ${data.network_alpha || 'N/A'}<br>
                                ‚Ä¢ ÊúÄÂ§ßËÆ≠ÁªÉËΩÆÊï∞: ${data.max_train_epochs || 'N/A'}<br>
                                ‚Ä¢ ÊâπÊ¨°Â§ßÂ∞è: ${data.batch_size || 'N/A'}
                            </div>
                            <div style="font-size: 11px; color: #666;">
                                üßÆ <strong>ChatGPTËÆ°ÁÆóÂÖ¨Âºè:</strong><br>
                                ${data.formula || 'Âü∫‰∫éÊï∞ÊçÆËßÑÊ®°Âíå‰ªªÂä°Á±ªÂûãÁöÑÊô∫ËÉΩÁÆóÊ≥ï'}
                            </div>
                        `;
                        resultDiv.style.color = '#28a745';
                    }
                    
                    addLogEntry({
                        level: 'success',
                        message: `ü§ñ ChatGPTÂèÇÊï∞Êé®ËçêÂÆåÊàê! Â∑≤Ëá™Âä®Â°´ÂÖ•ÊâÄÊúâÊé®ËçêÂèÇÊï∞`,
                        timestamp: new Date().toLocaleTimeString()
                    });
                    
                    // ÊòæÁ§∫ÊØè‰∏™ÂèÇÊï∞ÁöÑÊé®ËçêÁêÜÁî±
                    if (data.reasons) {
                        Object.keys(data.reasons).forEach(param => {
                            addLogEntry({
                                level: 'info',
                                message: `üìù ${param}: ${data.reasons[param]}`,
                                timestamp: new Date().toLocaleTimeString()
                            });
                        });
                    }
                } else {
                    if (resultDiv) {
                        resultDiv.innerHTML = '‚ùå ChatGPTÂèÇÊï∞Êé®ËçêÂ§±Ë¥•: ' + data.message;
                        resultDiv.style.color = '#dc3545';
                    }
                    addLogEntry({
                        level: 'error',
                        message: '‚ùå ChatGPTÂèÇÊï∞Êé®ËçêÂ§±Ë¥•: ' + data.message,
                        timestamp: new Date().toLocaleTimeString()
                    });
                }
            })
            .catch(error => {
                if (resultDiv) {
                    resultDiv.innerHTML = '‚ùå ÁΩëÁªúÈîôËØØ: ' + error.message;
                    resultDiv.style.color = '#dc3545';
                }
                addLogEntry({
                    level: 'error',
                    message: '‚ùå ChatGPTÂèÇÊï∞Êé®ËçêÂ§±Ë¥•: ' + error.message,
                    timestamp: new Date().toLocaleTimeString()
                });
            });
        }
        
        function calculateDoubaoRecommendedParams() {
            const datasetConfig = document.getElementById('dataset_config').value;
            
            if (!datasetConfig) {
                addLogEntry({
                    level: 'warning',
                    message: 'ËØ∑ÂÖàÈÄâÊã©Êï∞ÊçÆÈõÜÈÖçÁΩÆÊñá‰ª∂',
                    timestamp: new Date().toLocaleTimeString()
                });
                return;
            }
            
            // Ê£ÄÊü•ÊòØÂê¶‰∏∫ËßÜÈ¢ëËÆ≠ÁªÉ
            const isVideoTraining = document.getElementById('video_training_checkbox') ? 
                document.getElementById('video_training_checkbox').checked : true;
            
            // Ëé∑ÂèñËßÜÈ¢ëÊó∂ÈïøÔºàÂ¶ÇÊûúÊòØËßÜÈ¢ëËÆ≠ÁªÉÔºâ
            const videoDuration = isVideoTraining && document.getElementById('video_duration') ? 
                parseInt(document.getElementById('video_duration').value) || 5 : 5;
            
            // Ëé∑ÂèñÊâπÊ¨°Â§ßÂ∞è
            const batchSize = document.getElementById('batch_size') ?
                parseInt(document.getElementById('batch_size').value) || 1 : 1;
            
            // ÊòæÁ§∫ËÆ°ÁÆó‰∏≠Áä∂ÊÄÅ
            const resultDiv = document.getElementById('doubao_params_result');
            if (resultDiv) {
                resultDiv.innerHTML = 'üß† Ë±ÜÂåÖÊ≠£Âú®ËÆ°ÁÆóÊé®ËçêÂèÇÊï∞...';
                resultDiv.style.display = 'block';
                resultDiv.style.color = '#ffc107';
            }
            
            fetch('/api/calculate_doubao_recommended_params', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    dataset_config: datasetConfig,
                    task_type: currentTaskType,
                    is_video_training: isVideoTraining,
                    video_duration: videoDuration,
                    batch_size: batchSize
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Ëá™Âä®Â°´ÂÖ•ÊâÄÊúâÊé®ËçêÁöÑÂèÇÊï∞ÂÄº
                    if (data.recommended_params.num_repeats && document.getElementById('num_repeats')) {
                        document.getElementById('num_repeats').value = data.recommended_params.num_repeats;
                    }
                    if (data.recommended_params.learning_rate && document.getElementById('learning_rate')) {
                        document.getElementById('learning_rate').value = data.recommended_params.learning_rate;
                    }
                    if (data.recommended_params.network_dim && document.getElementById('network_dim')) {
                        document.getElementById('network_dim').value = data.recommended_params.network_dim;
                    }
                    if (data.recommended_params.network_alpha && document.getElementById('network_alpha')) {
                        document.getElementById('network_alpha').value = data.recommended_params.network_alpha;
                    }
                    if (data.recommended_params.max_train_epochs && document.getElementById('max_train_epochs')) {
                        document.getElementById('max_train_epochs').value = data.recommended_params.max_train_epochs;
                    }
                    if (data.recommended_params.batch_size && document.getElementById('batch_size')) {
                        document.getElementById('batch_size').value = data.recommended_params.batch_size;
                    }
                    
                    // ÊòæÁ§∫Êé®ËçêÁªìÊûú
                    if (resultDiv) {
                        resultDiv.innerHTML = `
                            <div style="font-weight: bold; margin-bottom: 8px;">üß† Ë±ÜÂåÖÊô∫ËÉΩÊé®ËçêÂÆåÊàê</div>
                            <div style="margin-bottom: 8px; padding: 6px; background: #e8f4fd; border-radius: 4px;">
                                üìä <strong>Êé®ËçêÂèÇÊï∞:</strong><br>
                                ‚Ä¢ Â≠¶‰π†Áéá: ${data.recommended_params.learning_rate || 'N/A'}<br>
                                ‚Ä¢ LoRAÁª¥Â∫¶: ${data.recommended_params.network_dim || 'N/A'}<br>
                                ‚Ä¢ LoRA Alpha: ${data.recommended_params.network_alpha || 'N/A'}<br>
                                ‚Ä¢ ËÆ≠ÁªÉËΩÆÊï∞: ${data.recommended_params.max_train_epochs || 'N/A'}<br>
                                ‚Ä¢ ÈáçÂ§çÊ¨°Êï∞: ${data.recommended_params.num_repeats || 'N/A'}<br>
                                ‚Ä¢ ÊâπÊ¨°Â§ßÂ∞è: ${data.recommended_params.batch_size || 'N/A'}
                            </div>
                            <div style="font-size: 11px; color: #666; white-space: pre-line;">
                                ${data.reasoning || 'Ë±ÜÂåÖÊï∞Â≠¶Âª∫Ê®°ÁÆóÊ≥ïÊé®Ëçê'}
                            </div>
                        `;
                        resultDiv.style.color = '#4A90E2';
                    }
                    
                    addLogEntry({
                        level: 'success',
                        message: `üß† Ë±ÜÂåÖÂèÇÊï∞Êé®ËçêÂÆåÊàê! Â∑≤Ëá™Âä®Â°´ÂÖ•ÊâÄÊúâÊé®ËçêÂèÇÊï∞`,
                        timestamp: new Date().toLocaleTimeString()
                    });
                } else {
                    if (resultDiv) {
                        resultDiv.innerHTML = '‚ùå Ë±ÜÂåÖÂèÇÊï∞Êé®ËçêÂ§±Ë¥•: ' + data.message;
                        resultDiv.style.color = '#dc3545';
                    }
                    addLogEntry({
                        level: 'error',
                        message: '‚ùå Ë±ÜÂåÖÂèÇÊï∞Êé®ËçêÂ§±Ë¥•: ' + data.message,
                        timestamp: new Date().toLocaleTimeString()
                    });
                }
            })
            .catch(error => {
                if (resultDiv) {
                    resultDiv.innerHTML = '‚ùå ÁΩëÁªúÈîôËØØ: ' + error.message;
                    resultDiv.style.color = '#dc3545';
                }
                addLogEntry({
                    level: 'error',
                    message: '‚ùå Ë±ÜÂåÖÂèÇÊï∞Êé®ËçêÂ§±Ë¥•: ' + error.message,
                    timestamp: new Date().toLocaleTimeString()
                });
            });
        }
        
        function calculateSoftwareRecommendedParams() {
            const datasetConfig = document.getElementById('dataset_config').value;
            
            if (!datasetConfig) {
                addLogEntry({
                    level: 'warning',
                    message: 'ËØ∑ÂÖàÈÄâÊã©Êï∞ÊçÆÈõÜÈÖçÁΩÆÊñá‰ª∂',
                    timestamp: new Date().toLocaleTimeString()
                });
                return;
            }
            
            // ÂºπÁ™óÈÄâÊã©LoRAÁ±ªÂûã
            const loraTypeModal = document.createElement('div');
            loraTypeModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white;
                padding: 30px;
                border-radius: 12px;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
                text-align: center;
                max-width: 400px;
                width: 90%;
            `;
            
            modalContent.innerHTML = `
                <h3 style="margin: 0 0 20px 0; color: #333; font-size: 18px;">‚öôÔ∏è ÈÄâÊã©LoRAËÆ≠ÁªÉÁ±ªÂûã</h3>
                <p style="margin: 0 0 25px 0; color: #666; line-height: 1.5;">ËØ∑ÈÄâÊã©ÊÇ®Ë¶ÅËÆ≠ÁªÉÁöÑLoRAÁ±ªÂûãÔºåËΩØ‰ª∂Â∞ÜÊ†πÊçÆ‰∏çÂêåÁ±ªÂûãÊèê‰æõ‰∏ìÈó®‰ºòÂåñÁöÑÂèÇÊï∞Ôºö</p>
                <div style="display: flex; gap: 15px; justify-content: center;">
                    <button id="realistic-btn" style="
                        background: linear-gradient(45deg, #FF6B6B, #FF8E53);
                        color: white;
                        border: none;
                        padding: 12px 20px;
                        border-radius: 8px;
                        cursor: pointer;
                        font-size: 14px;
                        font-weight: bold;
                        transition: all 0.3s ease;
                        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
                    ">üì∏ ÂÜôÂÆûÈ£éÊ†º</button>
                    <button id="anime-btn" style="
                        background: linear-gradient(45deg, #4A90E2, #7B68EE);
                        color: white;
                        border: none;
                        padding: 12px 20px;
                        border-radius: 8px;
                        cursor: pointer;
                        font-size: 14px;
                        font-weight: bold;
                        transition: all 0.3s ease;
                        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
                    ">üé® Âä®Êº´È£éÊ†º</button>
                </div>
                <button id="cancel-btn" style="
                    background: #6c757d;
                    color: white;
                    border: none;
                    padding: 8px 16px;
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 12px;
                    margin-top: 15px;
                ">ÂèñÊ∂à</button>
            `;
            
            loraTypeModal.appendChild(modalContent);
            document.body.appendChild(loraTypeModal);
            
            // Ê∑ªÂä†ÊåâÈíÆ‰∫ã‰ª∂
            document.getElementById('realistic-btn').onclick = () => {
                document.body.removeChild(loraTypeModal);
                performSoftwareRecommendation('realistic');
            };
            
            document.getElementById('anime-btn').onclick = () => {
                document.body.removeChild(loraTypeModal);
                performSoftwareRecommendation('anime');
            };
            
            document.getElementById('cancel-btn').onclick = () => {
                document.body.removeChild(loraTypeModal);
            };
            
            // ÁÇπÂáªËÉåÊôØÂÖ≥Èó≠
            loraTypeModal.onclick = (e) => {
                if (e.target === loraTypeModal) {
                    document.body.removeChild(loraTypeModal);
                }
            };
        }
        
        function performSoftwareRecommendation(loraType) {
            const datasetConfig = document.getElementById('dataset_config').value;
            
            // Ê£ÄÊü•ÊòØÂê¶‰∏∫ËßÜÈ¢ëËÆ≠ÁªÉ
            const isVideoTraining = document.getElementById('video_training_checkbox') ? 
                document.getElementById('video_training_checkbox').checked : false;
            
            // Ëé∑ÂèñËßÜÈ¢ëÊó∂ÈïøÔºàÂ¶ÇÊûúÊòØËßÜÈ¢ëËÆ≠ÁªÉÔºâ
            const videoDuration = isVideoTraining && document.getElementById('video_duration') ? 
                parseInt(document.getElementById('video_duration').value) || 0 : 0;
            
            // Ëé∑ÂèñÊâπÊ¨°Â§ßÂ∞è
            const batchSize = document.getElementById('batch_size') ?
                parseInt(document.getElementById('batch_size').value) || 1 : 1;
            
            // ÊòæÁ§∫ËÆ°ÁÆó‰∏≠Áä∂ÊÄÅ
            const resultDiv = document.getElementById('software_params_result');
            if (resultDiv) {
                const loraTypeName = loraType === 'realistic' ? 'ÂÜôÂÆûÈ£éÊ†º' : 'Âä®Êº´È£éÊ†º';
                resultDiv.innerHTML = `‚öôÔ∏è ËΩØ‰ª∂Ê≠£Âú®‰∏∫${loraTypeName}ËÆ°ÁÆóÊé®ËçêÂèÇÊï∞...`;
                resultDiv.style.display = 'block';
                resultDiv.style.color = '#ffc107';
            }
            
            fetch('/api/calculate_software_recommended_params', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    dataset_config: datasetConfig,
                    task_type: currentTaskType,
                    is_video_training: isVideoTraining,
                    video_duration: videoDuration,
                    batch_size: batchSize,
                    lora_type: loraType
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Ëá™Âä®Â°´ÂÖ•ÊâÄÊúâÊé®ËçêÁöÑÂèÇÊï∞ÂÄº
                    if (data.recommended_params.num_repeats && document.getElementById('num_repeats')) {
                        document.getElementById('num_repeats').value = data.recommended_params.num_repeats;
                    }
                    if (data.recommended_params.learning_rate && document.getElementById('learning_rate')) {
                        document.getElementById('learning_rate').value = data.recommended_params.learning_rate;
                    }
                    if (data.recommended_params.network_dim && document.getElementById('network_dim')) {
                        document.getElementById('network_dim').value = data.recommended_params.network_dim;
                    }
                    if (data.recommended_params.network_alpha && document.getElementById('network_alpha')) {
                        document.getElementById('network_alpha').value = data.recommended_params.network_alpha;
                    }
                    if (data.recommended_params.max_train_epochs && document.getElementById('max_train_epochs')) {
                        document.getElementById('max_train_epochs').value = data.recommended_params.max_train_epochs;
                    }
                    
                    // ÊòæÁ§∫Êé®ËçêÁªìÊûú
                    if (resultDiv) {
                        const loraTypeName = loraType === 'realistic' ? 'ÂÜôÂÆûÈ£éÊ†º' : 'Âä®Êº´È£éÊ†º';
                        resultDiv.innerHTML = `
                            <div style="font-weight: bold; margin-bottom: 8px;">‚öôÔ∏è ËΩØ‰ª∂Êô∫ËÉΩÊé®ËçêÂÆåÊàê (${loraTypeName})</div>
                            <div style="margin-bottom: 8px; padding: 6px; background: #e8f5e8; border-radius: 4px;">
                                üìä <strong>Êé®ËçêÂèÇÊï∞:</strong><br>
                                ‚Ä¢ Â≠¶‰π†Áéá: ${data.recommended_params.learning_rate || 'N/A'}<br>
                                ‚Ä¢ LoRAÁª¥Â∫¶: ${data.recommended_params.network_dim || 'N/A'}<br>
                                ‚Ä¢ LoRA Alpha: ${data.recommended_params.network_alpha || 'N/A'}<br>
                                ‚Ä¢ ËÆ≠ÁªÉËΩÆÊï∞: ${data.recommended_params.max_train_epochs || 'N/A'}<br>
                                ‚Ä¢ ÈáçÂ§çÊ¨°Êï∞: ${data.recommended_params.num_repeats || 'N/A'}
                            </div>
                            <div style="font-size: 11px; color: #666; white-space: pre-line;">
                                ${data.reasoning || 'ËΩØ‰ª∂‰∏ì‰∏öÂèÇÊï∞Êé®Ëçê'}
                            </div>
                        `;
                        resultDiv.style.color = '#28A745';
                    }
                    
                    const loraTypeName = loraType === 'realistic' ? 'ÂÜôÂÆûÈ£éÊ†º' : 'Âä®Êº´È£éÊ†º';
                    addLogEntry({
                        level: 'success',
                        message: `‚öôÔ∏è ËΩØ‰ª∂ÂèÇÊï∞Êé®ËçêÂÆåÊàê(${loraTypeName})! Â∑≤Ëá™Âä®Â°´ÂÖ•ÊâÄÊúâÊé®ËçêÂèÇÊï∞`,
                        timestamp: new Date().toLocaleTimeString()
                    });
                } else {
                    if (resultDiv) {
                        resultDiv.innerHTML = '‚ùå ËΩØ‰ª∂ÂèÇÊï∞Êé®ËçêÂ§±Ë¥•: ' + data.message;
                        resultDiv.style.color = '#dc3545';
                    }
                    addLogEntry({
                        level: 'error',
                        message: '‚ùå ËΩØ‰ª∂ÂèÇÊï∞Êé®ËçêÂ§±Ë¥•: ' + data.message,
                        timestamp: new Date().toLocaleTimeString()
                    });
                }
            })
            .catch(error => {
                if (resultDiv) {
                    resultDiv.innerHTML = '‚ùå ÁΩëÁªúÈîôËØØ: ' + error.message;
                    resultDiv.style.color = '#dc3545';
                }
                addLogEntry({
                    level: 'error',
                    message: '‚ùå ËΩØ‰ª∂ÂèÇÊï∞Êé®ËçêÂ§±Ë¥•: ' + error.message,
                    timestamp: new Date().toLocaleTimeString()
                });
            });
        }
        
        function setRecommendedNetworkDim() {
            const datasetConfig = document.getElementById('dataset_config').value;
            
            if (!datasetConfig) {
                addLogEntry({
                    level: 'warning',
                    message: 'ËØ∑ÂÖàÈÄâÊã©Êï∞ÊçÆÈõÜÈÖçÁΩÆÊñá‰ª∂',
                    timestamp: new Date().toLocaleTimeString()
                });
                return;
            }
            
            const isVideoTraining = document.getElementById('video_training_checkbox') ? 
                document.getElementById('video_training_checkbox').checked : false;
            const videoDuration = parseFloat(document.getElementById('video_duration').value) || 5;
            
            fetch('/api/calculate_recommended_network_dim', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    dataset_config: datasetConfig,
                    task_type: currentTaskType,
                    is_video_training: isVideoTraining,
                    video_duration: videoDuration
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('network_dim').value = data.recommended_dim;
                    
                    let message;
                    if (isVideoTraining) {
                        message = `‚úÖ Êé®ËçêLoRAÁª¥Â∫¶: ${data.recommended_dim} (ËßÜÈ¢ëËÆ≠ÁªÉÊ®°Âºè, ËßÜÈ¢ëÊó∂Èïø: ${videoDuration}Áßí, Êï∞ÊçÆÈõÜ: ${data.dataset_files || 'N/A'}‰∏™Êñá‰ª∂)`;
                    } else {
                        message = `‚úÖ Êé®ËçêLoRAÁª¥Â∫¶: ${data.recommended_dim} (ÂõæÁâáËÆ≠ÁªÉÊ®°Âºè, Êï∞ÊçÆÈõÜ: ${data.dataset_files}‰∏™Êñá‰ª∂)`;
                    }
                    
                    addLogEntry({
                        level: 'success',
                        message: message,
                        timestamp: new Date().toLocaleTimeString()
                    });
                } else {
                    addLogEntry({
                        level: 'error',
                        message: '‚ùå LoRAÁª¥Â∫¶Êé®ËçêÂ§±Ë¥•: ' + data.message,
                        timestamp: new Date().toLocaleTimeString()
                    });
                }
            })
            .catch(error => {
                addLogEntry({
                    level: 'error',
                    message: 'LoRAÁª¥Â∫¶Êé®ËçêÂ§±Ë¥•: ' + error.message,
                    timestamp: new Date().toLocaleTimeString()
                });
            });
        }
        
        function setRecommendedNetworkAlpha() {
            const datasetConfig = document.getElementById('dataset_config').value;
            const networkDim = parseInt(document.getElementById('network_dim').value) || 16;
            
            if (!datasetConfig) {
                addLogEntry({
                    level: 'warning',
                    message: 'ËØ∑ÂÖàÈÄâÊã©Êï∞ÊçÆÈõÜÈÖçÁΩÆÊñá‰ª∂',
                    timestamp: new Date().toLocaleTimeString()
                });
                return;
            }
            
            const isVideoTraining = document.getElementById('video_training_checkbox') ? 
                document.getElementById('video_training_checkbox').checked : false;
            const videoDuration = parseFloat(document.getElementById('video_duration').value) || 5;
            
            fetch('/api/calculate_recommended_network_alpha', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    dataset_config: datasetConfig,
                    task_type: currentTaskType,
                    is_video_training: isVideoTraining,
                    video_duration: videoDuration,
                    network_dim: networkDim
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('network_alpha').value = data.recommended_alpha;
                    
                    let message;
                    if (isVideoTraining) {
                        message = `‚úÖ Êé®ËçêLoRA Alpha: ${data.recommended_alpha} (ËßÜÈ¢ëËÆ≠ÁªÉÊ®°Âºè, Áª¥Â∫¶: ${networkDim}, ËßÜÈ¢ëÊó∂Èïø: ${videoDuration}Áßí)`;
                    } else {
                        message = `‚úÖ Êé®ËçêLoRA Alpha: ${data.recommended_alpha} (ÂõæÁâáËÆ≠ÁªÉÊ®°Âºè, Áª¥Â∫¶: ${networkDim}, Êï∞ÊçÆÈõÜ: ${data.dataset_files}‰∏™Êñá‰ª∂)`;
                    }
                    
                    addLogEntry({
                        level: 'success',
                        message: message,
                        timestamp: new Date().toLocaleTimeString()
                    });
                } else {
                    addLogEntry({
                        level: 'error',
                        message: '‚ùå LoRA AlphaÊé®ËçêÂ§±Ë¥•: ' + data.message,
                        timestamp: new Date().toLocaleTimeString()
                    });
                }
            })
            .catch(error => {
                addLogEntry({
                    level: 'error',
                    message: 'LoRA AlphaÊé®ËçêÂ§±Ë¥•: ' + error.message,
                    timestamp: new Date().toLocaleTimeString()
                });
            });
        }
        
        function toggleSection(sectionId) {
            const content = document.getElementById(sectionId);
            const icon = document.getElementById(sectionId.replace('-params', '-toggle-icon'));
            
            if (content.style.display === 'none' || content.style.display === '') {
                content.style.display = 'block';
                icon.textContent = '‚ñ≤';
            } else {
                content.style.display = 'none';
                icon.textContent = '‚ñº';
            }
        }
        
        // ÂÜÖÂ≠ò‰ºòÂåñÁ≠ñÁï•ÂàáÊç¢Â§ÑÁêÜ
        function handleMemoryOptimizationChange() {
            const strategy = document.getElementById('memory_optimization_strategy').value;
            const blocksConfig = document.getElementById('blocks_to_swap_config');
            
            if (strategy === 'blocks_to_swap') {
                blocksConfig.style.display = 'block';
            } else {
                blocksConfig.style.display = 'none';
            }
        }
        
        // ÂàáÊç¢Êñ≠ÁÇπÁª≠ËÆ≠ÈÄâÈ°πÊòæÁ§∫
        function toggleResumeOptions() {
            const resumeCheckbox = document.getElementById('resume_training');
            const resumePathGroup = document.getElementById('resume_path_group');
            
            if (resumeCheckbox.checked) {
                resumePathGroup.style.display = 'block';
            } else {
                resumePathGroup.style.display = 'none';
                // Ê∏ÖÁ©∫Ë∑ØÂæÑËæìÂÖ•Ê°Ü
                document.getElementById('resume').value = '';
            }
        }
        
        // Ëé∑ÂèñÂÜÖÂ≠ò‰ºòÂåñÈÖçÁΩÆ
        function getMemoryOptimizationConfig() {
            const strategy = document.getElementById('memory_optimization_strategy').value;
            
            if (strategy === 'blocks_to_swap') {
                const blocksValue = parseInt(document.getElementById('blocks_to_swap').value) || 20;
                return {
                    blocks_to_swap: blocksValue,
                    offload_inactive_dit: false
                };
            } else {
                return {
                    blocks_to_swap: 0,
                    offload_inactive_dit: true
                };
            }
        }
        
        // ÂàáÊç¢Áä∂ÊÄÅÊñá‰ª∂Â§πË∑ØÂæÑËæìÂÖ•Ê°ÜÊòæÁ§∫/ÈöêËóè

        
        // ÂàáÊç¢ËßÜÈ¢ëËÆæÁΩÆÊòæÁ§∫/ÈöêËóè
        function toggleVideoSettings() {
            const checkbox = document.getElementById('video_training_checkbox');
            const settings = document.getElementById('video_duration_settings');
            
            if (checkbox.checked) {
                settings.style.display = 'block';
                // Ê∑ªÂä†Â±ïÂºÄÂä®ÁîªÊïàÊûú
                settings.style.opacity = '0';
                settings.style.transform = 'translateY(-10px)';
                setTimeout(() => {
                    settings.style.transition = 'all 0.3s ease';
                    settings.style.opacity = '1';
                    settings.style.transform = 'translateY(0)';
                }, 10);
            } else {
                settings.style.transition = 'all 0.3s ease';
                settings.style.opacity = '0';
                settings.style.transform = 'translateY(-10px)';
                setTimeout(() => {
                    settings.style.display = 'none';
                }, 300);
            }
        }
        
        // Socket.IOÂÆ¢Êà∑Á´ØËøûÊé•
        let socket = null;
        
        function initializeSocket() {
            socket = io();
            
            socket.on('connect', function() {
                console.log('WebSocketËøûÊé•Â∑≤Âª∫Á´ã');
                addLogEntry({
                    level: 'success',
                    message: 'WebSocketËøûÊé•Â∑≤Âª∫Á´ãÔºåÂºÄÂßãÊé•Êî∂ÂÆûÊó∂Êó•Âøó',
                    timestamp: new Date().toLocaleTimeString()
                });
            });
            
            socket.on('disconnect', function() {
                console.log('WebSocketËøûÊé•Â∑≤Êñ≠ÂºÄ');
                addLogEntry({
                    level: 'warning',
                    message: 'WebSocketËøûÊé•Â∑≤Êñ≠ÂºÄ',
                    timestamp: new Date().toLocaleTimeString()
                });
            });
            
            socket.on('log_message', function(logEntry) {
                addLogEntry(logEntry);
            });
            
            socket.on('connect_error', function(error) {
                console.error('WebSocketËøûÊé•ÈîôËØØ:', error);
                addLogEntry({
                    level: 'error',
                    message: 'WebSocketËøûÊé•ÈîôËØØÔºåÂõûÈÄÄÂà∞ËΩÆËØ¢Ê®°Âºè',
                    timestamp: new Date().toLocaleTimeString()
                });
                // Â¶ÇÊûúWebSocketËøûÊé•Â§±Ë¥•ÔºåÂõûÈÄÄÂà∞ËΩÆËØ¢Ê®°Âºè
                setInterval(fetchLogs, 2000);
            });
        }
        
        function toggleRecommendationTip() {
            const tip = document.getElementById('recommendation-tip');
            const icon = document.getElementById('tip-icon');
            
            if (tip.style.display === 'none' || tip.style.display === '') {
                tip.style.display = 'block';
                icon.textContent = 'üìñ';
            } else {
                tip.style.display = 'none';
                icon.textContent = 'üí°';
            }
        }
        
        function toggleLearningRateRecommendationTip() {
            const tip = document.getElementById('lr-recommendation-tip');
            const icon = document.getElementById('lr-tip-icon');
            
            if (tip.style.display === 'none' || tip.style.display === '') {
                tip.style.display = 'block';
                icon.textContent = 'üìñ';
            } else {
                tip.style.display = 'none';
                icon.textContent = 'üí°';
            }
        }
        
        function toggleChatGPTLearningRateRecommendationTip() {
            const tip = document.getElementById('chatgpt-lr-recommendation-tip');
            const icon = document.getElementById('chatgpt-lr-tip-icon');
            
            if (tip.style.display === 'none' || tip.style.display === '') {
                tip.style.display = 'block';
                icon.textContent = 'üìö';
            } else {
                tip.style.display = 'none';
                icon.textContent = 'ü§ñ';
            }
        }
        
        function toggleChatGPTRecommendationTip() {
            const tip = document.getElementById('chatgpt-recommendation-tip');
            const icon = document.getElementById('chatgpt-tip-icon');
            
            if (tip.style.display === 'none' || tip.style.display === '') {
                tip.style.display = 'block';
                icon.textContent = 'üìö';
            } else {
                tip.style.display = 'none';
                icon.textContent = 'ü§ñ';
            }
        }
        
        function setChatGPTRecommendedNumRepeats() {
            // Ëé∑ÂèñÂøÖË¶ÅÁöÑÂèÇÊï∞
            const datasetConfig = document.getElementById('dataset_config').value;
            const videoTrainingCheckbox = document.getElementById('video_training_checkbox');
            const isVideoTraining = videoTrainingCheckbox ? videoTrainingCheckbox.checked : false;
            const videoDurationInput = document.getElementById('video_duration');
            const videoDuration = videoDurationInput ? (parseFloat(videoDurationInput.value) || 5) : 5;
            const batchSizeInput = document.getElementById('batch_size');
            const batchSize = batchSizeInput ? (parseInt(batchSizeInput.value) || 8) : 8;
            const epochsInput = document.getElementById('max_train_epochs');
            const epochs = epochsInput ? (parseInt(epochsInput.value) || 10) : 10;
            
            console.log('setChatGPTRecommendedNumRepeats - datasetConfig:', datasetConfig);
            console.log('setChatGPTRecommendedNumRepeats - isVideoTraining:', isVideoTraining);
            console.log('setChatGPTRecommendedNumRepeats - videoDuration:', videoDuration);
            
            if (!datasetConfig) {
                addLogEntry({
                    level: 'warning',
                    message: 'ËØ∑ÂÖàÈÄâÊã©Êï∞ÊçÆÈõÜÈÖçÁΩÆÊñá‰ª∂',
                    timestamp: new Date().toLocaleTimeString()
                });
                return;
            }
            
            // Ë∞ÉÁî®ÂêéÁ´ØAPIËé∑ÂèñChatGPTÊé®ËçêÁöÑnum_repeatsÂÄº
            fetch('/api/calculate_chatgpt_recommended_num_repeats', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    dataset_config: datasetConfig,
                    task_type: currentTaskType,
                    is_video_training: isVideoTraining,
                    video_duration: videoDuration,
                    batch_size: batchSize,
                    epochs: epochs
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('ChatGPT APIÂìçÂ∫îÊï∞ÊçÆ:', data);
                if (data.success) {
                    // ËÆæÁΩÆÊé®ËçêÁöÑnum_repeatsÂÄºÂà∞ËæìÂÖ•Ê°Ü
                    const numRepeatsInput = document.getElementById('num_repeats');
                    if (numRepeatsInput && data.recommended_repeats !== undefined) {
                        numRepeatsInput.value = data.recommended_repeats;
                    }
                    
                    let message;
                    const recommendedValue = data.recommended_repeats || 'N/A';
                    const datasetFiles = data.dataset_files || 'N/A';
                    const targetSteps = data.target_steps || 'N/A';
                    const stepsPerEpoch = data.steps_per_epoch || 'N/A';
                    
                    if (isVideoTraining) {
                        message = `ü§ñ ChatGPTÊé®ËçêÊï∞ÊçÆÈáçÂ§çÊ¨°Êï∞: ${recommendedValue} (${currentTaskType.toUpperCase()}Ê®°Âºè, ËßÜÈ¢ëÊó∂Èïø: ${videoDuration}Áßí, Êï∞ÊçÆÈõÜ: ${datasetFiles}‰∏™Êñá‰ª∂, ÁõÆÊ†áÊ≠•Êï∞: ${targetSteps}, ÊØèËΩÆÊ≠•Êï∞: ${stepsPerEpoch})`;
                    } else {
                        message = `ü§ñ ChatGPTÊé®ËçêÊï∞ÊçÆÈáçÂ§çÊ¨°Êï∞: ${recommendedValue} (${currentTaskType.toUpperCase()}Ê®°Âºè, Êï∞ÊçÆÈõÜ: ${datasetFiles}‰∏™Êñá‰ª∂, ÁõÆÊ†áÊ≠•Êï∞: ${targetSteps}, ÊØèËΩÆÊ≠•Êï∞: ${stepsPerEpoch})`;
                    }
                    
                    addLogEntry({
                        level: 'success',
                        message: message,
                        timestamp: new Date().toLocaleTimeString()
                    });
                } else {
                    addLogEntry({
                        level: 'error',
                        message: '‚ùå ChatGPTÊé®ËçêÊï∞ÊçÆÈáçÂ§çÊ¨°Êï∞ËÆ°ÁÆóÂ§±Ë¥•: ' + (data.message || 'Êú™Áü•ÈîôËØØ'),
                        timestamp: new Date().toLocaleTimeString()
                    });
                }
            })
            .catch(error => {
                addLogEntry({
                    level: 'error',
                    message: 'ChatGPTÊé®ËçêÊï∞ÊçÆÈáçÂ§çÊ¨°Êï∞ËÆ°ÁÆóÂ§±Ë¥•: ' + error.message,
                    timestamp: new Date().toLocaleTimeString()
                });
            });
        }
        
        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÁöÑÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // ËÆæÁΩÆÈªòËÆ§‰ªªÂä°Á±ªÂûã‰∏∫T2V
            selectTaskType('t2v');
            
            // Ê∑ªÂä†ÂÜÖÂ≠ò‰ºòÂåñÁ≠ñÁï•ÂàáÊç¢‰∫ã‰ª∂ÁõëÂê¨Âô®
            document.getElementById('memory_optimization_strategy').addEventListener('change', handleMemoryOptimizationChange);
            
            // ÂàùÂßãÂåñÂÜÖÂ≠ò‰ºòÂåñÁ≠ñÁï•ÊòæÁ§∫
            handleMemoryOptimizationChange();
            
            // Âä†ËΩΩÈÖçÁΩÆ
            loadConfig();
            
            // ÂàùÂßãÂåñWebSocketËøûÊé•
            initializeSocket();
            
            addLogEntry({
                level: 'info',
                message: 'Wan2.2ËÆ≠ÁªÉÁïåÈù¢ÂàùÂßãÂåñÂÆåÊàê',
                timestamp: new Date().toLocaleTimeString()
            });
        });
    </script>
</body>
</html>