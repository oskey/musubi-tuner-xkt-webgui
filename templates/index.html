<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qwen-Image Web UI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
            padding: 30px;
        }
        
        .config-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .training-actions {
            grid-column: 1 / -1;
        }
        
        .panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(79, 172, 254, 0.1);
        }
        
        .panel h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.4em;
            border-bottom: 2px solid #4facfe;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
            cursor: help;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }
        
        .config-section {
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .section-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 12px 16px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: #495057;
            border-bottom: 1px solid #e0e0e0;
            transition: background-color 0.2s ease;
        }
        
        .section-header:hover {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
        }
        
        .toggle-icon {
            font-size: 12px;
            transition: transform 0.2s ease;
        }
        
        .section-content {
            padding: 16px;
            background: #fff;
            transition: max-height 0.3s ease, padding 0.3s ease;
            max-height: 2000px;
            overflow: hidden;
        }
        
        .section-content.collapsed {
            max-height: 0;
            padding: 0 16px;
        }
        
        .collapsed .toggle-icon {
            transform: rotate(-90deg);
        }
        
        .btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        }
        
        .btn-danger:hover {
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }
        
        .log-container {
            grid-column: 1 / -1;
            background: #1e1e1e;
            border-radius: 15px;
            padding: 20px;
            height: 600px;
            min-height: 600px;
            font-family: 'Consolas', 'Monaco', monospace;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        
        #log-output {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            background: #2d2d2d;
            border-radius: 8px;
            border: 1px solid #444;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 13px;
            line-height: 1.4;
        }
        
        .log-info { color: #61dafb; }
        .log-success { color: #98fb98; background: rgba(152, 251, 152, 0.1); }
        .log-error { color: #ff6b6b; background: rgba(255, 107, 107, 0.1); }
        .log-warning { color: #ffa500; background: rgba(255, 165, 0, 0.1); }
        .log-output { color: #d4d4d4; }
        .log-debug { color: #888; }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-idle { background: #95a5a6; }
        .status-running { background: #f39c12; animation: pulse 1.5s infinite; }
        .status-success { background: #27ae60; }
        .status-error { background: #e74c3c; }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e1e8ed;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé® Qwen-Image Web UI</h1>
            <p>Áé∞‰ª£ÂåñÁöÑQwen-ImageËÆ≠ÁªÉÁÆ°ÁêÜÁïåÈù¢</p>
        </div>
        
        <div class="main-content">
            <!-- Êó•ÂøóÈù¢Êùø -->
            <div class="log-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h2 style="color: #61dafb; margin: 0;">üìã ÂÆûÊó∂Êó•Âøó</h2>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="clearLogs()" class="btn" style="padding: 5px 10px; font-size: 12px; background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);">üóëÔ∏è Ê∏ÖÁêÜÊó•Âøó</button>
                        <button onclick="scrollToBottom()" class="btn" style="padding: 5px 10px; font-size: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">ÊªöÂä®Âà∞Â∫ïÈÉ®</button>
                    </div>
                </div>
                <div id="log-output"></div>
            </div>
            
            <!-- Êìç‰ΩúÊåâÈíÆÂå∫Âüü -->
            <div class="operation-panel" style="margin: 20px 0; padding: 20px; background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); border-radius: 12px; box-shadow: 0 8px 32px rgba(0,0,0,0.3);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h2 style="color: #61dafb; margin: 0;">üéÆ ËÆ≠ÁªÉÊéßÂà∂</h2>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="status-indicator" id="status-indicator"></div>
                        <span id="status-text" style="color: #d4d4d4; font-size: 14px;">Â∞±Áª™</span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px;">
                    <button onclick="startTensorBoard()" class="btn" id="tensorboard-btn">üìä ÂêØÂä® TensorBoard</button>
                    <button onclick="startCacheVAE()" class="btn" id="cache-vae-btn">üîÑ È¢ÑÁºìÂ≠ò VAE Latents</button>
                    <button onclick="startCacheTextEncoder()" class="btn" id="cache-te-btn">üìù È¢ÑÁºìÂ≠òÊñáÊú¨ÁºñÁ†ÅÂô®ËæìÂá∫</button>
                    <button onclick="startTraining()" class="btn" id="train-btn">üéØ ÂºÄÂßãËÆ≠ÁªÉ</button>
                    <button onclick="stopTraining()" class="btn btn-danger" id="stop-btn" disabled>‚èπÔ∏è ÂÅúÊ≠¢ËÆ≠ÁªÉ</button>
                </div>
            </div>
            
            <!-- ËôöÊãüÁéØÂ¢ÉÈÖçÁΩÆ -->
            <div class="panel" style="margin-bottom: 20px;">
                <h2>üêç ËøêË°åÁéØÂ¢É</h2>
                <div class="form-group">
                    <label title="ÂêØÁî®ËôöÊãüÁéØÂ¢ÉÂèØ‰ª•Á°Æ‰øùËÆ≠ÁªÉËøáÁ®ã‰ΩøÁî®ÊåáÂÆöÁöÑPythonÁéØÂ¢ÉÔºåÈÅøÂÖç‰æùËµñÂÜ≤Á™Å„ÄÇ">ÂêØÁî®ËôöÊãüÁéØÂ¢É</label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="enable_venv" checked title="ÂêØÁî®ËôöÊãüÁéØÂ¢ÉÂèØ‰ª•Á°Æ‰øùËÆ≠ÁªÉËøáÁ®ã‰ΩøÁî®ÊåáÂÆöÁöÑPythonÁéØÂ¢ÉÔºåÈÅøÂÖç‰æùËµñÂÜ≤Á™Å„ÄÇ">
                        <span style="color: #666; font-size: 14px;">‰ΩøÁî®ËôöÊãüÁéØÂ¢ÉÊâßË°åËÆ≠ÁªÉÂëΩ‰ª§</span>
                    </div>
                </div>
                
                <div class="form-group" id="venv_path_group">
                    <label title="ËôöÊãüÁéØÂ¢ÉÁöÑPythonÂèØÊâßË°åÊñá‰ª∂Ë∑ØÂæÑ„ÄÇÈÄöÂ∏∏‰Ωç‰∫éËôöÊãüÁéØÂ¢ÉÁöÑScriptsÁõÆÂΩï‰∏ã„ÄÇ">ËôöÊãüÁéØÂ¢ÉPythonË∑ØÂæÑ</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="text" id="venv_python_path" title="ËôöÊãüÁéØÂ¢ÉÁöÑPythonÂèØÊâßË°åÊñá‰ª∂Ë∑ØÂæÑ„ÄÇÈÄöÂ∏∏‰Ωç‰∫éËôöÊãüÁéØÂ¢ÉÁöÑScriptsÁõÆÂΩï‰∏ã„ÄÇ" style="flex: 1;">
                        <button type="button" onclick="selectFolder('venv_python_path')" class="btn" style="padding: 8px 12px; font-size: 12px;">üìÅ ÈÄâÊã©</button>
                    </div>
                    <small style="color: #666; display: block; margin-top: 5px;">üí° ËôöÊãüÁéØÂ¢ÉÁöÑScriptsÁõÆÂΩïË∑ØÂæÑ</small>
                </div>
            </div>
            
            <!-- ÈÖçÁΩÆÂ∏ÉÂ±Ä -->
            <div class="config-layout">
                <!-- Â∑¶‰æßÔºöÂü∫Á°ÄÈÖçÁΩÆ -->
                <div class="panel">
                    <h2>üìÅ Âü∫Á°ÄÈÖçÁΩÆ</h2>
                        <div class="form-group">
                            <label title="TOMLÊ†ºÂºèÁöÑÊï∞ÊçÆÈõÜÈÖçÁΩÆÊñá‰ª∂ÔºåÂÆö‰πâ‰∫ÜËÆ≠ÁªÉÊï∞ÊçÆÁöÑË∑ØÂæÑ„ÄÅÊ†áÁ≠æÂíåÈ¢ÑÂ§ÑÁêÜÂèÇÊï∞„ÄÇËØ•Êñá‰ª∂ÊåáÂÆö‰∫ÜÂõæÁâá‰ΩçÁΩÆ„ÄÅÂØπÂ∫îÁöÑÊñáÊú¨ÊèèËø∞„ÄÅÈáçÂ§çÊ¨°Êï∞Á≠âËÆ≠ÁªÉÊâÄÈúÄÁöÑÊâÄÊúâÊï∞ÊçÆ‰ø°ÊÅØ„ÄÇ">Êï∞ÊçÆÈõÜÈÖçÁΩÆÊñá‰ª∂ (dataset_config)</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="text" id="dataset_config" title="TOMLÊ†ºÂºèÁöÑÊï∞ÊçÆÈõÜÈÖçÁΩÆÊñá‰ª∂ÔºåÂÆö‰πâ‰∫ÜËÆ≠ÁªÉÊï∞ÊçÆÁöÑË∑ØÂæÑ„ÄÅÊ†áÁ≠æÂíåÈ¢ÑÂ§ÑÁêÜÂèÇÊï∞„ÄÇËØ•Êñá‰ª∂ÊåáÂÆö‰∫ÜÂõæÁâá‰ΩçÁΩÆ„ÄÅÂØπÂ∫îÁöÑÊñáÊú¨ÊèèËø∞„ÄÅÈáçÂ§çÊ¨°Êï∞Á≠âËÆ≠ÁªÉÊâÄÈúÄÁöÑÊâÄÊúâÊï∞ÊçÆ‰ø°ÊÅØ„ÄÇ" style="flex: 1;">
                                <button type="button" onclick="selectFile('dataset_config', '.toml')" class="btn" style="padding: 8px 12px; font-size: 12px;">üìÅ ÈÄâÊã©</button>
                            </div>
                            <small style="color: #666; display: block; margin-top: 5px;">üí° ÂåÖÂê´ËÆ≠ÁªÉÊï∞ÊçÆË∑ØÂæÑÂíåÊ†áÁ≠æÁöÑTOMLÈÖçÁΩÆÊñá‰ª∂</small>
                        </div>
                        
                        <div class="form-group">
                            <label title="È¢ÑËÆ≠ÁªÉÁöÑQwen-ImageÊâ©Êï£Ê®°ÂûãË∑ØÂæÑ„ÄÇËøôÊòØËÆ≠ÁªÉÁöÑÂü∫Á°ÄÊ®°ÂûãÔºåÈÄöÂ∏∏ÊòØ‰ªéHugging Face‰∏ãËΩΩÁöÑÊ®°ÂûãÊñá‰ª∂ÊàñÊú¨Âú∞‰øùÂ≠òÁöÑÊ®°ÂûãË∑ØÂæÑ„ÄÇ">È¢ÑËÆ≠ÁªÉÊ®°ÂûãË∑ØÂæÑ (pretrained_model_name_or_path)</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="text" id="pretrained_model_name_or_path" title="È¢ÑËÆ≠ÁªÉÁöÑQwen-ImageÊâ©Êï£Ê®°ÂûãË∑ØÂæÑ„ÄÇËøôÊòØËÆ≠ÁªÉÁöÑÂü∫Á°ÄÊ®°ÂûãÔºåÈÄöÂ∏∏ÊòØ‰ªéHugging Face‰∏ãËΩΩÁöÑÊ®°ÂûãÊñá‰ª∂ÊàñÊú¨Âú∞‰øùÂ≠òÁöÑÊ®°ÂûãË∑ØÂæÑ„ÄÇ" style="flex: 1;">
                                <button type="button" onclick="selectFile('pretrained_model_name_or_path', '.safetensors')" class="btn" style="padding: 8px 12px; font-size: 12px;">üìÅ ÈÄâÊã©</button>
                            </div>
                            <small style="color: #666; display: block; margin-top: 5px;">üí° QwenÂõæÂÉèÁîüÊàêÁöÑÂü∫Á°ÄÊ®°ÂûãÊñá‰ª∂</small>
                        </div>
                        
                        <div class="form-group">
                            <label title="QwenÊñáÊú¨ÁºñÁ†ÅÂô®Ê®°ÂûãË∑ØÂæÑ„ÄÇÁî®‰∫éÂ∞ÜÊñáÊú¨ÊèêÁ§∫ÁºñÁ†Å‰∏∫ÂêëÈáèË°®Á§∫ÔºåÊòØÊñáÊú¨Âà∞ÂõæÂÉèÁîüÊàêÁöÑÂÖ≥ÈîÆÁªÑ‰ª∂„ÄÇ">ÊñáÊú¨ÁºñÁ†ÅÂô®Ë∑ØÂæÑ (text_encoder_path)</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="text" id="text_encoder_path" title="QwenÊñáÊú¨ÁºñÁ†ÅÂô®Ê®°ÂûãË∑ØÂæÑ„ÄÇÁî®‰∫éÂ∞ÜÊñáÊú¨ÊèêÁ§∫ÁºñÁ†Å‰∏∫ÂêëÈáèË°®Á§∫ÔºåÊòØÊñáÊú¨Âà∞ÂõæÂÉèÁîüÊàêÁöÑÂÖ≥ÈîÆÁªÑ‰ª∂„ÄÇ" style="flex: 1;">
                                <button type="button" onclick="selectFile('text_encoder_path', '.safetensors')" class="btn" style="padding: 8px 12px; font-size: 12px;">üìÅ ÈÄâÊã©</button>
                            </div>
                            <small style="color: #666; display: block; margin-top: 5px;">üí° Â∞ÜÊñáÊú¨ÊèêÁ§∫ËΩ¨Êç¢‰∏∫ÂêëÈáèË°®Á§∫ÁöÑÊ®°Âûã</small>
                        </div>
                        
                        <div class="form-group">
                            <label title="ÂèòÂàÜËá™ÁºñÁ†ÅÂô®(VAE)Ê®°ÂûãË∑ØÂæÑ„ÄÇVAEË¥üË¥£Âú®ÂÉèÁ¥†Á©∫Èó¥ÂíåÊΩúÂú®Á©∫Èó¥‰πãÈó¥ËøõË°åËΩ¨Êç¢ÔºåÊòØÊâ©Êï£Ê®°ÂûãËÆ≠ÁªÉÁöÑÈáçË¶ÅÁªÑ‰ª∂„ÄÇ">VAEÊ®°ÂûãË∑ØÂæÑ (vae_path)</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="text" id="vae_path" title="ÂèòÂàÜËá™ÁºñÁ†ÅÂô®(VAE)Ê®°ÂûãË∑ØÂæÑ„ÄÇVAEË¥üË¥£Âú®ÂÉèÁ¥†Á©∫Èó¥ÂíåÊΩúÂú®Á©∫Èó¥‰πãÈó¥ËøõË°åËΩ¨Êç¢ÔºåÊòØÊâ©Êï£Ê®°ÂûãËÆ≠ÁªÉÁöÑÈáçË¶ÅÁªÑ‰ª∂„ÄÇ" style="flex: 1;">
                                <button type="button" onclick="selectFile('vae_path', '.safetensors')" class="btn" style="padding: 8px 12px; font-size: 12px;">üìÅ ÈÄâÊã©</button>
                            </div>
                            <small style="color: #666; display: block; margin-top: 5px;">üí° Ë¥üË¥£ÂõæÂÉèÁöÑÁºñÁ†ÅÂíåËß£Á†ÅÂ§ÑÁêÜ</small>
                        </div>
                        
                        <div class="form-group">
                            <label title="ËæìÂá∫ÁõÆÂΩïË∑ØÂæÑ„ÄÇËÆ≠ÁªÉÂÆåÊàêÁöÑLoRAÊ®°ÂûãÂ∞Ü‰øùÂ≠òÂà∞Ê≠§ÁõÆÂΩï„ÄÇ">ËæìÂá∫ÁõÆÂΩï (output_dir)</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="text" id="output_dir" title="ËæìÂá∫ÁõÆÂΩïË∑ØÂæÑ„ÄÇËÆ≠ÁªÉÂÆåÊàêÁöÑLoRAÊ®°ÂûãÂ∞Ü‰øùÂ≠òÂà∞Ê≠§ÁõÆÂΩï„ÄÇ" style="flex: 1;">
                                <button type="button" onclick="selectFolder('output_dir')" class="btn" style="padding: 8px 12px; font-size: 12px;">üìÅ ÈÄâÊã©</button>
                            </div>
                            <small style="color: #666; display: block; margin-top: 5px;">üí° ËÆ≠ÁªÉÂÆåÊàêÁöÑÊ®°ÂûãÊñá‰ª∂‰øùÂ≠ò‰ΩçÁΩÆ</small>
                        </div>
                        
                        <div class="form-group">
                            <label title="ËæìÂá∫Ê®°ÂûãÂêçÁß∞„ÄÇËÆ≠ÁªÉÂÆåÊàêÂêé‰øùÂ≠òÁöÑLoRAÊ®°ÂûãÊñá‰ª∂ÂêçÂâçÁºÄ„ÄÇ">ËæìÂá∫Ê®°ÂûãÂêçÁß∞ (output_name)</label>
                            <input type="text" id="output_name" title="ËæìÂá∫Ê®°ÂûãÂêçÁß∞„ÄÇËÆ≠ÁªÉÂÆåÊàêÂêé‰øùÂ≠òÁöÑLoRAÊ®°ÂûãÊñá‰ª∂ÂêçÂâçÁºÄ„ÄÇ" style="width: 100%;">
                            <small style="color: #666; display: block; margin-top: 5px;">üí° ‰øùÂ≠òÁöÑLoRAÊ®°ÂûãÊñá‰ª∂ÂêçÂâçÁºÄ</small>
                        </div>
                </div>
                
                <!-- Âè≥‰æßËÆ≠ÁªÉÂèÇÊï∞Èù¢Êùø -->
                <div class="panel">
                    <h2>üéì Ê†∏ÂøÉËÆ≠ÁªÉÂèÇÊï∞ (ÂÆòÊñπÈªòËÆ§)</h2>
                    
                        <!-- Ê†∏ÂøÉÂèÇÊï∞ÔºöËÆ≠ÁªÉÊâπÊ¨°Â§ßÂ∞è -->
                        <div class="form-group">
                            <label title="ËÆ≠ÁªÉÊâπÊ¨°Â§ßÂ∞è - ‰ªéTOMLÈÖçÁΩÆÊñá‰ª∂ËØªÂèñ„ÄÇ">ËÆ≠ÁªÉÊâπÊ¨°Â§ßÂ∞è (batch_size)</label>
                            <input type="number" id="batch_size" min="1" max="32" title="ËÆ≠ÁªÉÊâπÊ¨°Â§ßÂ∞è - ‰ªéTOMLÈÖçÁΩÆÊñá‰ª∂ËØªÂèñ„ÄÇ">
                            <small style="color: #666; display: block; margin-top: 5px;">üí° ‰ªéTOMLÊñá‰ª∂ÁöÑ[general]ÈÉ®ÂàÜËØªÂèñÔºåÂΩ±ÂìçÊòæÂ≠ò‰ΩøÁî®ÂíåËÆ≠ÁªÉÈÄüÂ∫¶</small>
                        </div>
                        
                        <!-- Ê†∏ÂøÉÂèÇÊï∞ÔºöÊï∞ÊçÆÈáçÂ§çÊ¨°Êï∞ -->
                        <div class="form-group">
                            <label title="Êï∞ÊçÆÈáçÂ§çÊ¨°Êï∞ - ‰ªéTOMLÈÖçÁΩÆÊñá‰ª∂ËØªÂèñ„ÄÇÊé®ËçêÂÄº20~30ÔºàÂõæÁâáËæÉÂ∞ëÊó∂ÔºâÔºåÊ®°ÂûãËÉΩÊõ¥ÂÆπÊòìËÆ∞‰ΩèÁâπÂæÅ„ÄÇ">Êï∞ÊçÆÈáçÂ§çÊ¨°Êï∞ (num_repeats)</label>
                            <input type="number" id="num_repeats" min="1" max="100" title="Êï∞ÊçÆÈáçÂ§çÊ¨°Êï∞ - ‰ªéTOMLÈÖçÁΩÆÊñá‰ª∂ËØªÂèñ„ÄÇÊé®ËçêÂÄº20~30ÔºàÂõæÁâáËæÉÂ∞ëÊó∂ÔºâÔºåÊ®°ÂûãËÉΩÊõ¥ÂÆπÊòìËÆ∞‰ΩèÁâπÂæÅ„ÄÇ">
                            <small style="color: #666; display: block; margin-top: 5px;">üí° ‰ªéTOMLÊñá‰ª∂ÁöÑ[[datasets]]ÈÉ®ÂàÜËØªÂèñ„ÄÇÊé®ËçêÂÄº20~30ÔºàÂõæÁâáËæÉÂ∞ëÊó∂ÔºâÔºåÊï∞ÊçÆÂ∞ëÊó∂ÊèêÈ´òÈáçÂ§çÊ¨°Êï∞ÂèØÊúâÊïàÊèêÂçáËÆ≠ÁªÉÊïàÊûú</small>
                        </div>
                        
                        <!-- Ê†∏ÂøÉÂèÇÊï∞ÔºöÂ≠¶‰π†Áéá -->
                        <div class="form-group">
                            <label title="Â≠¶‰π†Áéá - Êé®ËçêÂÄºÔºö5e-05„ÄÇÊéßÂà∂Ê®°ÂûãÂèÇÊï∞Êõ¥Êñ∞ÁöÑÊ≠•ÈïøÔºåÊòØËÆ≠ÁªÉ‰∏≠ÊúÄÈáçË¶ÅÁöÑË∂ÖÂèÇÊï∞„ÄÇÊï∞ÊçÆÂ∞ëÊó∂ÔºåËøáÈ´ò‰ºöÂØºËá¥ËøáÊãüÂêàÔºåËøá‰ΩéÂèàÈöæÂ≠¶Âà∞„ÄÇ">Â≠¶‰π†Áéá (learning_rate)</label>
                <input type="text" id="learning_rate" title="Â≠¶‰π†Áéá - Êé®ËçêÂÄºÔºö5e-05„ÄÇÊéßÂà∂Ê®°ÂûãÂèÇÊï∞Êõ¥Êñ∞ÁöÑÊ≠•ÈïøÔºåÊòØËÆ≠ÁªÉ‰∏≠ÊúÄÈáçË¶ÅÁöÑË∂ÖÂèÇÊï∞„ÄÇÊï∞ÊçÆÂ∞ëÊó∂ÔºåËøáÈ´ò‰ºöÂØºËá¥ËøáÊãüÂêàÔºåËøá‰ΩéÂèàÈöæÂ≠¶Âà∞„ÄÇ">
                <small style="color: #666; display: block; margin-top: 5px;">üí° Êé®ËçêÂå∫Èó¥Ôºö2e-4 ~ 1e-4ÔºàËß¶ÂèëÂÆπÊòìÔºåÊïàÊûúÁ´ãÁ´øËßÅÂΩ±Ôºâ„ÄÇÊï∞ÊçÆÂ∞ëÊó∂ÔºåËøáÈ´ò‰ºöÂØºËá¥ËøáÊãüÂêàÔºåËøá‰ΩéÂèàÈöæÂ≠¶Âà∞</small>
                        </div>
                        
                        <!-- Ê†∏ÂøÉÂèÇÊï∞ÔºöLoRAÁª¥Â∫¶ -->
                        <div class="form-group">
                            <label title="LoRAÁª¥Â∫¶ - Êé®ËçêÂÄºÔºö8„ÄÇÊéßÂà∂‰ΩéÁß©Áü©ÈòµÁöÑÁª¥Â∫¶ÔºåÂΩ±ÂìçÊ®°ÂûãÂÆπÈáèÂíåËÆ≠ÁªÉÊïàÊûú„ÄÇÂ¶ÇÊûúÂè™ËÆ≠ÁªÉÂçï‰∏ÄËßíËâ≤/È£éÊ†ºÔºå64Êõ¥ÂêàÈÄÇ„ÄÇ">LoRAÁª¥Â∫¶ (network_dim)</label>
                <input type="number" id="network_dim" min="4" max="128" title="LoRAÁª¥Â∫¶ - Êé®ËçêÂÄºÔºö8„ÄÇÊéßÂà∂‰ΩéÁß©Áü©ÈòµÁöÑÁª¥Â∫¶ÔºåÂΩ±ÂìçÊ®°ÂûãÂÆπÈáèÂíåËÆ≠ÁªÉÊïàÊûú„ÄÇÂ¶ÇÊûúÂè™ËÆ≠ÁªÉÂçï‰∏ÄËßíËâ≤/È£éÊ†ºÔºå64Êõ¥ÂêàÈÄÇ„ÄÇ">
                <small style="color: #666; display: block; margin-top: 5px;">üí° Êé®ËçêÂÄºÔºö8ÔºåÂπ≥Ë°°Ê®°ÂûãÂÆπÈáèÂíåËÆ≠ÁªÉÊïàÁéá„ÄÇÂ¶ÇÊûúÂè™ËÆ≠ÁªÉÂçï‰∏ÄËßíËâ≤/È£éÊ†ºÔºå64Êõ¥ÂêàÈÄÇ</small>
                        </div>
                        
                        <!-- Ê†∏ÂøÉÂèÇÊï∞ÔºöËÆ≠ÁªÉËΩÆÊï∞ -->
                        <div class="form-group">
                            <label title="ÊúÄÂ§ßËÆ≠ÁªÉËΩÆÊï∞ - Êé®ËçêÂÄºÔºö10„ÄÇÊéßÂà∂ËÆ≠ÁªÉÁöÑÊÄªËΩÆÊï∞„ÄÇÊï∞ÊçÆÂ∞ëÊó∂ÔºåÊèêÈ´òËΩÆÊï∞ÂèØ‰ª•ÊúâÊïàÊèêÂçáËÆ≠ÁªÉÊïàÊûú„ÄÇ">ÊúÄÂ§ßËÆ≠ÁªÉËΩÆÊï∞ (max_train_epochs)</label>
                            <input type="number" id="max_train_epochs" min="1" max="100" title="ÊúÄÂ§ßËÆ≠ÁªÉËΩÆÊï∞ - Êé®ËçêÂÄºÔºö10„ÄÇÊéßÂà∂ËÆ≠ÁªÉÁöÑÊÄªËΩÆÊï∞„ÄÇÊï∞ÊçÆÂ∞ëÊó∂ÔºåÊèêÈ´òËΩÆÊï∞ÂèØ‰ª•ÊúâÊïàÊèêÂçáËÆ≠ÁªÉÊïàÊûú„ÄÇ">
                            <small style="color: #666; display: block; margin-top: 5px;">üí° Êé®ËçêÂÄºÔºö10ÔºåÈÄÇÂêàÂø´ÈÄüËÆ≠ÁªÉÂíåÊµãËØï„ÄÇÊï∞ÊçÆÂ∞ëÊó∂ÔºåÊèêÈ´òËΩÆÊï∞ÂèØ‰ª•ÊúâÊïàÊèêÂçáËÆ≠ÁªÉÊïàÊûú</small>
                        </div>
                        
                        
                        <!-- È´òÁ∫ßÂèÇÊï∞ÊäòÂè†Âå∫Âüü -->
                        <div class="collapsible-section">
                            <button type="button" class="collapsible-header" onclick="toggleSection('advanced-params')" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%); border: none; border-radius: 8px; color: #61dafb; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: space-between; margin: 15px 0;">
                                <span>‚öôÔ∏è È´òÁ∫ßÂèÇÊï∞ (ÂèØÈÄâ)</span>
                                <span class="toggle-icon" id="advanced-toggle-icon">‚ñº</span>
                            </button>
                            <div class="collapsible-content" id="advanced-params" style="display: none; padding: 10px; border: 1px solid #4a5568; border-radius: 8px; margin-top: 10px;">
                                
                                <!-- ‰øùÂ≠òÈó¥Èöî -->
                                <div class="form-group">
                                    <label title="ÊØèNËΩÆ‰øùÂ≠ò‰∏ÄÊ¨° - ÂÆòÊñπÈªòËÆ§ÂÄºÔºö1„ÄÇÊéßÂà∂Ê®°ÂûãÊ£ÄÊü•ÁÇπÁöÑ‰øùÂ≠òÈ¢ëÁéá„ÄÇ">ÊØèNËΩÆ‰øùÂ≠ò (save_every_n_epochs)</label>
                                    <input type="number" id="save_every_n_epochs" min="1" max="10" title="ÊØèNËΩÆ‰øùÂ≠ò‰∏ÄÊ¨° - ÂÆòÊñπÈªòËÆ§ÂÄºÔºö1„ÄÇÊéßÂà∂Ê®°ÂûãÊ£ÄÊü•ÁÇπÁöÑ‰øùÂ≠òÈ¢ëÁéá„ÄÇ">
                                    <small style="color: #666; display: block; margin-top: 5px;">üí° ÂÆòÊñπÊé®ËçêÂÄºÔºö1ÔºåÊØèËΩÆÈÉΩ‰øùÂ≠ò‰æø‰∫éÈÄâÊã©ÊúÄ‰Ω≥Ê£ÄÊü•ÁÇπ</small>
                                </div>
                                
                                <!-- ÈöèÊú∫ÁßçÂ≠ê -->
                                <div class="form-group">
                                    <label title="ÈöèÊú∫ÁßçÂ≠ê - ÂÆòÊñπÈªòËÆ§ÂÄºÔºö42„ÄÇÁ°Æ‰øùËÆ≠ÁªÉÁªìÊûúÂèØÂ§çÁé∞„ÄÇ">ÈöèÊú∫ÁßçÂ≠ê (seed)</label>
                                    <input type="number" id="seed" min="0" title="ÈöèÊú∫ÁßçÂ≠ê - ÂÆòÊñπÈªòËÆ§ÂÄºÔºö42„ÄÇÁ°Æ‰øùËÆ≠ÁªÉÁªìÊûúÂèØÂ§çÁé∞„ÄÇ">
                                    <small style="color: #666; display: block; margin-top: 5px;">üí° ÂÆòÊñπÊé®ËçêÂÄºÔºö42ÔºåÂõ∫ÂÆöÁßçÂ≠êÁ°Æ‰øùÁªìÊûúÂèØÂ§çÁé∞</small>
                                </div>
                                
                                <!-- Ê∑∑ÂêàÁ≤æÂ∫¶ -->
                                <div class="form-group">
                                    <label title="Ê∑∑ÂêàÁ≤æÂ∫¶ËÆ≠ÁªÉ - ÂÆòÊñπÈªòËÆ§ÂÄºÔºöbf16„ÄÇËäÇÁúÅÊòæÂ≠ò‰∏î‰øùÊåÅËÆ≠ÁªÉÁ≤æÂ∫¶„ÄÇ">Ê∑∑ÂêàÁ≤æÂ∫¶ (mixed_precision)</label>
                                    <select id="mixed_precision" title="Ê∑∑ÂêàÁ≤æÂ∫¶ËÆ≠ÁªÉ - ÂÆòÊñπÈªòËÆ§ÂÄºÔºöbf16„ÄÇËäÇÁúÅÊòæÂ≠ò‰∏î‰øùÊåÅËÆ≠ÁªÉÁ≤æÂ∫¶„ÄÇ">
                                        <option value="bf16" selected>bf16</option>
                                        <option value="fp16">fp16</option>
                                        <option value="no">no</option>
                                    </select>
                                    <small style="color: #666; display: block; margin-top: 5px;">üí° ÂÆòÊñπÊé®ËçêÂÄºÔºöbf16ÔºåÊúÄ‰Ω≥ÊÄßËÉΩÂíåÁ®≥ÂÆöÊÄßÂπ≥Ë°°</small>
                                </div>
                                
                                <!-- ÊâπÊ¨°ÂíåÁ¥ØÁßØÂèÇÊï∞ -->
                                <div class="form-group">
                                    <label title="Ê¢ØÂ∫¶Á¥ØÁßØÊ≠•Êï∞„ÄÇÊ®°ÊãüÊõ¥Â§ßÊâπÊ¨°Â§ßÂ∞èËÄå‰∏çÂ¢ûÂä†ÊòæÂ≠òÂç†Áî®„ÄÇ">Ê¢ØÂ∫¶Á¥ØÁßØÊ≠•Êï∞ (gradient_accumulation_steps)</label>
                                    <input type="number" id="gradient_accumulation_steps" min="1" title="Ê¢ØÂ∫¶Á¥ØÁßØÊ≠•Êï∞„ÄÇÊ®°ÊãüÊõ¥Â§ßÊâπÊ¨°Â§ßÂ∞èËÄå‰∏çÂ¢ûÂä†ÊòæÂ≠òÂç†Áî®„ÄÇ">
                                    <small style="color: #666; display: block; margin-top: 5px;">üí° Âª∫ËÆÆÂÄºÔºö1-4ÔºåÁî®‰∫éÊ®°ÊãüÊõ¥Â§ßÊâπÊ¨°</small>
                                </div>
                                
                                <!-- LoRA AlphaÂèÇÊï∞ -->
                                <div class="form-group">
                                    <label title="LoRA AlphaÂÄº„ÄÇÈÄöÂ∏∏ËÆæÁΩÆ‰∏∫ÁΩëÁªúÁª¥Â∫¶ÁöÑ‰∏ÄÂçäÊàñÁõ∏Á≠â„ÄÇ">LoRA Alpha (network_alpha)</label>
                                    <input type="number" id="network_alpha" min="1" title="LoRA AlphaÂÄº„ÄÇÈÄöÂ∏∏ËÆæÁΩÆ‰∏∫ÁΩëÁªúÁª¥Â∫¶ÁöÑ‰∏ÄÂçäÊàñÁõ∏Á≠â„ÄÇ">
                                    <small style="color: #666; display: block; margin-top: 5px;">üí° Âª∫ËÆÆÂÄºÔºöÈÄöÂ∏∏‰∏∫Áª¥Â∫¶ÁöÑ‰∏ÄÂçä</small>
                                </div>
                                
                                <!-- ‰ºòÂåñÂô®ÈÄâÊã© -->
                                <div class="form-group">
                                    <label title="‰ºòÂåñÂô®Á±ªÂûã - ÂÆòÊñπÈªòËÆ§Ôºöadamw8bit„ÄÇ">‰ºòÂåñÂô® (optimizer_type)</label>
                                    <select id="optimizer_type" title="‰ºòÂåñÂô®Á±ªÂûã - ÂÆòÊñπÈªòËÆ§Ôºöadamw8bit„ÄÇ">
                                        <option value="adamw8bit" selected>adamw8bit</option>
                                        <option value="AdamW">AdamW</option>
                                        <option value="Lion">Lion</option>
                                        <option value="SGDNesterov">SGDNesterov</option>
                                        <option value="Adafactor">Adafactor</option>
                                    </select>
                                    <small style="color: #666; display: block; margin-top: 5px;">üí° ÂÆòÊñπÊé®ËçêÂÄºÔºöadamw8bitÔºåËäÇÁúÅÂÜÖÂ≠ò</small>
                                </div>
                                
                                <!-- Êó∂Èó¥Ê≠•ÈááÊ†∑ -->
                                <div class="form-group">
                                    <label title="Êó∂Èó¥Ê≠•ÈááÊ†∑ÊñπÊ≥ï - ÂÆòÊñπÈªòËÆ§Ôºöshift„ÄÇ">Êó∂Èó¥Ê≠•ÈááÊ†∑ (timestep_sampling)</label>
                                    <select id="timestep_sampling" title="Êó∂Èó¥Ê≠•ÈááÊ†∑ÊñπÊ≥ï - ÂÆòÊñπÈªòËÆ§Ôºöshift„ÄÇ">
                                        <option value="shift" selected>shift</option>
                                        <option value="uniform">uniform</option>
                                        <option value="sigma">sigma</option>
                                        <option value="sigmoid">sigmoid</option>
                                    </select>
                                    <small style="color: #666; display: block; margin-top: 5px;">üí° ÂÆòÊñπÊé®ËçêÂÄºÔºöshiftÔºåÈÄÇÁî®‰∫éQwenÊ®°Âûã</small>
                                </div>
                                
                                <!-- ÊùÉÈáçÊñπÊ°à -->
                                <div class="form-group">
                                    <label title="ÊùÉÈáçÊñπÊ°à - ÂÆòÊñπÈªòËÆ§Ôºönone„ÄÇ">ÊùÉÈáçÊñπÊ°à (weighting_scheme)</label>
                                    <select id="weighting_scheme" title="ÊùÉÈáçÊñπÊ°à - ÂÆòÊñπÈªòËÆ§Ôºönone„ÄÇ">
                                        <option value="none" selected>none</option>
                                        <option value="logit_normal">logit_normal</option>
                                        <option value="mode">mode</option>
                                        <option value="cosmap">cosmap</option>
                                    </select>
                                    <small style="color: #666; display: block; margin-top: 5px;">üí° ÂÆòÊñπÊé®ËçêÂÄºÔºönoneÔºå‰øùÊåÅÈªòËÆ§</small>
                                </div>
                                
                                <!-- Á¶ªÊï£ÊµÅÂÅèÁßª -->
                                <div class="form-group">
                                    <label title="Á¶ªÊï£ÊµÅÂÅèÁßª - ÂÆòÊñπÈªòËÆ§Ôºö2.2„ÄÇ">Á¶ªÊï£ÊµÅÂÅèÁßª (discrete_flow_shift)</label>
                                    <input type="number" id="discrete_flow_shift" step="0.1" title="Á¶ªÊï£ÊµÅÂÅèÁßª - ÂÆòÊñπÈªòËÆ§Ôºö2.2„ÄÇ">
                                    <small style="color: #666; display: block; margin-top: 5px;">üí° ÂÆòÊñπÊé®ËçêÂÄºÔºö2.2ÔºåQwenÊ®°Âûã‰∏ìÁî®ÂèÇÊï∞</small>
                                </div>
                                
                                <!-- Êï∞ÊçÆÂä†ËΩΩÂô®Â∑•‰ΩúËøõÁ®ãÊï∞ -->
                                <div class="form-group">
                                    <label title="Êï∞ÊçÆÂä†ËΩΩÂô®Â∑•‰ΩúËøõÁ®ãÊï∞ - ÂÆòÊñπÈªòËÆ§Ôºö2„ÄÇ">Êï∞ÊçÆÂä†ËΩΩÂô®Â∑•‰ΩúËøõÁ®ãÊï∞ (max_data_loader_n_workers)</label>
                                    <input type="number" id="max_data_loader_n_workers" min="0" title="Êï∞ÊçÆÂä†ËΩΩÂô®Â∑•‰ΩúËøõÁ®ãÊï∞ - ÂÆòÊñπÈªòËÆ§Ôºö2„ÄÇ">
                                    <small style="color: #666; display: block; margin-top: 5px;">üí° ÂÆòÊñπÊé®ËçêÂÄºÔºö2ÔºåÂπ≥Ë°°ÊÄßËÉΩÂíåËµÑÊ∫êÂç†Áî®</small>
                                </div>
                                
                                
                                <!-- ÁΩëÁªúÊ®°Âùó -->
                                <div class="form-group">
                                    <label title="ÁΩëÁªúÊ®°Âùó - ÂÆòÊñπÈªòËÆ§Ôºönetworks.lora_qwen_image„ÄÇ">ÁΩëÁªúÊ®°Âùó (network_module)</label>
                                    <input type="text" id="network_module" title="ÁΩëÁªúÊ®°Âùó - ÂÆòÊñπÈªòËÆ§Ôºönetworks.lora_qwen_image„ÄÇ">
                                    <small style="color: #666; display: block; margin-top: 5px;">üí° ÂÆòÊñπÊé®ËçêÂÄºÔºönetworks.lora_qwen_imageÔºåQwen‰∏ìÁî®LoRAÊ®°Âùó</small>
                                </div>
                                
                                <!-- ÁΩëÁªúÈ¢ùÂ§ñÂèÇÊï∞ -->
                                <div class="form-group">
                                    <label title="LoRAÁΩëÁªúÈ¢ùÂ§ñÂèÇÊï∞ - Áî®‰∫éÈÖçÁΩÆLoRA+Á≠âÈ´òÁ∫ßÂäüËÉΩ„ÄÇ">ÁΩëÁªúÈ¢ùÂ§ñÂèÇÊï∞ (network_args)</label>
                                    <input type="text" id="network_args" title="LoRAÁΩëÁªúÈ¢ùÂ§ñÂèÇÊï∞ - Áî®‰∫éÈÖçÁΩÆLoRA+Á≠âÈ´òÁ∫ßÂäüËÉΩ„ÄÇ">
                                    <small style="color: #666; display: block; margin-top: 5px;">üí° Êé®ËçêÂÄºÔºöloraplus_lr_ratio=4ÔºåÂ¶ÇÊûú‰Ω†ÊÉ≥ËÆ©LoRAÊõ¥ÂÆπÊòìËß¶ÂèëÔºåÊèêÈ´òËØ•ÂÄº„ÄÇ‰∏∫LoRAÁöÑAÂíåBÁü©ÈòµËÆæÁΩÆ‰∏çÂêåÂ≠¶‰π†ÁéáÊØî‰æã</small>
                                </div>
                                
                                <!-- ÂºÄÂÖ≥ÈÄâÈ°π -->
                                <div class="form-group">
                                    <label title="ÂêØÁî®SDPAÊ≥®ÊÑèÂäõÊú∫Âà∂ - ÂÆòÊñπÈªòËÆ§ÔºöÂºÄÂêØ„ÄÇ">SDPA (sdpa)</label>
                                    <input type="checkbox" id="sdpa" checked title="ÂêØÁî®SDPAÊ≥®ÊÑèÂäõÊú∫Âà∂ - ÂÆòÊñπÈªòËÆ§ÔºöÂºÄÂêØ„ÄÇ">
                                    <small style="color: #666; display: block; margin-top: 5px;">üí° ÂÆòÊñπÊé®ËçêÔºöÂºÄÂêØÔºåÊèêÂçáËÆ≠ÁªÉÊÄßËÉΩ</small>
                                </div>
                                
                                <div class="form-group">
                                    <label title="ÂêØÁî®Ê¢ØÂ∫¶Ê£ÄÊü•ÁÇπ - ÂÆòÊñπÈªòËÆ§ÔºöÂºÄÂêØ„ÄÇ">Ê¢ØÂ∫¶Ê£ÄÊü•ÁÇπ (gradient_checkpointing)</label>
                                    <input type="checkbox" id="gradient_checkpointing" checked title="ÂêØÁî®Ê¢ØÂ∫¶Ê£ÄÊü•ÁÇπ - ÂÆòÊñπÈªòËÆ§ÔºöÂºÄÂêØ„ÄÇ">
                                    <small style="color: #666; display: block; margin-top: 5px;">üí° ÂÆòÊñπÊé®ËçêÔºöÂºÄÂêØÔºåËäÇÁúÅÊòæÂ≠ò</small>
                                </div>
                                
                                <div class="form-group">
                                    <label title="ÊåÅ‰πÖÂåñÊï∞ÊçÆÂä†ËΩΩÂô® - ÂÆòÊñπÈªòËÆ§ÔºöÂºÄÂêØ„ÄÇ">ÊåÅ‰πÖÂåñÊï∞ÊçÆÂä†ËΩΩÂô® (persistent_data_loader_workers)</label>
                                    <input type="checkbox" id="persistent_data_loader_workers" checked title="ÊåÅ‰πÖÂåñÊï∞ÊçÆÂä†ËΩΩÂô® - ÂÆòÊñπÈªòËÆ§ÔºöÂºÄÂêØ„ÄÇ">
                                    <small style="color: #666; display: block; margin-top: 5px;">üí° ÂÆòÊñπÊé®ËçêÔºöÂºÄÂêØÔºåÊèêÂçáÊï∞ÊçÆÂä†ËΩΩÊïàÁéá</small>
                                </div>
                                
                                <!-- FP8ÈáèÂåñÈÄâÈ°π -->
                                <div class="form-group">
                                    <label title="ÂêØÁî®FP8Âü∫Á°ÄÊ®°ÂûãÈáèÂåñ - ËäÇÁúÅÊòæÂ≠òÔºåÊèêÂçáËÆ≠ÁªÉÊïàÁéá„ÄÇ">FP8Âü∫Á°ÄÈáèÂåñ (fp8_base)</label>
                                    <input type="checkbox" id="fp8_base" checked title="ÂêØÁî®FP8Âü∫Á°ÄÊ®°ÂûãÈáèÂåñ - ËäÇÁúÅÊòæÂ≠òÔºåÊèêÂçáËÆ≠ÁªÉÊïàÁéá„ÄÇ">
                                    <small style="color: #666; display: block; margin-top: 5px;">üí° Êé®ËçêÔºöÂºÄÂêØÔºåÊòæËëóËäÇÁúÅÊòæÂ≠òÂç†Áî®</small>
                                </div>
                                
                                <div class="form-group">
                                    <label title="ÂêØÁî®FP8Áº©ÊîæÈáèÂåñ - Ëøõ‰∏ÄÊ≠•‰ºòÂåñÊòæÂ≠ò‰ΩøÁî®„ÄÇ">FP8Áº©ÊîæÈáèÂåñ (fp8_scaled)</label>
                                    <input type="checkbox" id="fp8_scaled" checked title="ÂêØÁî®FP8Áº©ÊîæÈáèÂåñ - Ëøõ‰∏ÄÊ≠•‰ºòÂåñÊòæÂ≠ò‰ΩøÁî®„ÄÇ">
                                    <small style="color: #666; display: block; margin-top: 5px;">üí° Êé®ËçêÔºöÂºÄÂêØÔºå‰∏éFP8Âü∫Á°ÄÈáèÂåñÈÖçÂêà‰ΩøÁî®</small>
                                </div>
                                
                                <!-- ÂÜÖÂ≠ò‰ºòÂåñÂèÇÊï∞ -->
                                <div class="form-group">
                                    <label title="‰∫§Êç¢Âà∞CPUÁöÑTransformerÂùóÊï∞Èáè - ËäÇÁúÅÊòæÂ≠òÔºå‰ΩÜ‰ºöÂΩ±ÂìçËÆ≠ÁªÉÈÄüÂ∫¶„ÄÇ">CPU‰∫§Êç¢ÂùóÊï∞ (blocks_to_swap)</label>
                                    <input type="number" id="blocks_to_swap" min="0" max="50" title="‰∫§Êç¢Âà∞CPUÁöÑTransformerÂùóÊï∞Èáè - ËäÇÁúÅÊòæÂ≠òÔºå‰ΩÜ‰ºöÂΩ±ÂìçËÆ≠ÁªÉÈÄüÂ∫¶„ÄÇ">
                                    <small style="color: #666; display: block; margin-top: 5px;">üí° Êé®ËçêÂÄºÔºö20ÔºåÂπ≥Ë°°ÊòæÂ≠òËäÇÁúÅÂíåËÆ≠ÁªÉÈÄüÂ∫¶</small>
                                </div>
                                
                                <!-- TensorBoardÊó•ÂøóÈÖçÁΩÆ -->
                                <div class="form-group">
                                    <label title="Êó•ÂøóÁõÆÂΩïË∑ØÂæÑ - Â≠òÂÇ®ËÆ≠ÁªÉÊó•ÂøóÂíåTensorBoardÊï∞ÊçÆ„ÄÇ">Êó•ÂøóÁõÆÂΩï (logging_dir)</label>
                                    <input type="text" id="logging_dir" title="Êó•ÂøóÁõÆÂΩïË∑ØÂæÑ - Â≠òÂÇ®ËÆ≠ÁªÉÊó•ÂøóÂíåTensorBoardÊï∞ÊçÆ„ÄÇ">
                                    <small style="color: #666; display: block; margin-top: 5px;">üí° Âª∫ËÆÆÂÄºÔºö./logsÔºåÁî®‰∫éÂ≠òÂÇ®TensorBoardÊó•Âøó</small>
                                </div>
                                
                                <div class="form-group">
                                    <label title="Êó•ÂøóËÆ∞ÂΩïÂ∑•ÂÖ∑ - ÂÆòÊñπÈªòËÆ§Ôºötensorboard„ÄÇ">Êó•ÂøóÂ∑•ÂÖ∑ (log_with)</label>
                                    <select id="log_with" title="Êó•ÂøóËÆ∞ÂΩïÂ∑•ÂÖ∑ - ÂÆòÊñπÈªòËÆ§Ôºötensorboard„ÄÇ">
                                        <option value="tensorboard" selected>tensorboard</option>
                                        <option value="wandb">wandb</option>
                                        <option value="all">all</option>
                                    </select>
                                    <small style="color: #666; display: block; margin-top: 5px;">üí° ÂÆòÊñπÊé®ËçêÔºötensorboardÔºåÂèØËßÜÂåñËÆ≠ÁªÉËøáÁ®ã</small>
                                </div>
                                
                            </div>
                        </div>

                </div>
            </div>
            
            <!-- ÈÖçÁΩÆÊìç‰ΩúÈù¢Êùø -->
            <div class="config-actions">
                <div class="panel">
                    <h2>üíæ ÈÖçÁΩÆÁÆ°ÁêÜ</h2>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button onclick="saveConfig()" class="btn">üíæ ‰øùÂ≠òÈÖçÁΩÆ</button>
                        <button onclick="loadConfig()" class="btn">üìÇ Âä†ËΩΩÈÖçÁΩÆ</button>
                        <button onclick="resetConfig()" class="btn">üîÑ ÈáçÁΩÆÈÖçÁΩÆ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let isRunning = false;
        
        function setButtonsEnabled(enabled) {
            const buttons = ['cache-vae-btn', 'cache-te-btn', 'train-btn'];
            buttons.forEach(id => {
                document.getElementById(id).disabled = !enabled;
            });
            document.getElementById('stop-btn').disabled = enabled;
            isRunning = !enabled;
        }
        
        function updateStatus(status, message) {
            const indicator = document.getElementById('status-indicator');
            const text = document.getElementById('status-text');
            
            indicator.className = `status-indicator status-${status}`;
            text.textContent = message;
        }
        
        function updateProgress(percent) {
            document.getElementById('progress-fill').style.width = percent + '%';
        }
        
        function selectFile(inputId, fileExtension) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = fileExtension;
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    // ÂàõÂª∫‰∏Ä‰∏™‰∏¥Êó∂ÁöÑURLÊù•ËØªÂèñÊñá‰ª∂ÂÜÖÂÆπÂπ∂Ëé∑ÂèñË∑ØÂæÑ‰ø°ÊÅØ
                    const reader = new FileReader();
                    
                    // Â∞ùËØïËé∑ÂèñÂÆåÊï¥Ë∑ØÂæÑ
                    let fullPath = file.name;
                    
                    // Âú®ÊîØÊåÅÁöÑÁéØÂ¢É‰∏≠Ëé∑ÂèñÂÆåÊï¥Ë∑ØÂæÑ
                    if (file.path) {
                        fullPath = file.path;
                    } else if (file.webkitRelativePath) {
                        fullPath = file.webkitRelativePath;
                    } else {
                        // Âú®Ê†áÂáÜWebÁéØÂ¢É‰∏≠ÔºåÊàë‰ª¨Êó†Ê≥ïËé∑ÂèñÂÆåÊï¥Ë∑ØÂæÑ
                        // ‰ΩÜÂèØ‰ª•ÊèêÁ§∫Áî®Êà∑ÊâãÂä®ËæìÂÖ•Êàñ‰ΩøÁî®Áõ∏ÂØπË∑ØÂæÑ
                        const currentDir = 'C:\\Users\\oskey\\ai\\musubi-tuner';
                        const fileName = file.name;
                        
                        // Ê†πÊçÆÊñá‰ª∂Á±ªÂûãÊé®ÊµãÂèØËÉΩÁöÑË∑ØÂæÑ
                        if (fileExtension === '.toml') {
                            fullPath = currentDir + '\\ai_data\\datasets\\' + fileName;
                        } else if (fileExtension === '.safetensors') {
                            if (inputId === 'pretrained_model_name_or_path') {
                                fullPath = currentDir + '\\model\\diffusion_models\\' + fileName;
                            } else if (inputId === 'text_encoder_path') {
                                fullPath = currentDir + '\\model\\text_encoders\\' + fileName;
                            } else if (inputId === 'vae_path') {
                                fullPath = currentDir + '\\model\\vae\\' + fileName;
                            }
                        }
                    }
                    
                    document.getElementById(inputId).value = fullPath;
                    
                    // Â¶ÇÊûúÊòØÊï∞ÊçÆÈõÜÈÖçÁΩÆÊñá‰ª∂ÔºåËá™Âä®ËØªÂèñbatch_sizeÂíånum_repeats
                    if (inputId === 'dataset_config' && fileExtension === '.toml') {
                        readBatchSizeFromToml(fullPath);
                        readNumRepeatsFromToml(fullPath);
                    }
                }
            };
            input.click();
        }
        
        function selectFolder(inputId) {
            const input = document.createElement('input');
            input.type = 'file';
            input.webkitdirectory = true;
            input.onchange = function(e) {
                const files = e.target.files;
                if (files.length > 0) {
                    let folderPath;
                    
                    // Â∞ùËØïËé∑ÂèñÂÆåÊï¥Ë∑ØÂæÑ
                    if (files[0].path) {
                        // ‰ªéÂÆåÊï¥Ë∑ØÂæÑ‰∏≠ÊèêÂèñÊñá‰ª∂Â§πË∑ØÂæÑ
                        const fullPath = files[0].path;
                        const pathParts = fullPath.split(/[\\\/]/);
                        pathParts.pop(); // ÁßªÈô§Êñá‰ª∂Âêç
                        folderPath = pathParts.join('\\') + '\\';
                    } else if (files[0].webkitRelativePath) {
                        // Âú®Ê†áÂáÜWebÁéØÂ¢É‰∏≠ÔºåÊûÑÂª∫ÂÆåÊï¥Ë∑ØÂæÑ
                        const relativePath = files[0].webkitRelativePath;
                        // ‰øÆÂ§çBUGÔºöËé∑ÂèñÂÆåÊï¥ÁöÑÊñá‰ª∂Â§πË∑ØÂæÑÔºåËÄå‰∏çÊòØÂè™ÂèñÁ¨¨‰∏ÄÈÉ®ÂàÜ
                        const pathParts = relativePath.split('/');
                        pathParts.pop(); // ÁßªÈô§Êñá‰ª∂Âêç
                        const folderRelativePath = pathParts.join('\\');
                        const currentDir = 'C:\\Users\\oskey\\ai\\musubi-tuner';
                        folderPath = currentDir + '\\' + folderRelativePath + '\\';
                    } else {
                        // ÂõûÈÄÄÂà∞Áõ∏ÂØπË∑ØÂæÑ
                        const path = files[0].webkitRelativePath ? files[0].webkitRelativePath.split('/')[0] : 'selected_folder';
                        folderPath = './' + path + '/';
                    }
                    
                    document.getElementById(inputId).value = folderPath;
                }
            };
            input.click();
        }
        
        function readBatchSizeFromToml(tomlPath) {
            fetch('/api/read_batch_size_from_toml', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ toml_path: tomlPath })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.batch_size !== null) {
                    document.getElementById('batch_size').value = data.batch_size;
                    addLogEntry({
                        level: 'info',
                        message: `Â∑≤‰ªé ${tomlPath} ËØªÂèñ batch_size: ${data.batch_size}`,
                        timestamp: new Date().toLocaleTimeString()
                    });
                } else {
                    addLogEntry({
                        level: 'warning',
                        message: data.message || 'Êó†Ê≥ï‰ªéTOMLÊñá‰ª∂ËØªÂèñbatch_size',
                        timestamp: new Date().toLocaleTimeString()
                    });
                }
            })
            .catch(error => {
                addLogEntry({
                    level: 'error',
                    message: 'ËØªÂèñTOMLÊñá‰ª∂Â§±Ë¥•: ' + error.message,
                    timestamp: new Date().toLocaleTimeString()
                });
            });
        }
        
        function readNumRepeatsFromToml(tomlPath) {
            fetch('/api/read_num_repeats_from_toml', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ toml_path: tomlPath })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.num_repeats !== null) {
                    document.getElementById('num_repeats').value = data.num_repeats;
                    addLogEntry({
                        level: 'info',
                        message: `Â∑≤‰ªé ${tomlPath} ËØªÂèñ num_repeats: ${data.num_repeats}`,
                        timestamp: new Date().toLocaleTimeString()
                    });
                } else {
                    addLogEntry({
                        level: 'warning',
                        message: data.message || 'Êó†Ê≥ï‰ªéTOMLÊñá‰ª∂ËØªÂèñnum_repeats',
                        timestamp: new Date().toLocaleTimeString()
                    });
                }
            })
            .catch(error => {
                addLogEntry({
                    level: 'error',
                    message: 'ËØªÂèñTOMLÊñá‰ª∂Â§±Ë¥•: ' + error.message,
                    timestamp: new Date().toLocaleTimeString()
                });
            });
        }
        
        function getConfig() {
            // ËæÖÂä©ÂáΩÊï∞ÔºöÂÆâÂÖ®Ëé∑ÂèñÂÖÉÁ¥†ÂÄº
            function safeGetValue(id, defaultValue = '', isCheckbox = false) {
                const element = document.getElementById(id);
                if (!element) {
                    console.warn(`Element with id '${id}' not found, using default value:`, defaultValue);
                    return defaultValue;
                }
                return isCheckbox ? element.checked : element.value;
            }
            
            function safeGetIntValue(id, defaultValue = 0) {
                const value = safeGetValue(id, defaultValue.toString());
                return parseInt(value) || defaultValue;
            }
            
            function safeGetFloatValue(id, defaultValue = 0.0) {
                const value = safeGetValue(id, defaultValue.toString());
                return parseFloat(value) || defaultValue;
            }
            
            const config = {
                enable_venv: safeGetValue('enable_venv', true, true),
                venv_python_path: safeGetValue('venv_python_path', './venv/Scripts/'),
                dataset_config: safeGetValue('dataset_config', './dataset_config.toml'),
                output_dir: safeGetValue('output_dir', './output'),
                pretrained_model_name_or_path: safeGetValue('pretrained_model_name_or_path', './model/diffusion_models/qwen_image_bf16.safetensors'),
                text_encoder_path: safeGetValue('text_encoder_path', './model/text_encoders/qwen_2.5_vl_7b.safetensors'),
                vae_path: safeGetValue('vae_path', './model/vae/qwen_image_vae.safetensors'),
                learning_rate: (() => {
                    const value = safeGetValue('learning_rate', '5e-05');
                    // Â¶ÇÊûúÊòØÊï∞Â≠óÊ†ºÂºè(Â¶Ç0.00005)ÔºåËΩ¨Êç¢‰∏∫ÁßëÂ≠¶ËÆ°Êï∞Ê≥ïÊ†ºÂºè
                    const numValue = parseFloat(value);
                    if (!isNaN(numValue) && numValue === 0.00005) {
                        return '5e-05';
                    }
                    return value;
                })(),
                batch_size: safeGetIntValue('batch_size', 1),
                num_repeats: safeGetIntValue('num_repeats', 5),
                gradient_accumulation_steps: safeGetIntValue('gradient_accumulation_steps', 1),
                mixed_precision: safeGetValue('mixed_precision', 'bf16'),
                network_dim: safeGetIntValue('network_dim', 8),
                network_alpha: safeGetIntValue('network_alpha', 16),
                optimizer_type: safeGetValue('optimizer_type', 'AdamW8bit'),
                lr_scheduler: safeGetValue('lr_scheduler', 'cosine'),
                lr_warmup_steps: safeGetIntValue('lr_warmup_steps', 100),
                discrete_flow_shift: safeGetFloatValue('discrete_flow_shift', 2.2),
                max_data_loader_n_workers: safeGetIntValue('max_data_loader_n_workers', 2),
                max_train_epochs: safeGetIntValue('max_train_epochs', 10),
                save_every_n_epochs: safeGetIntValue('save_every_n_epochs', 1),
                num_cpu_threads_per_process: safeGetIntValue('num_cpu_threads_per_process', 1),
                timestep_sampling: safeGetValue('timestep_sampling', 'uniform'),
                weighting_scheme: safeGetValue('weighting_scheme', 'logit_normal'),
                network_module: safeGetValue('network_module', 'networks.lora_qwen_image'),
                network_args: safeGetValue('network_args', 'loraplus_lr_ratio=4'),
                seed: safeGetIntValue('seed', 42),
                output_name: safeGetValue('output_name', 'lovemf_lora'),
                blocks_to_swap: safeGetIntValue('blocks_to_swap', 20),
                logging_dir: safeGetValue('logging_dir', './logs'),
                log_with: safeGetValue('log_with', 'tensorboard')
            };
            
            // ‰øùÂ≠òÊâÄÊúâcheckboxÁöÑÁä∂ÊÄÅÔºàÂåÖÊã¨Êú™ÂãæÈÄâÁöÑfalseÂÄºÔºâ
            config.sdpa = safeGetValue('sdpa', false, true);
            config.gradient_checkpointing = safeGetValue('gradient_checkpointing', false, true);
            config.persistent_data_loader_workers = safeGetValue('persistent_data_loader_workers', false, true);
            config.enable_venv = safeGetValue('enable_venv', false, true);
            
            // Êñ∞Â¢ûÂèÇÊï∞ÁöÑcheckboxÁä∂ÊÄÅ
            config.fp8_base = safeGetValue('fp8_base', false, true);
            config.fp8_scaled = safeGetValue('fp8_scaled', false, true);
            
            return config;
        }
        
        function addLogEntry(entry) {
            const logOutput = document.getElementById('log-output');
            if (!logOutput) return;
            
            // Ê£ÄÊü•Áî®Êà∑ÊòØÂê¶Âú®Â∫ïÈÉ®ÊàñÊé•ËøëÂ∫ïÈÉ®ÔºàÂÆπÂ∑Æ20pxÔºâ
            const shouldScroll = logOutput.scrollTop + logOutput.clientHeight >= logOutput.scrollHeight - 20;
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry log-' + entry.level;
            logEntry.innerHTML = `<span style="color: #888;">[${entry.timestamp}]</span> ${entry.message}`;
            logOutput.appendChild(logEntry);
            
            // Êõ¥Êñ∞Êó•ÂøóËÆ°Êï∞
            lastLogCount++;
            
            // Â¶ÇÊûúÁî®Êà∑Âú®Â∫ïÈÉ®ÊàñÊé•ËøëÂ∫ïÈÉ®ÔºåËá™Âä®ÊªöÂä®Âà∞ÊúÄÊñ∞Êó•Âøó
            if (shouldScroll) {
                // ‰ΩøÁî®setTimeoutÁ°Æ‰øùDOMÊõ¥Êñ∞ÂêéÂÜçÊªöÂä®
                setTimeout(() => {
                    logOutput.scrollTop = logOutput.scrollHeight;
                }, 10);
            }
        }
        
        function startCacheVAE() {
            if (isRunning) return;
            
            setButtonsEnabled(false);
            updateStatus('running', 'Ê≠£Âú®È¢ÑÁºìÂ≠ò VAE Latents...');
            
            const config = getConfig();
            
            fetch('/api/cache_vae', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(config)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateStatus('success', 'VAE Latents ÁºìÂ≠òÂÆåÊàê');
                } else {
                    updateStatus('error', 'VAE ÁºìÂ≠òÂ§±Ë¥•: ' + data.message);
                }
                setButtonsEnabled(true);
            })
            .catch(error => {
                updateStatus('error', 'ËØ∑Ê±ÇÂ§±Ë¥•: ' + error.message);
                setButtonsEnabled(true);
            });
        }
        
        function startCacheTextEncoder() {
            if (isRunning) return;
            
            setButtonsEnabled(false);
            updateStatus('running', 'Ê≠£Âú®È¢ÑÁºìÂ≠òÊñáÊú¨ÁºñÁ†ÅÂô®ËæìÂá∫...');
            
            const config = getConfig();
            
            fetch('/api/cache_text_encoder', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(config)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateStatus('success', 'ÊñáÊú¨ÁºñÁ†ÅÂô®ËæìÂá∫ÁºìÂ≠òÂÆåÊàê');
                } else {
                    updateStatus('error', 'ÊñáÊú¨ÁºñÁ†ÅÂô®ÁºìÂ≠òÂ§±Ë¥•: ' + data.message);
                }
                setButtonsEnabled(true);
            })
            .catch(error => {
                updateStatus('error', 'ËØ∑Ê±ÇÂ§±Ë¥•: ' + error.message);
                setButtonsEnabled(true);
            });
        }
        
        function startTraining() {
            if (isRunning) return;
            
            setButtonsEnabled(false);
            updateStatus('running', 'Ê≠£Âú®ÂºÄÂßãËÆ≠ÁªÉ...');
            
            const config = getConfig();
            
            fetch('/api/start_training', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(config)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateStatus('running', 'ËÆ≠ÁªÉËøõË°å‰∏≠...');
                } else {
                    updateStatus('error', 'ËÆ≠ÁªÉÂêØÂä®Â§±Ë¥•: ' + data.message);
                    setButtonsEnabled(true);
                }
            })
            .catch(error => {
                updateStatus('error', 'ËØ∑Ê±ÇÂ§±Ë¥•: ' + error.message);
                setButtonsEnabled(true);
            });
        }
        
        function stopTraining() {
            fetch('/api/stop_training', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    updateStatus('idle', 'ËÆ≠ÁªÉÂ∑≤ÂÅúÊ≠¢');
                } else {
                    updateStatus('error', 'ÂÅúÊ≠¢ËÆ≠ÁªÉÂ§±Ë¥•: ' + data.message);
                }
                setButtonsEnabled(true);
            })
            .catch(error => {
                updateStatus('error', 'ËØ∑Ê±ÇÂ§±Ë¥•: ' + error.message);
            });
        }
        
        function startTensorBoard() {
            fetch('/api/start_tensorboard', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('‚úÖ TensorBoardÂêØÂä®ÊàêÂäüÔºÅ\nËÆøÈóÆÂú∞ÂùÄ: http://localhost:6006');
                    // Ëá™Âä®ÊâìÂºÄTensorBoardÈ°µÈù¢
                    window.open('http://localhost:6006', '_blank');
                } else {
                    alert('‚ùå TensorBoardÂêØÂä®Â§±Ë¥•: ' + data.message);
                }
            })
            .catch(error => {
                alert('‚ùå ÂêØÂä®TensorBoardÊó∂ÂèëÁîüÈîôËØØ: ' + error.message);
            });
        }
        
        // ÂÆöÊúüËé∑ÂèñÊó•Âøó
        let lastLogCount = 0;
        
        function fetchLogs() {
            fetch('/api/logs', {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                cache: 'no-cache'
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                const logOutput = document.getElementById('log-output');
                if (!logOutput || !data.logs) return;
                
                // ÈáçÁΩÆÈîôËØØËÆ°Êï∞Âô®ÔºàÊàêÂäüËé∑ÂèñÊó•ÂøóÔºâ
                window.logFetchErrorCount = 0;
                
                // Âè™Â§ÑÁêÜÊñ∞ÁöÑÊó•ÂøóÊù°ÁõÆ
                if (data.logs.length > lastLogCount) {
                    // Ê£ÄÊü•Áî®Êà∑ÊòØÂê¶Âú®Â∫ïÈÉ®ÊàñÊé•ËøëÂ∫ïÈÉ®ÔºàÂÆπÂ∑Æ50pxÔºâ
                    const isAtBottom = logOutput.scrollTop + logOutput.clientHeight >= logOutput.scrollHeight - 50;
                    
                    // Âè™Ê∑ªÂä†Êñ∞ÁöÑÊó•ÂøóÊù°ÁõÆ
                    const newLogs = data.logs.slice(lastLogCount);
                    newLogs.forEach(entry => {
                        const logEntry = document.createElement('div');
                        logEntry.className = 'log-entry log-' + entry.level;
                        logEntry.innerHTML = `<span style="color: #888;">[${entry.timestamp}]</span> ${entry.message}`;
                        logOutput.appendChild(logEntry);
                        
                        // Ê£ÄÊµãËÆ≠ÁªÉÂÆåÊàêÁä∂ÊÄÅ
                        if (entry.message.includes('‚úÖ LoRAËÆ≠ÁªÉ ÂÆåÊàê') || 
                            entry.message.includes('‚úÖ') && (entry.message.includes('ËÆ≠ÁªÉ') || entry.message.includes('ÂÆåÊàê')) && entry.level === 'success') {
                            // ËÆ≠ÁªÉÂÆåÊàêÔºåÊõ¥Êñ∞ÁïåÈù¢Áä∂ÊÄÅ
                            updateStatus('success', 'ËÆ≠ÁªÉÂ∑≤ÂÆåÊàê');
                            setButtonsEnabled(true);
                        }
                        
                        // Ê£ÄÊµãËÆ≠ÁªÉÂ§±Ë¥•Áä∂ÊÄÅ
                        if (entry.message.includes('‚ùå') && (entry.message.includes('ËÆ≠ÁªÉ') || entry.message.includes('Â§±Ë¥•')) && entry.level === 'error') {
                            // ËÆ≠ÁªÉÂ§±Ë¥•ÔºåÊõ¥Êñ∞ÁïåÈù¢Áä∂ÊÄÅ
                            updateStatus('error', 'ËÆ≠ÁªÉÂ§±Ë¥•');
                            setButtonsEnabled(true);
                        }
                    });
                    
                    lastLogCount = data.logs.length;
                    
                    // Ëá™Âä®ÊªöÂä®Âà∞ÊúÄÊñ∞Êó•ÂøóÔºàÂ¢ûÂä†ÂÆπÂ∑ÆÂπ∂‰ΩøÁî®Êõ¥ÂèØÈù†ÁöÑÊªöÂä®ÊñπÊ≥ïÔºâ
                    if (isAtBottom) {
                        // ‰ΩøÁî®requestAnimationFrameÁ°Æ‰øùDOMÊõ¥Êñ∞ÂÆåÊàêÂêéÂÜçÊªöÂä®
                        requestAnimationFrame(() => {
                            logOutput.scrollTop = logOutput.scrollHeight;
                            // ÂèåÈáç‰øùÈô©ÔºåÂÜçÊ¨°ÊªöÂä®
                            setTimeout(() => {
                                logOutput.scrollTop = logOutput.scrollHeight;
                            }, 50);
                        });
                    }
                }
            })
            .catch(error => {
                console.error('Ëé∑ÂèñÊó•ÂøóÂ§±Ë¥•:', error);
                // Âè™Âú®ËøûÁª≠Â§±Ë¥•Êó∂ÊòæÁ§∫ÈîôËØØÔºàÈÅøÂÖçÈ¢ëÁπÅÊòæÁ§∫ÈîôËØØÔºâ
                if (!window.logFetchErrorCount) window.logFetchErrorCount = 0;
                window.logFetchErrorCount++;
                
                if (window.logFetchErrorCount <= 3) {
                    const logOutput = document.getElementById('log-output');
                    if (logOutput) {
                        const errorEntry = document.createElement('div');
                        errorEntry.className = 'log-entry log-error';
                        errorEntry.innerHTML = `<span style="color: #888;">[${new Date().toLocaleString()}]</span> Ëé∑ÂèñÊó•ÂøóÂ§±Ë¥• (${window.logFetchErrorCount}/3): ${error.message}`;
                        logOutput.appendChild(errorEntry);
                        
                        // Ëá™Âä®ÊªöÂä®Âà∞ÈîôËØØ‰ø°ÊÅØ
                        setTimeout(() => {
                            logOutput.scrollTop = logOutput.scrollHeight;
                        }, 100);
                    }
                }
            });
        }
        
        // ÊªöÂä®Âà∞Â∫ïÈÉ®ÂáΩÊï∞
        function scrollToBottom() {
            const logOutput = document.getElementById('log-output');
            if (logOutput) {
                logOutput.scrollTop = logOutput.scrollHeight;
            }
        }
        
        // Ê∏ÖÁêÜÊó•ÂøóÂáΩÊï∞
        function clearLogs() {
            fetch('/api/clear_logs', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const logOutput = document.getElementById('log-output');
                    if (logOutput) {
                        logOutput.innerHTML = '';
                        lastLogCount = 0;
                        // Ê∑ªÂä†Ê∏ÖÁêÜÊàêÂäüÊèêÁ§∫
                        addLogEntry({
                            level: 'info',
                            timestamp: new Date().toLocaleString(),
                            message: 'Êó•ÂøóÂ∑≤Ê∏ÖÁêÜ üßπ'
                        });
                        // ÊªöÂä®Âà∞Â∫ïÈÉ®
                        setTimeout(() => {
                            logOutput.scrollTop = logOutput.scrollHeight;
                        }, 100);
                    }
                } else {
                    console.error('Ê∏ÖÁêÜÊó•ÂøóÂ§±Ë¥•:', data.message);
                }
            })
            .catch(error => {
                console.error('Ê∏ÖÁêÜÊó•ÂøóËØ∑Ê±ÇÂ§±Ë¥•:', error);
            });
        }
        
        // ÂàùÂßãÂåñ
        updateStatus('idle', 'Â∞±Áª™');
        // ÂàùÂßãËé∑ÂèñÊó•ÂøóÂπ∂ÊªöÂä®Âà∞Â∫ïÈÉ®
        fetchLogs();
        setTimeout(scrollToBottom, 500);
        setInterval(fetchLogs, 1000);
        
        function saveConfig() {
            const config = getConfig();
            
            fetch('/api/save_config', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(config)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('‚úÖ ÈÖçÁΩÆ‰øùÂ≠òÊàêÂäüÔºÅ');
                } else {
                    alert('‚ùå ÈÖçÁΩÆ‰øùÂ≠òÂ§±Ë¥•: ' + data.message);
                }
            })
            .catch(error => {
                alert('‚ùå ‰øùÂ≠òÈÖçÁΩÆÊó∂ÂèëÁîüÈîôËØØ: ' + error.message);
            });
        }
        
        function loadConfig(silent = false) {
            fetch('/api/load_config')
            .then(response => response.json())
            .then(data => {
                if (data.success && data.config) {
                    const config = data.config;
                    
                    // Êõ¥Êñ∞ÊâÄÊúâË°®ÂçïÂ≠óÊÆµ
                    Object.keys(config).forEach(key => {
                        const element = document.getElementById(key);
                        if (element) {
                            if (element.type === 'checkbox') {
                                element.checked = config[key];
                            } else {
                                // ÁâπÊÆäÂ§ÑÁêÜlearning_rateÔºåÁ°Æ‰øùÊòæÁ§∫‰∏∫ÁßëÂ≠¶ËÆ°Êï∞Ê≥ïÊ†ºÂºè
                                if (key === 'learning_rate') {
                                    const numValue = parseFloat(config[key]);
                                    if (!isNaN(numValue) && numValue === 0.00005) {
                                        element.value = '5e-05';
                                    } else {
                                        element.value = config[key];
                                    }
                                } else {
                                    element.value = config[key];
                                }
                            }
                        } else {
                            console.warn(`Element with id '${key}' not found when loading config`);
                        }
                    });
                    
                    if (!silent) {
                        alert('‚úÖ ÈÖçÁΩÆÂä†ËΩΩÊàêÂäüÔºÅ');
                    }
                } else {
                    if (!silent) {
                        alert('‚ùå ÈÖçÁΩÆÂä†ËΩΩÂ§±Ë¥•: ' + (data.message || 'Êú™Áü•ÈîôËØØ'));
                    }
                }
            })
            .catch(error => {
                if (!silent) {
                    alert('‚ùå Âä†ËΩΩÈÖçÁΩÆÊó∂ÂèëÁîüÈîôËØØ: ' + error.message);
                }
            });
        }
        
        function toggleSection(sectionId) {
             const section = document.getElementById(sectionId);
             const header = section.previousElementSibling;
             const icon = header.querySelector('.toggle-icon');
             
             if (section.classList.contains('collapsed')) {
                 section.classList.remove('collapsed');
                 header.classList.remove('collapsed');
                 icon.textContent = '‚ñº';
             } else {
                 section.classList.add('collapsed');
                 header.classList.add('collapsed');
                 icon.textContent = '‚ñ∂';
             }
         }
         
         function loadConfigSilently() {
             loadConfig(true);
         }
         
         function resetConfig() {
             if (confirm('Á°ÆÂÆöË¶ÅÈáçÁΩÆÈÖçÁΩÆÂêóÔºüËøôÂ∞ÜÊÅ¢Â§çÊâÄÊúâÂèÇÊï∞‰∏∫ÈªòËÆ§ÂÄºÂπ∂Ëá™Âä®‰øùÂ≠ò„ÄÇ')) {
                 fetch('/api/reset_config', {
                     method: 'POST'
                 })
                 .then(response => response.json())
                 .then(config => {
                     Object.keys(config).forEach(key => {
                         const element = document.getElementById(key);
                         if (element) {
                             if (element.type === 'checkbox') {
                                 element.checked = config[key];
                             } else {
                                 // ÁâπÊÆäÂ§ÑÁêÜlearning_rateÔºåÁ°Æ‰øùÊòæÁ§∫‰∏∫ÁßëÂ≠¶ËÆ°Êï∞Ê≥ïÊ†ºÂºè
                                 if (key === 'learning_rate') {
                                     const numValue = parseFloat(config[key]);
                                     if (!isNaN(numValue) && numValue === 0.00005) {
                                         element.value = '5e-05';
                                     } else {
                                         element.value = config[key];
                                     }
                                 } else {
                                     element.value = config[key];
                                 }
                             }
                         } else {
                             console.warn(`Element with id '${key}' not found when resetting config`);
                         }
                     });
                     // ÈáçÁΩÆÂêéËá™Âä®‰øùÂ≠òÈÖçÁΩÆ
                     saveConfig();
                     alert('‚úÖ ÈÖçÁΩÆÂ∑≤ÈáçÁΩÆ‰∏∫ÈªòËÆ§ÂÄºÂπ∂‰øùÂ≠ò');
                 })
                 .catch(error => {
                     alert('‚ùå ÈáçÁΩÆÈÖçÁΩÆÂ§±Ë¥•: ' + error.message);
                 });
             }
         }
         
         function checkFiles() {
             fetch('/api/check_files')
                 .then(response => response.json())
                 .then(data => {
                     let message = 'Êñá‰ª∂Ê£ÄÊü•ÁªìÊûú:\n';
                     if (data.dataset_exists) {
                         message += '‚úì Êï∞ÊçÆÈõÜÈÖçÁΩÆÊñá‰ª∂Â≠òÂú®\n';
                     } else {
                         message += '‚úó Êï∞ÊçÆÈõÜÈÖçÁΩÆÊñá‰ª∂‰∏çÂ≠òÂú®\n';
                     }
                     if (data.model_exists) {
                         message += '‚úì Ê®°ÂûãÊñá‰ª∂Â≠òÂú®\n';
                     } else {
                         message += '‚úó Ê®°ÂûãÊñá‰ª∂‰∏çÂ≠òÂú®\n';
                     }
                     if (data.vae_exists) {
                         message += '‚úì VAEÊ®°ÂûãÊñá‰ª∂Â≠òÂú®\n';
                     } else {
                         message += '‚úó VAEÊ®°ÂûãÊñá‰ª∂‰∏çÂ≠òÂú®\n';
                     }
                     alert(message);
                 })
                 .catch(error => {
                     alert('Ê£ÄÊü•Êñá‰ª∂Â§±Ë¥•: ' + error.message);
                 });
         }
         
         // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
         // È´òÁ∫ßÂèÇÊï∞ÊäòÂè†ÂäüËÉΩ
         function toggleSection(sectionId) {
             const content = document.getElementById(sectionId);
             const icon = document.getElementById('advanced-toggle-icon');
             
             if (content.style.display === 'none' || content.style.display === '') {
                 content.style.display = 'block';
                 icon.textContent = '‚ñ≤';
             } else {
                 content.style.display = 'none';
                 icon.textContent = '‚ñº';
             }
         }
         
         // ÂàùÂßãÂåñÈªòËÆ§ÂÄºÂáΩÊï∞
         function initializeDefaults() {
             const defaults = {
                 enable_venv: true,
                 venv_python_path: './venv/Scripts/',
                 dataset_config: './ai_data/datasets/lovemf_config.toml',
                 dit_path: './model/diffusion_models/qwen_image_bf16.safetensors',
                 vae_path: './model/vae/qwen_image_vae.safetensors',
                 text_encoder_path: './model/text_encoders/qwen_2.5_vl_7b.safetensors',
                 output_dir: './output',
                 output_name: 'lovemf_lora',
                 mixed_precision: 'bf16',
                 timestep_sampling: 'shift',
                 weighting_scheme: 'none',
                 discrete_flow_shift: 2.2,
                 optimizer_type: 'adamw8bit',
                 learning_rate: '5e-05',
                 max_data_loader_n_workers: 2,
                 batch_size: 1,
                 num_repeats: 5,
                 network_module: 'networks.lora_qwen_image',
                 network_dim: 8,
                 network_args: 'loraplus_lr_ratio=4',
                 max_train_epochs: 8,
                 save_every_n_epochs: 1,
                 seed: 42,
                 num_cpu_threads_per_process: 1,
                 sdpa: true,
                 gradient_checkpointing: true,
                 persistent_data_loader_workers: true,
                 fp8_base: true,
                 fp8_scaled: true,
                 blocks_to_swap: 20,
                 logging_dir: './logs',
                 log_with: 'tensorboard'
             };
             
             Object.keys(defaults).forEach(key => {
                 const element = document.getElementById(key);
                 if (element && element.type !== 'checkbox') {
                     // ÂØπ‰∫élearning_rateÔºåÂº∫Âà∂ËÆæÁΩÆ‰∏∫ÁßëÂ≠¶ËÆ°Êï∞Ê≥ïÊ†ºÂºè
                     if (key === 'learning_rate') {
                         element.value = defaults[key];
                     } else if (!element.value) {
                         element.value = defaults[key];
                     }
                 } else if (element && element.type === 'checkbox' && element.checked === false) {
                     element.checked = defaults[key];
                 }
             });
         }

         document.addEventListener('DOMContentLoaded', function() {
             // ÂÖàËÆæÁΩÆÈªòËÆ§ÂÄº
             initializeDefaults();
             
             // Learning RateËæìÂÖ•Ê°Ü‰∫ã‰ª∂ÁõëÂê¨Âô® - Ëá™Âä®ËΩ¨Êç¢‰∏∫ÁßëÂ≠¶ËÆ°Êï∞Ê≥ïÊ†ºÂºè
             const learningRateInput = document.getElementById('learning_rate');
             if (learningRateInput) {
                 learningRateInput.addEventListener('blur', function() {
                     const value = this.value.trim();
                     if (value) {
                         const numValue = parseFloat(value);
                         if (!isNaN(numValue) && numValue === 0.00005) {
                             this.value = '5e-05';
                         }
                     }
                 });
                 
                 learningRateInput.addEventListener('input', function() {
                     const value = this.value.trim();
                     if (value === '0.00005') {
                         this.value = '5e-05';
                     }
                 });
             }
             
             // ËôöÊãüÁéØÂ¢ÉÂºÄÂÖ≥‰∫ã‰ª∂ÁõëÂê¨
             const enableVenvCheckbox = document.getElementById('enable_venv');
             const venvPathGroup = document.getElementById('venv_path_group');
             
             function toggleVenvPath() {
                 if (enableVenvCheckbox.checked) {
                     venvPathGroup.style.display = 'block';
                 } else {
                     venvPathGroup.style.display = 'none';
                 }
             }
             
             enableVenvCheckbox.addEventListener('change', toggleVenvPath);
             toggleVenvPath(); // ÂàùÂßãÂåñÊòæÁ§∫Áä∂ÊÄÅ
             
             // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéËá™Âä®ÈùôÈªòÂä†ËΩΩÈÖçÁΩÆ
             loadConfigSilently();
         });
    </script>
</body>
</html>